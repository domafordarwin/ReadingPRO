<% content_for :page_title, "공지사항 관리" %>

<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
  <div>
    <h1 style="font-size: var(--rp-font-size-2xl); font-weight: var(--rp-font-weight-bold); color: #0f172a; margin: 0 0 4px 0;">공지사항 관리</h1>
    <p style="font-size: var(--rp-font-size-base); color: #94a3b8; margin: 0;">학교 관리자 및 교사에게 전달할 공지사항을 관리합니다</p>
  </div>
  <%= link_to new_diagnostic_teacher_notice_path, style: "padding: 10px 20px; background: #2f5bff; color: white; border-radius: 8px; font-size: var(--rp-font-size-base); font-weight: var(--rp-font-weight-medium); text-decoration: none; display: inline-flex; align-items: center; gap: 6px;" do %>
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
    새 공지사항
  <% end %>
</div>

<!-- 검색/필터 -->
<div style="background: white; border-radius: 12px; padding: 16px 20px; margin-bottom: 20px; border: 1px solid #e2e8f0;">
  <%= form_with url: diagnostic_teacher_notices_path, method: :get, local: true, data: { turbo: false }, style: "display: flex; gap: 12px; flex-wrap: wrap; align-items: center;" do %>
    <input type="text" name="search" value="<%= @search_query %>" placeholder="제목/내용 검색..."
           style="flex: 1; min-width: 200px; padding: 8px 12px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: var(--rp-font-size-base);">
    <select name="status" style="padding: 8px 12px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: var(--rp-font-size-base); background: white;">
      <option value="">모든 상태</option>
      <option value="active" <%= 'selected' if @status_filter == 'active' %>>활성</option>
      <option value="important" <%= 'selected' if @status_filter == 'important' %>>중요</option>
    </select>
    <button type="submit" style="padding: 8px 16px; background: #2f5bff; color: white; border: none; border-radius: 6px; font-size: var(--rp-font-size-base); cursor: pointer;">검색</button>
  <% end %>
</div>

<!-- 목록 -->
<% if @notices.any? %>
  <div style="display: flex; flex-direction: column; gap: 12px;">
    <% @notices.each do |notice| %>
      <div class="rp-notice-card <%= 'rp-notice-card--important' if notice.important %>"
           style="background: white; border: 1px solid #e2e8f0; border-radius: 12px; padding: 20px; transition: box-shadow 0.15s; <%= 'border-left: 4px solid #f59e0b; background: #fffbf0;' if notice.important %>">
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
          <div style="flex: 1;">
            <h3 style="font-size: var(--rp-font-size-md); font-weight: var(--rp-font-weight-semibold); color: #0f172a; margin: 0 0 6px 0;"><%= notice.title %></h3>
            <div style="display: flex; align-items: center; gap: 8px; font-size: var(--rp-font-size-xs); color: #94a3b8;">
              <% if notice.important %>
                <span style="background: #fef3c7; color: #92400e; padding: 2px 8px; border-radius: 4px; font-weight: var(--rp-font-weight-semibold);">중요</span>
              <% end %>
              <span><%= notice.published_at&.strftime("%Y-%m-%d %H:%M") %></span>
              <% if notice.expires_at.present? %>
                <span>~ <%= notice.expires_at.strftime("%Y-%m-%d") %></span>
              <% end %>
              <% if notice.expired? %>
                <span style="background: #fee2e2; color: #991b1b; padding: 2px 8px; border-radius: 4px; font-weight: var(--rp-font-weight-semibold);">만료됨</span>
              <% end %>
              <% if notice.target_roles.present? %>
                <% notice.target_roles.each do |role| %>
                  <span style="background: #ede9fe; color: #5b21b6; padding: 2px 8px; border-radius: 4px;"><%= role %></span>
                <% end %>
              <% end %>
            </div>
          </div>
          <div class="rp-action-group" style="display: flex; gap: 6px;">
            <%= link_to edit_diagnostic_teacher_notice_path(notice), class: "rp-icon-btn rp-icon-btn--edit", title: "편집" do %>
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
            <% end %>
            <%= button_to diagnostic_teacher_notice_path(notice), method: :delete,
                data: { turbo: false, confirm: "'#{notice.title}' 공지사항을 삭제하시겠습니까?" },
                class: "rp-icon-btn rp-icon-btn--danger", title: "삭제" do %>
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
            <% end %>
          </div>
        </div>
        <div style="font-size: var(--rp-font-size-base); color: #475569; line-height: 1.6; margin-top: 12px; padding-top: 12px; border-top: 1px solid #e2e8f0;">
          <%= truncate(notice.content, length: 200) %>
        </div>
        <div style="font-size: var(--rp-font-size-xs); color: #94a3b8; margin-top: 8px;">
          작성자: <%= notice.created_by&.email || "시스템" %>
        </div>
      </div>
    <% end %>
  </div>

  <% if @notices.total_pages > 1 %>
    <div style="margin-top: 20px; text-align: center;">
      <%= paginate @notices %>
    </div>
  <% end %>
<% else %>
  <div style="text-align: center; padding: 80px 40px; background: white; border-radius: 12px; border: 1px dashed #e2e8f0;">
    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#cbd5e1" stroke-width="1.5" style="margin-bottom: 16px;">
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
      <polyline points="14 2 14 8 20 8"></polyline>
    </svg>
    <p style="font-size: var(--rp-font-size-md); font-weight: var(--rp-font-weight-medium); color: #64748b; margin: 0 0 8px 0;">공지사항이 없습니다</p>
    <p style="font-size: var(--rp-font-size-sm); color: #94a3b8; margin: 0 0 20px 0;">새 공지사항을 등록하여 학교 관리자에게 전달하세요.</p>
    <%= link_to "새 공지사항 작성", new_diagnostic_teacher_notice_path,
          style: "padding: 10px 20px; background: #2f5bff; color: white; border-radius: 8px; font-size: var(--rp-font-size-base); text-decoration: none;" %>
  </div>
<% end %>

<style>
  .rp-icon-btn {
    display: inline-flex; align-items: center; justify-content: center;
    width: 32px; height: 32px; border-radius: 8px; border: none;
    cursor: pointer; transition: all 0.2s ease; text-decoration: none;
  }
  .rp-icon-btn svg { pointer-events: none; }
  .rp-icon-btn--edit { background: #eff6ff; color: #3b82f6; }
  .rp-icon-btn--edit:hover { background: #dbeafe; box-shadow: 0 2px 4px rgba(59,130,246,0.2); }
  .rp-icon-btn--danger { background: #fef2f2; color: #dc2626; }
  .rp-icon-btn--danger:hover { background: #fee2e2; box-shadow: 0 2px 4px rgba(220,38,38,0.2); }
</style>
