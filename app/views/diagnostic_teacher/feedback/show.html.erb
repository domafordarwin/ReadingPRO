<% content_for :page_title, "í•™ìƒ í”¼ë“œë°±" %>

<div class="rp-page-header">
  <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
    <%= link_to "â† ëŒì•„ê°€ê¸°", diagnostic_teacher_feedbacks_path, class: "rp-btn rp-btn--secondary rp-btn--sm" %>
  </div>
  <h1 class="rp-page-header__title"><%= @student.name %>ì˜ í”¼ë“œë°±</h1>
  <p class="rp-page-header__subtitle">í•™ìƒì˜ ê°ê´€ì‹ ì‘ë‹µì— ëŒ€í•œ í”¼ë“œë°±ì„ í™•ì¸í•©ë‹ˆë‹¤</p>
</div>

<% if @responses.any? %>
  <div class="rp-feedback-list">
    <% @responses.each_with_index do |response, index| %>
      <div class="rp-feedback-card">
        <div class="rp-feedback-header">
          <div class="rp-feedback-question-number">ë¬¸í•­ <%= index + 1 %></div>
          <% if response.selected_choice %>
            <span class="rp-badge <%= response.selected_choice.correct? ? 'rp-badge--success' : 'rp-badge--danger' %>">
              <%= response.selected_choice.correct? ? 'ì •ë‹µ' : 'ì˜¤ë‹µ' %>
            </span>
          <% end %>
        </div>

        <div class="rp-feedback-body">
          <div class="rp-feedback-section">
            <h4>ë¬¸í•­</h4>
            <p><%= response.item.prompt %></p>
          </div>

          <div class="rp-feedback-section">
            <h4>í•™ìƒì˜ ë‹µ</h4>
            <p>
              <% if response.selected_choice %>
                <strong><%= response.selected_choice.label %></strong>
                <% if response.selected_choice.explanation %>
                  <br><small style="color: #94a3b8;"><%= response.selected_choice.explanation %></small>
                <% end %>
              <% else %>
                <span style="color: #ef4444;">ë‹µë³€ ì—†ìŒ</span>
              <% end %>
            </p>
          </div>

          <% if response.response_feedbacks.any? %>
            <div class="rp-feedback-section">
              <h4>AI í”¼ë“œë°±</h4>
              <% response.response_feedbacks.each do |feedback| %>
                <div class="rp-ai-feedback">
                  <p><%= feedback.feedback_text %></p>
                  <div style="margin-top: 8px; font-size: 12px; color: #94a3b8;">
                    ìƒì„±ì¼: <%= feedback.created_at.strftime("%Y-%m-%d %H:%M") %>
                  </div>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
<% else %>
  <div class="rp-empty-state">
    <div style="font-size: 48px; margin-bottom: 16px;">ğŸ“</div>
    <p>í”¼ë“œë°± ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
  </div>
<% end %>

<style>
  .rp-feedback-list {
    display: grid;
    gap: 16px;
  }

  .rp-feedback-card {
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    overflow: hidden;
  }

  .rp-feedback-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    padding: 16px;
    background: #f8fafc;
    border-bottom: 1px solid #e2e8f0;
  }

  .rp-feedback-question-number {
    font-size: 14px;
    font-weight: 600;
    color: #0f172a;
  }

  .rp-feedback-body {
    padding: 16px;
    display: grid;
    gap: 12px;
  }

  .rp-feedback-section {
    padding: 12px;
    background: #f8fafc;
    border-radius: 8px;
  }

  .rp-feedback-section h4 {
    margin: 0 0 8px;
    font-size: 13px;
    font-weight: 600;
    color: #0f172a;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .rp-feedback-section p {
    margin: 0;
    font-size: 13px;
    line-height: 1.6;
    color: #475569;
  }

  .rp-ai-feedback {
    background: white;
    padding: 12px;
    border-left: 3px solid #2f5bff;
    border-radius: 4px;
    font-size: 13px;
    line-height: 1.6;
    color: #475569;
  }

  .rp-ai-feedback p {
    margin: 0;
  }

  .rp-badge--danger {
    background: #fee2e2;
    color: #b91c1c;
  }
</style>
