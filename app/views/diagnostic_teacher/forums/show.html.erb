<% content_for :page_title do %>글 상세<% end %>

<!-- Forum Header -->
<div class="rp-card rp-mb-6">
  <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px;">
    <div style="flex: 1;">
      <h1 class="rp-page-header__title" style="margin: 0 0 8px 0;"><%= @forum.title %></h1>
      <div style="display: flex; gap: 12px; align-items: center; color: #666; font-size: 14px;">
        <span><strong><%= @forum.created_by.email.split("@").first %></strong></span>
        <span>·</span>
        <span><%= @forum.created_at.strftime("%Y년 %m월 %d일 %H:%M") %></span>
        <span>·</span>
        <span>조회 <%= @forum.views_count %></span>
      </div>
    </div>
    <div style="display: flex; gap: 8px;">
      <span class="rp-badge rp-badge--primary"><%= @forum.category_label %></span>
      <% if @forum.closed? %>
        <span class="rp-badge rp-badge--danger">마감</span>
      <% elsif @forum.answered? %>
        <span class="rp-badge rp-badge--success">답변완료</span>
      <% else %>
        <span class="rp-badge rp-badge--warning">미답변</span>
      <% end %>
    </div>
  </div>
</div>

<!-- Forum Content -->
<div class="rp-card rp-mb-6">
  <div style="font-size: 16px; line-height: 1.8; color: #333; word-break: break-word;">
    <%= simple_format(@forum.content) %>
  </div>
</div>

<!-- Comments Section -->
<div class="rp-card">
  <h2 style="font-size: 18px; font-weight: 600; margin: 0 0 24px 0; padding-bottom: 12px; border-bottom: 2px solid #2F5BFF;">
    댓글 및 답변 (<%= @comments.count %>)
  </h2>

  <!-- Comments List -->
  <% if @comments.any? %>
    <div style="margin-bottom: 24px;">
      <% @comments.each do |comment| %>
        <div style="padding: 16px; background: <%= comment.is_teacher_reply? ? '#e0f2fe' : '#f8fafc' %>; border-radius: 8px; margin-bottom: 12px; border-left: 4px solid <%= comment.is_teacher_reply? ? '#0ea5e9' : '#cbd5e1' %>;">
          <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
            <div>
              <strong><%= comment.created_by.email.split("@").first %></strong>
              <% if comment.is_teacher_reply? %>
                <span class="rp-badge rp-badge--success" style="margin-left: 8px;">선생님 답변</span>
              <% end %>
              <br>
              <small style="color: #999;"><%= comment.created_at.strftime("%Y.%m.%d %H:%M") %></small>
            </div>
            <% if comment.created_by_id == current_user&.id %>
              <%= button_to "삭제", diagnostic_teacher_forum_comment_path(forum_id: @forum.id, id: comment.id), method: :delete, data: { turbo_confirm: "정말 삭제하시겠습니까?" }, class: "rp-btn rp-btn--danger rp-btn--sm" %>
            <% end %>
          </div>
          <p style="margin: 8px 0; color: #333; line-height: 1.6;">
            <%= simple_format(comment.content) %>
          </p>
        </div>
      <% end %>
    </div>
  <% else %>
    <p style="color: #999; margin-bottom: 24px;">아직 답변이 없습니다. 도움이 되는 답변을 작성해주세요.</p>
  <% end %>

  <!-- New Comment Form (Teacher Reply) -->
  <% unless @forum.closed? %>
    <div style="padding-top: 24px; border-top: 1px solid #e0e0e0;">
      <h3 style="font-size: 16px; font-weight: 600; margin: 0 0 12px 0;">답변 작성</h3>
      <%= form_tag diagnostic_teacher_forum_comments_path(@forum), method: :post, local: true do %>
        <div class="rp-form-group">
          <%= text_area_tag "parent_forum_comment[content]", "", placeholder: "부모님들을 위한 조언을 입력해주세요...", rows: 4, class: "rp-textarea" %>
        </div>
        <div style="display: flex; justify-content: flex-end;">
          <%= submit_tag "답변 작성", class: "rp-btn rp-btn--primary" %>
        </div>
      <% end %>
    </div>
  <% else %>
    <div style="padding-top: 24px; border-top: 1px solid #e0e0e0; text-align: center; color: #999;">
      마감된 게시글입니다.
    </div>
  <% end %>
</div>

<!-- Back Button -->
<div style="margin-top: 24px;">
  <%= link_to "◀ 목록으로", diagnostic_teacher_forums_path, class: "rp-btn rp-btn--secondary" %>
</div>
