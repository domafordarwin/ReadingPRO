<div class="rp-dashboard-container">
  <div class="rp-dashboard-header">
    <h1>상담 신청 관리</h1>
    <p class="rp-subtitle">부모가 신청한 상담 요청을 관리합니다</p>
  </div>

  <!-- 상태별 통계 카드 -->
  <div class="rp-stats-grid">
    <div class="rp-stat-card">
      <div class="rp-stat-value"><%= @status_counts[:pending] %></div>
      <div class="rp-stat-label">대기 중</div>
    </div>
    <div class="rp-stat-card">
      <div class="rp-stat-value"><%= @status_counts[:approved] %></div>
      <div class="rp-stat-label">승인됨</div>
    </div>
    <div class="rp-stat-card">
      <div class="rp-stat-value"><%= @status_counts[:rejected] %></div>
      <div class="rp-stat-label">거절됨</div>
    </div>
    <div class="rp-stat-card">
      <div class="rp-stat-value"><%= @status_counts[:completed] %></div>
      <div class="rp-stat-label">완료됨</div>
    </div>
  </div>

  <!-- 필터 및 검색 -->
  <div class="rp-section">
    <form method="get" class="rp-filter-form">
      <div class="rp-filter-group">
        <!-- 상태 필터 -->
        <div class="rp-filter-item">
          <label>상태</label>
          <select name="status" class="rp-select">
            <option value="all" <%= 'selected' if @status_filter == 'all' %>>전체</option>
            <option value="pending" <%= 'selected' if @status_filter == 'pending' %>>대기 중</option>
            <option value="approved" <%= 'selected' if @status_filter == 'approved' %>>승인됨</option>
            <option value="rejected" <%= 'selected' if @status_filter == 'rejected' %>>거절됨</option>
            <option value="completed" <%= 'selected' if @status_filter == 'completed' %>>완료됨</option>
          </select>
        </div>

        <!-- 검색 -->
        <div class="rp-filter-item">
          <input
            type="text"
            name="search"
            class="rp-input"
            placeholder="학생 ID 또는 학부모 이메일로 검색"
            value="<%= @search_query %>"
          />
        </div>

        <button type="submit" class="rp-btn rp-btn-primary">검색</button>
        <% if @search_query.present? || @status_filter != "pending" %>
          <a href="<%= diagnostic_teacher_consultation_requests_path %>" class="rp-btn rp-btn-secondary">초기화</a>
        <% end %>
      </div>
    </form>
  </div>

  <!-- 상담 신청 목록 테이블 -->
  <div class="rp-section">
    <% if @consultation_requests.any? %>
      <table class="rp-table">
        <thead>
          <tr>
            <th>학생 ID</th>
            <th>학부모</th>
            <th>상담 유형</th>
            <th>희망 일정</th>
            <th>상태</th>
            <th>신청일</th>
            <th>작업</th>
          </tr>
        </thead>
        <tbody>
          <% @consultation_requests.each do |req| %>
            <tr class="rp-table-row" onclick="window.location='<%= diagnostic_teacher_consultation_request_path(req) %>'">
              <td><strong><%= req.student.name %></strong></td>
              <td><%= req.user.email %></td>
              <td>
                <span class="rp-badge rp-badge-info">
                  <%= req.category_label %>
                </span>
              </td>
              <td><%= req.scheduled_at.strftime("%Y-%m-%d %H:%M") %></td>
              <td>
                <% case req.status %>
                  <% when 'pending' %>
                    <span class="rp-badge rp-badge-warning">대기 중</span>
                  <% when 'approved' %>
                    <span class="rp-badge rp-badge-success">승인됨</span>
                  <% when 'rejected' %>
                    <span class="rp-badge rp-badge-danger">거절됨</span>
                  <% when 'completed' %>
                    <span class="rp-badge rp-badge-secondary">완료됨</span>
                <% end %>
              </td>
              <td><%= req.created_at.strftime("%Y-%m-%d") %></td>
              <td onclick="event.stopPropagation();">
                <%= link_to "상세보기", diagnostic_teacher_consultation_request_path(req), class: "rp-btn rp-btn-small" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>

      <!-- 페이지네이션 -->
      <div class="rp-pagination">
        <% if @consultation_requests.first_page? %>
          <span class="rp-pagination-btn disabled">처음</span>
          <span class="rp-pagination-btn disabled">이전</span>
        <% else %>
          <%= link_to "처음", diagnostic_teacher_consultation_requests_path(status: @status_filter, search: @search_query, page: 1), class: "rp-pagination-btn" %>
          <%= link_to "이전", diagnostic_teacher_consultation_requests_path(status: @status_filter, search: @search_query, page: @consultation_requests.prev_page), class: "rp-pagination-btn" %>
        <% end %>

        <% (1..@consultation_requests.total_pages).each do |page| %>
          <% if page == @consultation_requests.current_page %>
            <span class="rp-pagination-btn active"><%= page %></span>
          <% else %>
            <%= link_to page, diagnostic_teacher_consultation_requests_path(status: @status_filter, search: @search_query, page: page), class: "rp-pagination-btn" %>
          <% end %>
        <% end %>

        <% if @consultation_requests.last_page? %>
          <span class="rp-pagination-btn disabled">다음</span>
          <span class="rp-pagination-btn disabled">마지막</span>
        <% else %>
          <%= link_to "다음", diagnostic_teacher_consultation_requests_path(status: @status_filter, search: @search_query, page: @consultation_requests.next_page), class: "rp-pagination-btn" %>
          <%= link_to "마지막", diagnostic_teacher_consultation_requests_path(status: @status_filter, search: @search_query, page: @consultation_requests.total_pages), class: "rp-pagination-btn" %>
        <% end %>
      </div>
    <% else %>
      <div class="rp-empty-state">
        <p>상담 신청이 없습니다.</p>
      </div>
    <% end %>
  </div>
</div>

<style>
  .rp-filter-form {
    display: flex;
    gap: 16px;
    margin-bottom: 24px;
  }

  .rp-filter-group {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    align-items: flex-end;
  }

  .rp-filter-item {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .rp-filter-item label {
    font-weight: 500;
    font-size: 14px;
    color: #333;
  }

  .rp-filter-item input,
  .rp-filter-item select {
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 14px;
    min-width: 150px;
  }

  .rp-table-row {
    cursor: pointer;
    transition: background-color 0.2s;
  }

  .rp-table-row:hover {
    background-color: #f5f5f5;
  }

  .rp-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 16px;
    margin-bottom: 32px;
  }

  .rp-stat-card {
    background: #f9f9f9;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 16px;
    text-align: center;
  }

  .rp-stat-value {
    font-size: 32px;
    font-weight: bold;
    color: #1976d2;
    margin-bottom: 8px;
  }

  .rp-stat-label {
    font-size: 14px;
    color: #666;
  }

  .rp-empty-state {
    text-align: center;
    padding: 48px 24px;
    color: #999;
    font-size: 16px;
  }
</style>
