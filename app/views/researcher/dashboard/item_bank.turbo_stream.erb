<!-- Phase 3.1: Turbo Stream responses for item bank search/filter updates -->
<!-- Phase 3.4.3: Support partial row updates for component caching -->
<!-- This template is rendered when format.turbo_stream is requested -->
<!-- It updates the page without full reload -->

<!-- Primary update: Full table replacement on filter/search changes -->
<turbo-stream action="replace" target="items-table">
  <template>
    <%= render "items_table" %>
  </template>
</turbo-stream>

<!-- Phase 3.4.3: Partial row updates (for individual item changes) -->
<!-- When a single item is updated/created, only update that specific row -->
<!-- This preserves cache for other rows and reduces re-rendering overhead -->
<!-- Usage: Set @updated_items array to list of items to update individually -->
<% if @updated_items.present? %>
  <% @updated_items.each do |item| %>
    <turbo-stream action="replace" target="<%= dom_id_for_item(item) %>">
      <template>
        <!-- Phase 3.4.3: Row-level fragment caching -->
        <!-- Cache invalidation happens via Item#after_save callback -->
        <% cache(cache_key_for_item(item), expires_in: 1.hour) do %>
          <tr id="<%= dom_id_for_item(item) %>" onclick="location.href='<%= edit_researcher_item_path(item) %>'">
            <td><strong><%= item.code %></strong></td>
            <td style="font-size: 12px; color: #666;">
              <%= truncate(strip_tags(item.prompt), length: 100) %>
            </td>
            <td>
              <% if item.evaluation_indicator %>
                <%= item.evaluation_indicator.name %>
              <% else %>
                <span style="color: #ccc;">미지정</span>
              <% end %>
            </td>
            <td>
              <span class="type-badge <%= "type-#{item.item_type}" %>">
                <%= item.item_type == 'mcq' ? '객관식' : '주관식' %>
              </span>
            </td>
            <td><%= item.difficulty || '-' %></td>
            <td>
              <span class="status-badge <%= "status-#{item.status}" %>">
                <%= item.status == 'draft' ? '준비중' : (item.status == 'active' ? '활성' : '폐기') %>
              </span>
            </td>
          </tr>
        <% end %>
      </template>
    </turbo-stream>
  <% end %>
<% end %>

<!-- Stats update on filter/search changes -->
<turbo-stream action="replace" target="stats">
  <template>
    <div class="stats-row">
      <span>전체: <strong><%= @total_count %></strong>건</span>
      <span>페이지: <strong><%= @page %> / <%= @total_pages %></strong></span>
    </div>
  </template>
</turbo-stream>
