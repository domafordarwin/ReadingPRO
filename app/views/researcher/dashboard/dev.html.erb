<% content_for :portal_title do %>
  ê°œë°œì í¬í„¸
<% end %>
<parameter name="content"><% content_for :portal_subtitle do %>
  Researcher í¬í„¸ êµ¬ì¡° ë° ê°œë°œ ê°€ì´ë“œ
<% end %>
<% content_for :portal_nav do %>
  <%= render "researcher/shared/nav", current: :dashboard %>
<% end %>

<style>
  .dev-portal {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  }

  .dev-section {
    background: white;
    border: 2px solid #e0e0e0;
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 24px;
  }

  .dev-section__title {
    font-size: var(--rp-font-size-xl);
    font-weight: var(--rp-font-weight-bold);
    color: #333;
    margin: 0 0 20px 0;
    padding-bottom: 12px;
    border-bottom: 3px solid #667eea;
  }

  .dev-table {
    width: 100%;
    border-collapse: collapse;
    margin: 16px 0;
  }

  .dev-table th {
    background: #f8f9fa;
    padding: 12px;
    text-align: left;
    font-size: var(--rp-font-size-sm);
    font-weight: var(--rp-font-weight-semibold);
    color: #666;
    border: 1px solid #e0e0e0;
  }

  .dev-table td {
    padding: 12px;
    border: 1px solid #e0e0e0;
    font-size: var(--rp-font-size-base);
    color: #333;
  }

  .dev-code {
    background: #f8f9fa;
    padding: 2px 6px;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    font-size: var(--rp-font-size-sm);
    color: #e83e8c;
  }

  .dev-badge {
    display: inline-block;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: var(--rp-font-size-2xs);
    font-weight: var(--rp-font-weight-semibold);
    text-transform: uppercase;
  }

  .dev-badge--get { background: #28a745; color: white; }
  .dev-badge--post { background: #007bff; color: white; }
  .dev-badge--patch { background: #ffc107; color: black; }
  .dev-badge--delete { background: #dc3545; color: white; }
  .dev-badge--card { background: #667eea; color: white; }
  .dev-badge--table { background: #764ba2; color: white; }

  .dev-flow {
    background: #f0f4ff;
    border-left: 4px solid #667eea;
    padding: 16px;
    margin: 16px 0;
    font-family: monospace;
    font-size: var(--rp-font-size-sm);
    line-height: 1.8;
  }

  .dev-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
    margin: 16px 0;
  }

  .dev-card {
    background: #f8f9fa;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 16px;
  }

  .dev-card__title {
    font-size: var(--rp-font-size-base);
    font-weight: var(--rp-font-weight-semibold);
    color: #667eea;
    margin-bottom: 8px;
  }

  .dev-card__content {
    font-size: var(--rp-font-size-sm);
    color: #666;
    line-height: 1.6;
  }

  .dev-list {
    list-style: none;
    padding: 0;
    margin: 12px 0;
  }

  .dev-list li {
    padding: 8px 0;
    border-bottom: 1px solid #f0f0f0;
  }

  .dev-list li:before {
    content: "â–¸";
    color: #667eea;
    font-weight: bold;
    margin-right: 8px;
  }

  .dev-highlight {
    background: #fff3cd;
    border-left: 4px solid #ffc107;
    padding: 12px;
    margin: 12px 0;
    font-size: var(--rp-font-size-sm);
  }

  @media (max-width: 1024px) {
    .dev-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 768px) {
    .dev-grid {
      grid-template-columns: 1fr;
    }
  }
</style>

<div class="portal-card dev-portal">
  <h1 style="font-size: var(--rp-font-size-2xl); font-weight: var(--rp-font-weight-bold); color: #333; margin-bottom: 8px;">
    ğŸš€ Researcher í¬í„¸ ê°œë°œ ê°€ì´ë“œ
  </h1>
  <p style="color: #666; margin-bottom: 32px;">
    Reading PRO Researcher í¬í„¸ì˜ ì „ì²´ êµ¬ì¡°ì™€ ê°œë°œ ê·œì¹™ì„ ë¬¸ì„œí™”í•©ë‹ˆë‹¤.
  </p>

  <!-- í¬í„¸ êµ¬ì¡° -->
  <div class="dev-section">
    <h2 class="dev-section__title">ğŸ“Š í¬í„¸ êµ¬ì¡° ê°œìš”</h2>

    <table class="dev-table">
      <thead>
        <tr>
          <th>í˜ì´ì§€</th>
          <th>URL</th>
          <th>Controller#Action</th>
          <th>ë ˆì´ì•„ì›ƒ</th>
          <th>ì£¼ìš” ê¸°ëŠ¥</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>ëŒ€ì‹œë³´ë“œ</strong></td>
          <td><code class="dev-code">/researcher</code></td>
          <td><code class="dev-code">dashboard#index</code></td>
          <td><span class="dev-badge dev-badge--card">ì¹´ë“œ</span></td>
          <td>í†µê³„ + ë¹ ë¥¸ ì•¡ì…˜ + ìµœê·¼ í™œë™</td>
        </tr>
        <tr>
          <td><strong>í‰ê°€ ì˜ì—­</strong></td>
          <td><code class="dev-code">/researcher/evaluation</code></td>
          <td><code class="dev-code">dashboard#evaluation</code></td>
          <td><span class="dev-badge dev-badge--card">ì¹´ë“œ</span></td>
          <td>EvaluationIndicator ê´€ë¦¬</td>
        </tr>
        <tr>
          <td><strong>ë¬¸í•­ ì€í–‰</strong></td>
          <td><code class="dev-code">/researcher/item_bank</code></td>
          <td><code class="dev-code">dashboard#item_bank</code></td>
          <td><span class="dev-badge dev-badge--card">ì¹´ë“œ</span></td>
          <td>ì™„ì„±ëœ ë¬¸í•­ (stimulus_id â‰  NULL)</td>
        </tr>
        <tr>
          <td><strong>ì§€ë¬¸ ê´€ë¦¬</strong></td>
          <td><code class="dev-code">/researcher/passages</code></td>
          <td><code class="dev-code">dashboard#passages</code></td>
          <td><span class="dev-badge dev-badge--card">ì¹´ë“œ</span></td>
          <td>ReadingStimulus CRUD</td>
        </tr>
        <tr>
          <td><strong>ë¬¸í•­ ê´€ë¦¬</strong></td>
          <td><code class="dev-code">/researcher/items</code></td>
          <td><code class="dev-code">items#index</code></td>
          <td><span class="dev-badge dev-badge--table">í…Œì´ë¸”</span></td>
          <td>ëª¨ë“  ë¬¸í•­ ê´€ë¦¬ + í•„í„°/ê²€ìƒ‰</td>
        </tr>
        <tr>
          <td><strong>ë¬¸í•­ ë“±ë¡</strong></td>
          <td><code class="dev-code">/researcher/item_create</code></td>
          <td><code class="dev-code">dashboard#item_create</code></td>
          <td><span class="dev-badge dev-badge--card">í¼</span></td>
          <td>ìƒˆ ë¬¸í•­ ìƒì„±</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- ë°ì´í„° ëª¨ë¸ -->
  <div class="dev-section">
    <h2 class="dev-section__title">ğŸ—„ï¸ í•µì‹¬ ë°ì´í„° ëª¨ë¸</h2>

    <div class="dev-grid">
      <div class="dev-card">
        <div class="dev-card__title">Item (ë¬¸í•­)</div>
        <div class="dev-card__content">
          <strong>ì£¼ìš” ì»¬ëŸ¼:</strong><br>
          â€¢ code, item_type, prompt<br>
          â€¢ difficulty, status<br>
          â€¢ stimulus_id (FK)<br>
          â€¢ evaluation_indicator_id (FK)<br>
          <br>
          <strong>ê´€ê³„:</strong><br>
          belongs_to :stimulus<br>
          has_many :item_choices<br>
          has_one :rubric
        </div>
      </div>

      <div class="dev-card">
        <div class="dev-card__title">ReadingStimulus (ì§€ë¬¸)</div>
        <div class="dev-card__content">
          <strong>ì£¼ìš” ì»¬ëŸ¼:</strong><br>
          â€¢ title, body<br>
          â€¢ source, word_count<br>
          â€¢ reading_level<br>
          â€¢ items_count (counter_cache)<br>
          <br>
          <strong>ê´€ê³„:</strong><br>
          has_many :items
        </div>
      </div>

      <div class="dev-card">
        <div class="dev-card__title">EvaluationIndicator</div>
        <div class="dev-card__content">
          <strong>ì£¼ìš” ì»¬ëŸ¼:</strong><br>
          â€¢ code, name, description<br>
          <br>
          <strong>ê´€ê³„:</strong><br>
          has_many :sub_indicators<br>
          has_many :items
        </div>
      </div>
    </div>
  </div>

  <!-- ë°ì´í„° íë¦„ -->
  <div class="dev-section">
    <h2 class="dev-section__title">ğŸ”„ ë°ì´í„° íë¦„</h2>

    <h3 style="font-size: var(--rp-font-size-md); font-weight: var(--rp-font-weight-semibold); margin: 20px 0 12px 0;">1ï¸âƒ£ ë¬¸í•­ ìƒì„± íë¦„</h3>
    <div class="dev-flow">
[ë¬¸í•­ ê´€ë¦¬] â†’ [+ ìƒˆ ë¬¸í•­ ì¶”ê°€] ë²„íŠ¼ í´ë¦­
    â†“
[ë¬¸í•­ ë“±ë¡ í¼] (item_create)
- ê¸°ë³¸ ì •ë³´: code, item_type, difficulty
- í‰ê°€ ì§€í‘œ: evaluation_indicator_id, sub_indicator_id
- ë¬¸í•­ ë‚´ìš©: prompt, explanation
- ì—°ê²°: stimulus_id (ì„ íƒ), status
    â†“
POST /researcher/items (items#create)
    â†“
ì„±ê³µ ì‹œ â†’ redirect_to edit_researcher_item_path
(ì •ë‹µ/ë£¨ë¸Œë¦­ ì…ë ¥ ë‹¨ê³„)
    </div>

    <h3 style="font-size: var(--rp-font-size-md); font-weight: var(--rp-font-weight-semibold); margin: 20px 0 12px 0;">2ï¸âƒ£ ì™„ì„±ëœ ë¬¸í•­ vs ë¯¸ì™„ì„± ë¬¸í•­</h3>
    <div class="dev-flow">
ë¬¸í•­ ìƒì„± (stimulus_id = NULL)
    â†“
ë¬¸í•­ ê´€ë¦¬ì—ë§Œ í‘œì‹œ
    â†“
ì§€ë¬¸ ì—°ê²° (stimulus_id ì„¤ì •)
    â†“
ë¬¸í•­ ì€í–‰ì— í‘œì‹œ (ì¹´ë“œ ë·°)
+ ë¬¸í•­ ê´€ë¦¬ì—ë„ í‘œì‹œ (í…Œì´ë¸” ë·°)
    </div>

    <h3 style="font-size: var(--rp-font-size-md); font-weight: var(--rp-font-weight-semibold); margin: 20px 0 12px 0;">3ï¸âƒ£ ì§€ë¬¸ ì‚­ì œ CASCADE</h3>
    <div class="dev-flow">
ReadingStimulus ì‚­ì œ
    â†“ (dependent: :destroy)
ì—°ê²°ëœ Item ì‚­ì œ
    â†“
Rubric, ItemChoice ì‚­ì œ
    â†“
Response, RubricLevel ì‚­ì œ
    </div>
    <div class="dev-highlight">
      âš ï¸ <strong>ì„±ëŠ¥ ì£¼ì˜:</strong> ì§€ë¬¸ 1ê°œ ì‚­ì œ ì‹œ 10ê°œ ë¬¸í•­ = 100-500+ DELETE ì¿¼ë¦¬ ë°œìƒ<br>
      â†’ UI: delete-loading Stimulus controllerë¡œ ë¡œë”© ì¸ë””ì¼€ì´í„° í‘œì‹œ
    </div>
  </div>

  <!-- API Routes -->
  <div class="dev-section">
    <h2 class="dev-section__title">ğŸ›£ï¸ ì£¼ìš” Routes</h2>

    <table class="dev-table">
      <thead>
        <tr>
          <th>HTTP</th>
          <th>Path</th>
          <th>Controller#Action</th>
          <th>ì„¤ëª…</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><span class="dev-badge dev-badge--get">GET</span></td>
          <td><code class="dev-code">/researcher/items</code></td>
          <td><code class="dev-code">items#index</code></td>
          <td>ë¬¸í•­ ëª©ë¡ (í•„í„°/ê²€ìƒ‰)</td>
        </tr>
        <tr>
          <td><span class="dev-badge dev-badge--post">POST</span></td>
          <td><code class="dev-code">/researcher/items</code></td>
          <td><code class="dev-code">items#create</code></td>
          <td>ë¬¸í•­ ìƒì„±</td>
        </tr>
        <tr>
          <td><span class="dev-badge dev-badge--get">GET</span></td>
          <td><code class="dev-code">/researcher/items/:id/edit</code></td>
          <td><code class="dev-code">items#edit</code></td>
          <td>ë¬¸í•­ í¸ì§‘ (ì •ë‹µ/ë£¨ë¸Œë¦­)</td>
        </tr>
        <tr>
          <td><span class="dev-badge dev-badge--patch">PATCH</span></td>
          <td><code class="dev-code">/researcher/items/:id</code></td>
          <td><code class="dev-code">items#update</code></td>
          <td>ë¬¸í•­ ì—…ë°ì´íŠ¸</td>
        </tr>
        <tr>
          <td><span class="dev-badge dev-badge--delete">DELETE</span></td>
          <td><code class="dev-code">/researcher/items/:id</code></td>
          <td><code class="dev-code">items#destroy</code></td>
          <td>ë¬¸í•­ ì‚­ì œ</td>
        </tr>
        <tr>
          <td><span class="dev-badge dev-badge--get">GET</span></td>
          <td><code class="dev-code">/researcher/stimuli/new</code></td>
          <td><code class="dev-code">stimuli#new</code></td>
          <td>ì§€ë¬¸ ìƒì„± í¼</td>
        </tr>
        <tr>
          <td><span class="dev-badge dev-badge--post">POST</span></td>
          <td><code class="dev-code">/researcher/stimuli</code></td>
          <td><code class="dev-code">stimuli#create</code></td>
          <td>ì§€ë¬¸ ìƒì„±</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- ì„±ëŠ¥ ìµœì í™” -->
  <div class="dev-section">
    <h2 class="dev-section__title">âš¡ ì„±ëŠ¥ ìµœì í™”</h2>

    <h3 style="font-size: var(--rp-font-size-md); font-weight: var(--rp-font-weight-semibold); margin: 20px 0 12px 0;">1ï¸âƒ£ Counter Cache</h3>
    <pre style="background: #f8f9fa; padding: 12px; border-radius: 4px; overflow-x: auto;"><code># reading_stimuli í…Œì´ë¸”
items_count (integer, default: 0)

# Item ëª¨ë¸
belongs_to :stimulus, counter_cache: :items_count</code></pre>

    <h3 style="font-size: var(--rp-font-size-md); font-weight: var(--rp-font-weight-semibold); margin: 20px 0 12px 0;">2ï¸âƒ£ Eager Loading</h3>
    <pre style="background: #f8f9fa; padding: 12px; border-radius: 4px; overflow-x: auto;"><code># items#index
Item.includes(:stimulus, :item_choices, rubric: { rubric_criteria: :rubric_levels })

# dashboard#index
Item.includes(:stimulus).order(created_at: :desc).limit(5)</code></pre>

    <h3 style="font-size: var(--rp-font-size-md); font-weight: var(--rp-font-weight-semibold); margin: 20px 0 12px 0;">3ï¸âƒ£ Keyset Pagination (item_bank)</h3>
    <pre style="background: #f8f9fa; padding: 12px; border-radius: 4px; overflow-x: auto;"><code>KeysetPaginationService.new(@items_relation, per_page: 25)
  .fetch_page(cursor: @cursor, direction: @direction)

# O(1) ì„±ëŠ¥ - OFFSET ì‚¬ìš© ì•ˆ í•¨</code></pre>

    <h3 style="font-size: var(--rp-font-size-md); font-weight: var(--rp-font-weight-semibold); margin: 20px 0 12px 0;">4ï¸âƒ£ HTTP Caching (item_bank)</h3>
    <pre style="background: #f8f9fa; padding: 12px; border-radius: 4px; overflow-x: auto;"><code>fresh_when(etag: etag, last_modified: Item.maximum(:updated_at))

# 304 Not Modified ì‘ë‹µìœ¼ë¡œ 60-80% ì ˆì•½</code></pre>
  </div>

  <!-- Turbo í˜¸í™˜ì„± -->
  <div class="dev-section">
    <h2 class="dev-section__title">ğŸš„ Rails 8.1 + Turbo í˜¸í™˜ì„±</h2>

    <div class="dev-highlight">
      âš ï¸ <strong>ì¤‘ìš”:</strong> Rails 8.1 í™˜ê²½ì—ì„œ TurboëŠ” ëª¨ë“  í¼ê³¼ ë§í¬ë¥¼ AJAXë¡œ ìë™ ë³€í™˜í•©ë‹ˆë‹¤.
    </div>

    <h3 style="font-size: var(--rp-font-size-md); font-weight: var(--rp-font-weight-semibold); margin: 20px 0 12px 0;">âœ… ì˜¬ë°”ë¥¸ ì‚¬ìš©ë²•</h3>
    <pre style="background: #f8f9fa; padding: 12px; border-radius: 4px; overflow-x: auto;"><code># ì‚­ì œ ë§í¬
<%= link_to "ì‚­ì œ", path,
    data: { turbo_method: :delete, turbo_confirm: "ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?" } %>

# í‘œì¤€ í¼ ì œì¶œ (ë¡œê·¸ì¸ ë“±)
<%= form_with data: { turbo: false }, onsubmit: "return true;" do %>

# Stimulus controller
import DeleteLoadingController from "controllers/delete_loading_controller"
application.register("delete-loading", DeleteLoadingController)</code></pre>

    <h3 style="font-size: var(--rp-font-size-md); font-weight: var(--rp-font-weight-semibold); margin: 20px 0 12px 0;">âŒ í”¼í•´ì•¼ í•  íŒ¨í„´</h3>
    <pre style="background: #f8f9fa; padding: 12px; border-radius: 4px; overflow-x: auto;"><code># method: :delete (ì‘ë™ ì•ˆ í•¨)
<%= link_to "ì‚­ì œ", path, method: :delete %>

# ì¸ë¼ì¸ script (CSP ìœ„ë°˜)
<script>
  document.addEventListener('turbo:before-fetch-request', ...)
</script></code></pre>
  </div>

  <!-- ê°œë°œ ì›ì¹™ -->
  <div class="dev-section">
    <h2 class="dev-section__title">ğŸ“œ ê°œë°œ ì›ì¹™</h2>

    <ul class="dev-list">
      <li><strong>ìŠ¤í‚¤ë§ˆ ë¨¼ì € í™•ì¸:</strong> <code class="dev-code">rails runner "puts Item.column_names"</code></li>
      <li><strong>ì„±ëŠ¥ ê³ ë ¤:</strong> Counter cache ìš°ì„ , N+1 ì¿¼ë¦¬ ë°©ì§€</li>
      <li><strong>Turbo ì¸ì§€:</strong> data-turbo-method ì‚¬ìš©, í•„ìš”ì‹œ data-turbo="false"</li>
      <li><strong>ë¬¸ì„œí™”:</strong> ì¤‘ìš” ë³€ê²½ì‚¬í•­ì€ CLAUDE.md ë° docs/raw_dataì— ê¸°ë¡</li>
      <li><strong>í…ŒìŠ¤íŠ¸:</strong> ë³€ê²½ í›„ Rails ì„œë²„ ì¬ì‹œì‘ ë° ë¸Œë¼ìš°ì € ìºì‹œ í´ë¦¬ì–´</li>
    </ul>
  </div>

  <!-- ë¹ ë¥¸ ì°¸ì¡° -->
  <div class="dev-section">
    <h2 class="dev-section__title">ğŸ”— ë¹ ë¥¸ ì°¸ì¡°</h2>

    <div class="dev-grid">
      <div class="dev-card">
        <div class="dev-card__title">ë¬¸ì„œ</div>
        <div class="dev-card__content">
          â€¢ CLAUDE.md<br>
          â€¢ docs/raw_data/<br>
          â€¢ docs/QUICK_ERROR_REFERENCE.md
        </div>
      </div>

      <div class="dev-card">
        <div class="dev-card__title">ì£¼ìš” íŒŒì¼</div>
        <div class="dev-card__content">
          â€¢ config/routes.rb<br>
          â€¢ app/controllers/researcher/<br>
          â€¢ app/views/researcher/
        </div>
      </div>

      <div class="dev-card">
        <div class="dev-card__title">Stimulus Controllers</div>
        <div class="dev-card__content">
          â€¢ delete_loading_controller.js<br>
          â€¢ research_search_controller.js<br>
          â€¢ application.js
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div style="text-align: center; padding: 32px 0; color: #999; font-size: var(--rp-font-size-sm);">
    <p>ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2026-02-04</p>
    <p>Reading PRO Researcher Portal v2.0</p>
  </div>
</div>
