<% content_for :portal_title do %>
  정답/루브릭 관리
<% end %>
<% content_for :portal_subtitle do %>
  문항별 정답 및 루브릭 내용을 확인하고 수정할 수 있습니다.
<% end %>
<% content_for :portal_nav do %>
  <%= render "researcher/shared/nav", current: :items %>
<% end %>

<section class="portal-card">
  <h2 class="portal-card-title">검색/필터</h2>
  <%= form_with url: researcher_items_path, method: :get, local: true, class: "portal-form portal-form-inline" do %>
    <label>
      키워드
      <input type="text" name="q" value="<%= params[:q] %>" placeholder="문항 코드 또는 내용">
    </label>
    <label>
      문항 유형
      <select name="item_type">
        <option value="">전체</option>
        <option value="mcq" <%= "selected" if params[:item_type] == "mcq" %>>객관식</option>
        <option value="constructed" <%= "selected" if params[:item_type] == "constructed" %>>서술형</option>
      </select>
    </label>
    <label>
      루브릭
      <select name="rubric">
        <option value="">전체</option>
        <option value="with" <%= "selected" if params[:rubric] == "with" %>>있음</option>
        <option value="without" <%= "selected" if params[:rubric] == "without" %>>없음</option>
      </select>
    </label>
    <div class="portal-cta">
      <button type="submit" class="portal-button">필터 적용</button>
      <%= link_to "초기화", researcher_items_path, class: "portal-button secondary" %>
    </div>
  <% end %>
</section>

<section class="portal-card">
  <h2 class="portal-card-title">문항 목록</h2>
  <p class="portal-muted">총 <%= @total_count %>건 · <%= @page %> / <%= @total_pages %> 페이지</p>
  <table class="portal-table">
    <thead>
      <tr>
        <th>코드</th>
        <th>유형</th>
        <th>정답 수</th>
        <th>루브릭</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <% @items.each do |item| %>
        <tr>
          <td><%= item.code %></td>
          <td><%= item.item_type %></td>
          <td><%= item.item_sample_answers.size %></td>
          <td><%= item.rubric.present? ? "있음" : "없음" %></td>
          <td><%= link_to "수정", edit_researcher_item_path(item), class: "portal-button secondary" %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
  <% if @total_pages > 1 %>
    <div class="portal-pagination">
      <% (1..@total_pages).each do |page| %>
        <%= link_to page,
                    researcher_items_path(params.permit(:q, :item_type, :rubric).merge(page: page)),
                    class: "portal-page#{' is-active' if page == @page}" %>
      <% end %>
    </div>
  <% end %>
</section>
