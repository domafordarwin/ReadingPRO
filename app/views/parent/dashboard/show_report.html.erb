<% content_for :portal_title do %>
  ì§„ë‹¨ ê²°ê³¼ ë¦¬í¬íŠ¸ ìƒì„¸
<% end %>

<% content_for :portal_subtitle do %>
  <%= @student.name %> í•™ìƒì˜ ìƒì„¸ ë¦¬í¬íŠ¸ì…ë‹ˆë‹¤.
<% end %>

<% content_for :portal_nav do %>
  <%= render "parent/shared/nav", current: :reports %>
<% end %>

<style>
  /* ê¸°ë³¸ ë³€ìˆ˜ ë° ìŠ¤íƒ€ì¼ */
  :root {
    --rp-primary: #667eea;
    --rp-primary-light: #764ba2;
    --rp-primary-dark: #4c51bf;
    --rp-accent: #667eea;
    --rp-accent-light: #e0e7ff;
    --rp-warm-cream: #f8f9ff;
    --rp-warm-beige: #f0f1ff;
    --rp-text-dark: #1a202c;
    --rp-text-medium: #4a5568;
    --rp-text-light: #718096;
    --rp-border: #cbd5e0;
    --rp-success: #48bb78;
    --rp-warning: #ed8936;
    --rp-info: #4299e1;
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  html {
    scroll-behavior: smooth;
  }

  /* í—¤ë” ìŠ¤íƒ€ì¼ */
  .report-header-section {
    background: linear-gradient(135deg, var(--rp-primary) 0%, var(--rp-primary-light) 100%);
    color: white;
    padding: 48px 24px;
    border-radius: 12px;
    margin-bottom: 32px;
    position: relative;
    overflow: hidden;
  }

  .report-header-section::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -10%;
    width: 50%;
    height: 200%;
    background: rgba(255,255,255,0.08);
    transform: rotate(-15deg);
  }

  .report-header-org {
    display: none;
    align-items: center;
    gap: 16px;
    margin-bottom: 32px;
    position: relative;
    z-index: 1;
  }

  .report-header-org .icon {
    width: 48px;
    height: 48px;
    background: rgba(255,255,255,0.15);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
  }

  .report-header-org .text {
    font-size: 14px;
    opacity: 0.95;
  }

  .report-header-org .text strong {
    display: block;
    font-size: 16px;
    font-weight: 700;
    opacity: 1;
  }

  .report-header-title {
    text-align: center;
    margin-bottom: 36px;
    position: relative;
    z-index: 1;
  }

  .report-header-title h1 {
    font-size: 32px;
    font-weight: 700;
    margin-bottom: 8px;
    letter-spacing: -0.5px;
  }

  .report-header-title p {
    font-size: 16px;
    opacity: 0.95;
  }

  .report-header-student-card {
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
    border-radius: 16px;
    padding: 28px;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 24px;
    position: relative;
    z-index: 1;
  }

  .student-info-item {
    text-align: center;
  }

  .student-info-item label {
    display: block;
    font-size: 12px;
    opacity: 0.85;
    margin-bottom: 6px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 500;
  }

  .student-info-item .value {
    font-size: 20px;
    font-weight: 700;
  }

  .student-info-item .value.highlight {
    color: #ffeb3b;
  }

  /* ë„¤ë¹„ê²Œì´ì…˜ ìŠ¤íƒ€ì¼ */
  .report-nav {
    position: sticky;
    top: 0;
    background: white;
    border-bottom: 2px solid var(--rp-accent-light);
    padding: 12px 20px;
    margin: 0 -20px 50px;
    z-index: 100;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  }

  .report-nav ul {
    display: flex;
    list-style: none;
    gap: 8px;
    max-width: 1200px;
    margin: 0 auto;
    flex-wrap: wrap;
  }

  .report-nav a {
    display: block;
    padding: 8px 16px;
    color: var(--rp-text-medium);
    text-decoration: none;
    font-size: 14px;
    font-weight: 500;
    border-radius: 6px;
    transition: all 0.3s ease;
  }

  .report-nav a:hover {
    background: var(--rp-accent-light);
    color: var(--rp-primary);
  }

  .report-nav a.active {
    background: var(--rp-primary);
    color: white;
  }

  /* ì„¹ì…˜ ê³µí†µ ìŠ¤íƒ€ì¼ */
  .report-section {
    background: white;
    border-radius: 12px;
    padding: 32px;
    margin-bottom: 28px;
    border: 1px solid var(--rp-border);
  }

  .report-section-header {
    margin-bottom: 28px;
  }

  .report-section-label {
    display: inline-block;
    background: var(--rp-primary);
    color: white;
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    margin-bottom: 12px;
  }

  .report-section-title {
    font-size: 24px;
    font-weight: 700;
    color: var(--rp-text-dark);
    margin-bottom: 8px;
  }

  .report-section-desc {
    color: var(--rp-text-medium);
    font-size: 14px;
  }

  /* ì¢…í•© ê²°ê³¼ ì„¹ì…˜ */
  .summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 28px;
  }

  .summary-card {
    background: linear-gradient(135deg, var(--rp-warm-beige) 0%, var(--rp-accent-light) 100%);
    border-radius: 12px;
    padding: 24px;
    text-align: center;
    border: 1px solid var(--rp-border);
    transition: all 0.3s ease;
  }

  .summary-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 20px rgba(102, 126, 234, 0.15);
  }

  .summary-card .icon {
    font-size: 32px;
    margin-bottom: 12px;
  }

  .summary-card .score {
    font-size: 36px;
    font-weight: 700;
    color: var(--rp-primary);
    margin-bottom: 8px;
  }

  .summary-card .label {
    font-size: 14px;
    font-weight: 600;
    color: var(--rp-text-medium);
  }

  .summary-message {
    background: linear-gradient(135deg, var(--rp-warm-beige) 0%, var(--rp-accent-light) 100%);
    border-radius: 12px;
    padding: 24px;
    border-left: 5px solid var(--rp-primary);
  }

  .summary-message h3 {
    font-size: 16px;
    font-weight: 700;
    color: var(--rp-text-dark);
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .summary-message p {
    color: var(--rp-text-medium);
    font-size: 14px;
    line-height: 1.6;
  }

  /* ë…ì ìœ í˜• ì„¹ì…˜ */
  .type-card {
    background: linear-gradient(135deg, var(--rp-primary) 0%, var(--rp-primary-light) 100%);
    color: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 16px rgba(102, 126, 234, 0.2);
  }

  .type-card-header {
    padding: 32px;
    text-align: center;
  }

  .type-card-header h3 {
    font-size: 18px;
    opacity: 0.95;
    margin-bottom: 12px;
    font-weight: 500;
  }

  .type-card-header .type-name {
    font-size: 40px;
    font-weight: 700;
    margin-bottom: 12px;
  }

  .type-card-header p {
    font-size: 14px;
    opacity: 0.9;
    line-height: 1.6;
  }

  .type-features-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 16px;
  }

  .type-feature {
    padding: 16px;
    background: var(--rp-warm-cream);
    border-radius: 8px;
    border: 1px solid var(--rp-border);
  }

  .type-feature h4 {
    font-size: 14px;
    font-weight: 700;
    color: var(--rp-primary);
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .type-feature p {
    font-size: 13px;
    color: var(--rp-text-medium);
  }

  /* ìƒì„¸ ë¶„ì„ ì„¹ì…˜ */
  .analysis-table-container {
    overflow-x: auto;
    margin-bottom: 20px;
  }

  .analysis-table {
    width: 100%;
    border-collapse: collapse;
    min-width: 600px;
  }

  .analysis-table th {
    background: var(--rp-primary);
    color: white;
    padding: 14px 12px;
    text-align: left;
    font-weight: 600;
    font-size: 13px;
  }

  .analysis-table td {
    padding: 14px 12px;
    border-bottom: 1px solid var(--rp-border);
    font-size: 13px;
    vertical-align: middle;
  }

  .analysis-table tbody tr:hover {
    background: var(--rp-warm-cream);
  }

  .analysis-table tbody tr:last-child td {
    border-bottom: none;
  }

  .status-badge {
    display: inline-block;
    padding: 5px 12px;
    border-radius: 16px;
    font-size: 12px;
    font-weight: 600;
  }

  .status-badge.excellent { background: #c6f6d5; color: #22543d; }
  .status-badge.good { background: #bee3f8; color: #2c5282; }
  .status-badge.needs-improvement { background: #feebc8; color: #7c2d12; }

  .progress-bar {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .progress-bar .bar {
    flex: 1;
    height: 6px;
    background: #e2e8f0;
    border-radius: 3px;
    overflow: hidden;
  }

  .progress-bar .fill {
    height: 100%;
    background: var(--rp-primary);
    border-radius: 3px;
  }

  .progress-bar .value {
    font-weight: 700;
    color: var(--rp-text-dark);
    min-width: 45px;
    text-align: right;
    font-size: 12px;
  }

  /* ê°€ì • ì§€ë„ ì„¹ì…˜ */
  .guidance-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
  }

  .guidance-card {
    background: white;
    border-radius: 12px;
    padding: 24px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    border-top: 4px solid var(--rp-primary);
  }

  .guidance-card h3 {
    font-size: 16px;
    font-weight: 700;
    color: var(--rp-text-dark);
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .guidance-card h3 .icon {
    width: 32px;
    height: 32px;
    background: var(--rp-accent-light);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
  }

  .guidance-card p {
    color: var(--rp-text-medium);
    font-size: 13px;
    margin-bottom: 12px;
  }

  .guidance-card ul {
    list-style: none;
  }

  .guidance-card ul li {
    padding: 8px 0;
    padding-left: 20px;
    position: relative;
    color: var(--rp-text-medium);
    font-size: 12px;
    border-bottom: 1px solid var(--rp-border);
  }

  .guidance-card ul li:last-child {
    border-bottom: none;
  }

  .guidance-card ul li::before {
    content: 'âœ“';
    position: absolute;
    left: 0;
    color: var(--rp-success);
    font-weight: 700;
  }

  .recommended-activities {
    background: white;
    border-radius: 12px;
    padding: 24px;
    margin-top: 20px;
    border: 2px solid var(--rp-primary);
  }

  .recommended-activities h3 {
    font-size: 16px;
    font-weight: 700;
    color: var(--rp-primary);
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .activity-list {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 12px;
  }

  .activity-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px;
    background: var(--rp-warm-cream);
    border-radius: 8px;
  }

  .activity-item .num {
    width: 28px;
    height: 28px;
    background: var(--rp-primary);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 12px;
    flex-shrink: 0;
  }

  .activity-item span {
    font-size: 12px;
    color: var(--rp-text-medium);
  }

  /* êµì‚¬ ì˜ê²¬ ì„¹ì…˜ */
  .comment-box {
    background: linear-gradient(135deg, var(--rp-warm-beige) 0%, var(--rp-accent-light) 100%);
    border-radius: 12px;
    padding: 28px;
    border-left: 5px solid var(--rp-primary);
  }

  .teacher-info {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 16px;
  }

  .teacher-avatar {
    width: 44px;
    height: 44px;
    background: var(--rp-primary);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    font-weight: 700;
  }

  .teacher-name {
    font-weight: 700;
    color: var(--rp-text-dark);
  }

  .teacher-role {
    font-size: 12px;
    color: var(--rp-text-light);
  }

  .comment-content {
    color: var(--rp-text-medium);
    font-size: 14px;
    line-height: 1.8;
  }

  .comment-content p {
    margin-bottom: 12px;
  }

  .comment-content p:last-child {
    margin-bottom: 0;
  }

  /* ë¹ˆ ìƒíƒœ */
  .empty-message {
    text-align: center;
    padding: 48px 20px;
    color: var(--rp-text-light);
    font-size: 14px;
  }

  /* ì•¡ì…˜ ë²„íŠ¼ */
  .action-buttons {
    display: flex;
    gap: 12px;
    margin-top: 24px;
    flex-wrap: wrap;
  }

  .action-btn {
    padding: 12px 24px;
    border: 1px solid var(--rp-border);
    border-radius: 8px;
    background: white;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.3s ease;
    color: var(--rp-text-dark);
  }

  .action-btn:hover {
    background: var(--rp-primary);
    color: white;
    border-color: var(--rp-primary);
  }

  /* ë’¤ë¡œê°€ê¸° ë§í¬ */
  .back-link {
    display: inline-block;
    margin-bottom: 20px;
    color: var(--rp-primary);
    text-decoration: none;
    font-size: 14px;
    font-weight: 500;
  }

  .back-link:hover {
    text-decoration: underline;
  }

  /* ì¸ì‡„ ìŠ¤íƒ€ì¼ */
  @media print {
    .report-nav, .action-buttons, .back-link {
      display: none !important;
    }

    .report-section {
      page-break-inside: avoid;
      box-shadow: none;
      border: 1px solid #ddd;
    }

    body {
      background: white;
    }
  }

  /* ë°˜ì‘í˜• */
  @media (max-width: 768px) {
    .report-header-section {
      padding: 32px 16px;
    }

    .report-header-student-card {
      grid-template-columns: 1fr 1fr;
    }

    .report-section {
      padding: 20px;
      margin-bottom: 20px;
    }

    .report-nav ul {
      gap: 4px;
    }

    .report-nav a {
      padding: 6px 12px;
      font-size: 12px;
    }

    .summary-grid {
      grid-template-columns: 1fr;
    }
  }

  /* ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•œ ë˜í¼ */
  .report-wrapper {
    display: flex;
    flex-direction: column;
    height: calc(100vh - 120px);
    overflow-y: auto;
    overflow-x: hidden;
  }
</style>

<!-- ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•œ ë˜í¼ -->
<div class="report-wrapper">
  <!-- ë’¤ë¡œê°€ê¸° -->
  <a href="<%= parent_reports_path(student_id: @student.id) %>" class="back-link">â† ë¦¬í¬íŠ¸ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>

  <!-- í—¤ë” ì„¹ì…˜ -->
  <div class="report-header-section">
  <div class="report-header-org">
    <div class="icon">ğŸ“š</div>
    <div class="text">
      <strong>ReadingPRO</strong>
      ìë…€ ë¬¸í•´ë ¥ ì§„ë‹¨ ë° ë…ì ì„±í–¥ ë¶„ì„
    </div>
  </div>

  <div class="report-header-title">
    <h1>ìë…€ì˜ ë¬¸í•´ë ¥ ì§„ë‹¨ ë° ë…ì ì„±í–¥ ë¶„ì„</h1>
    <p>ìë…€ì˜ ë…ì„œ ëŠ¥ë ¥ ì§„ë‹¨ ë° ì½ê¸° ì„±í–¥ ë¶„ì„ ê²°ê³¼</p>
  </div>

  <div class="report-header-student-card">
    <div class="student-info-item">
      <label>í•™ìƒëª…</label>
      <div class="value"><%= @student.name %></div>
    </div>
    <div class="student-info-item">
      <label>ê²€ì‚¬ ìœ í˜•</label>
      <div class="value">ì‹¬ì¸µ ë¶„ì„</div>
    </div>
    <div class="student-info-item">
      <label>ê²€ì‚¬ì¼</label>
      <div class="value"><%= @attempt.started_at&.strftime("%m.%d") %></div>
    </div>
    <div class="student-info-item">
      <label>ì§„ë‹¨ ìƒíƒœ</label>
      <div class="value highlight"><%= translate_report_status(@report.status) %></div>
    </div>
  </div>
</div>

<!-- ë„¤ë¹„ê²Œì´ì…˜ -->
<nav class="report-nav">
  <ul>
    <li><a href="#summary" onclick="scrollToSection(event, 'summary')">ì¢…í•© ê²°ê³¼</a></li>
    <li><a href="#reader-type" onclick="scrollToSection(event, 'reader-type')">ë…ì ìœ í˜•</a></li>
    <li><a href="#detailed-analysis" onclick="scrollToSection(event, 'detailed-analysis')">ìƒì„¸ ë¶„ì„</a></li>
    <li><a href="#home-guidance" onclick="scrollToSection(event, 'home-guidance')">ê°€ì • ì§€ë„</a></li>
    <li><a href="#teacher-comment" onclick="scrollToSection(event, 'teacher-comment')">êµì‚¬ ì˜ê²¬</a></li>
  </ul>
</nav>

<!-- Section 01: ì¢…í•© ê²°ê³¼ ìš”ì•½ -->
<section class="report-section" id="summary">
  <div class="report-section-header">
    <span class="report-section-label">Overview</span>
    <h2 class="report-section-title">ì¢…í•© ê²°ê³¼ ìš”ì•½</h2>
    <p class="report-section-desc">ìë…€ë¶„ì˜ ë¬¸í•´ë ¥ ì§„ë‹¨ ê²°ê³¼ë¥¼ í•µì‹¬ ì˜ì—­ìœ¼ë¡œ ì•ˆë‚´í•´ ë“œë¦½ë‹ˆë‹¤.</p>
  </div>

  <% if @literacy_achievements.any? %>
    <div class="summary-grid">
      <% @literacy_achievements.first(3).each do |achievement| %>
        <div class="summary-card">
          <div class="icon">ğŸ“Š</div>
          <div class="score"><%= achievement.accuracy_rate %>%</div>
          <div class="label"><%= achievement.evaluation_indicator&.name || "ë¬¸í•´ë ¥" %></div>
        </div>
      <% end %>
    </div>
  <% end %>

  <% if @comprehensive_analysis %>
    <div class="summary-message">
      <h3>ğŸ“Œ ì¢…í•© í‰ê°€</h3>
      <p><%= @comprehensive_analysis.overall_summary || "ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤." %></p>
    </div>
  <% end %>
</section>

<!-- Section 02: ë…ì ìœ í˜• ë¶„ì„ -->
<section class="report-section" id="reader-type">
  <div class="report-section-header">
    <span class="report-section-label">Reader Type</span>
    <h2 class="report-section-title">ìë…€ì˜ ë…ì ìœ í˜•</h2>
    <p class="report-section-desc">ìë…€ë¶„ì˜ ë…ì„œ ìŠµê´€ê³¼ ì½ê¸° íŠ¹ì„±ì„ ì´í•´í•˜ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤.</p>
  </div>

  <% if @reader_tendency %>
    <div class="type-card">
      <div class="type-card-header">
        <h3>ë…ì ìœ í˜•</h3>
        <div class="type-name"><%= @reader_tendency.reader_type&.name || "ë¶„ì„ ì¤‘" %></div>
        <p><%= @reader_tendency.reader_type&.characteristics || "ë…ì ì„±í–¥ì„ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤." %></p>
      </div>
    </div>

    <% if @reader_tendency.reader_type %>
      <div class="type-features-grid" style="margin-top: 24px;">
        <div class="type-feature">
          <h4>ğŸ“– íŠ¹ì§•</h4>
          <p><%= @reader_tendency.reader_type.characteristics || "ì½ê¸° ì„±í–¥ ë¶„ì„ ì¤‘" %></p>
        </div>
        <div class="type-feature">
          <h4>ğŸ¯ ê°•ì </h4>
          <p>ê¹Šì´ ìˆëŠ” ì´í•´ì™€ ì‚¬ìƒ‰ì  ì½ê¸°ì— íƒì›”í•©ë‹ˆë‹¤.</p>
        </div>
        <div class="type-feature">
          <h4>ğŸ’¡ ì¡°ì–¸</h4>
          <p>ë‹¤ì–‘í•œ ì¥ë¥´ ê²½í—˜ìœ¼ë¡œ ì½ê¸° í­ì„ ë„“í˜€ë³´ì„¸ìš”.</p>
        </div>
      </div>
    <% end %>
  <% end %>
</section>

<!-- Section 03: ì˜ì—­ë³„ ìƒì„¸ ë¶„ì„ -->
<section class="report-section" id="detailed-analysis">
  <div class="report-section-header">
    <span class="report-section-label">Analysis</span>
    <h2 class="report-section-title">ì˜ì—­ë³„ ìƒì„¸ ë¶„ì„</h2>
    <p class="report-section-desc">ê° ë¬¸í•´ë ¥ ì˜ì—­ë³„ ì„±ì·¨ë„ë¥¼ ìì„¸íˆ ë¶„ì„í•œ ê²°ê³¼ì…ë‹ˆë‹¤.</p>
  </div>

  <% if @literacy_achievements.any? %>
    <div class="analysis-table-container">
      <table class="analysis-table">
        <thead>
          <tr>
            <th>í‰ê°€ ì˜ì—­</th>
            <th>ë¬¸ì œìˆ˜</th>
            <th>ì •ë‹µ</th>
            <th>ì •ë‹µë¥ </th>
            <th>ìˆ˜ì¤€</th>
            <th>ì§„ë„</th>
          </tr>
        </thead>
        <tbody>
          <% @literacy_achievements.each do |achievement| %>
            <tr>
              <td><strong><%= achievement.evaluation_indicator&.name || "ì˜ì—­" %></strong></td>
              <td><%= achievement.total_questions %></td>
              <td><%= achievement.correct_answers %></td>
              <td><strong><%= achievement.accuracy_rate %>%</strong></td>
              <td>
                <% rate = achievement.accuracy_rate.to_i %>
                <% if rate >= 80 %>
                  <span class="status-badge excellent">ìš°ìˆ˜</span>
                <% elsif rate >= 60 %>
                  <span class="status-badge good">ì–‘í˜¸</span>
                <% else %>
                  <span class="status-badge needs-improvement">ê°œì„  í•„ìš”</span>
                <% end %>
              </td>
              <td>
                <div class="progress-bar">
                  <div class="bar">
                    <div class="fill" style="width: <%= achievement.accuracy_rate %>%"></div>
                  </div>
                  <div class="value"><%= achievement.accuracy_rate %>%</div>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <% if @comprehensive_analysis && @comprehensive_analysis.comprehension_analysis %>
      <div class="summary-message">
        <h3>ğŸ“Š ë¶„ì„ ê²°ê³¼</h3>
        <p><%= @comprehensive_analysis.comprehension_analysis %></p>
      </div>
    <% end %>
  <% else %>
    <div class="empty-message">
      <p>ğŸ“‹ ìƒì„¸ ë¶„ì„ ë°ì´í„°ë¥¼ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.</p>
    </div>
  <% end %>
</section>

<!-- Section 04: ê°€ì •ì—ì„œì˜ ì§€ë„ ë°©í–¥ -->
<section class="report-section" id="home-guidance">
  <div class="report-section-header">
    <span class="report-section-label">Guidance</span>
    <h2 class="report-section-title">ê°€ì •ì—ì„œì˜ ì§€ë„ ë°©í–¥</h2>
    <p class="report-section-desc">ìë…€ì˜ ë…ì„œ ëŠ¥ë ¥ í–¥ìƒì„ ìœ„í•œ ë¶€ëª¨ë‹˜ì˜ ì—­í• ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.</p>
  </div>

  <% if @guidance_directions.any? %>
    <div class="guidance-grid">
      <% @guidance_directions.each_with_index do |direction, idx| %>
        <div class="guidance-card">
          <h3>
            <span class="icon"><%= ['ğŸ“–', 'âœï¸', 'ğŸ¯', 'ğŸ’¡', 'ğŸŒŸ'][idx % 5] %></span>
            <%= direction.evaluation_indicator&.name || "í•™ìŠµ ë°©í–¥" %>
          </h3>
          <p><%= direction.content || "ì§€ë„ ë‚´ìš©ì„ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤." %></p>
          <ul>
            <li>ê·œì¹™ì ì¸ ë…ì„œ ìŠµê´€ í˜•ì„±</li>
            <li>ë…ì„œ í›„ ëŠë‚Œ ë‚˜ëˆ„ê¸°</li>
            <li>ë‹¤ì–‘í•œ ì¥ë¥´ ê²½í—˜</li>
          </ul>
        </div>
      <% end %>
    </div>

    <div class="recommended-activities">
      <h3>ğŸ’¬ ì¶”ì²œ í™œë™</h3>
      <div class="activity-list">
        <div class="activity-item">
          <div class="num">1</div>
          <span>ë§¤ì¼ 30ë¶„ ì´ìƒ ë…ì„œí•˜ê¸°</span>
        </div>
        <div class="activity-item">
          <div class="num">2</div>
          <span>ì½ì€ ì±…ì— ëŒ€í•´ ëŒ€í™”í•˜ê¸°</span>
        </div>
        <div class="activity-item">
          <div class="num">3</div>
          <span>ë„ì„œê´€ ë°©ë¬¸ ë° ì¶”ì²œë„ì„œ ì°¾ê¸°</span>
        </div>
        <div class="activity-item">
          <div class="num">4</div>
          <span>ë…ì„œ ì¼ì§€ ì‘ì„±í•˜ê¸°</span>
        </div>
      </div>
    </div>
  <% else %>
    <div class="empty-message">
      <p>ğŸ  ê°€ì • ì§€ë„ ë°©í–¥ì„ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.</p>
    </div>
  <% end %>
</section>

<!-- Section 05: ë‹´ë‹¹ êµì‚¬ì˜ ì˜ê²¬ -->
<section class="report-section" id="teacher-comment">
  <div class="report-section-header">
    <span class="report-section-label">Teacher Comment</span>
    <h2 class="report-section-title">ë‹´ë‹¹ êµì‚¬ì˜ ì˜ê²¬</h2>
    <p class="report-section-desc">ìë…€ë¶„ì˜ í•™ìŠµì„ ë‹´ë‹¹í•œ êµì‚¬ì˜ ì „ë¬¸ì  ì˜ê²¬ì…ë‹ˆë‹¤.</p>
  </div>

  <div class="comment-box">
    <div class="teacher-info">
      <div class="teacher-avatar">ğŸ‘¨â€ğŸ«</div>
      <div>
        <div class="teacher-name">ì§„ë‹¨ë‹´ë‹¹êµì‚¬</div>
        <div class="teacher-role">ReadingPRO ì§„ë‹¨ ì „ë¬¸ê°€</div>
      </div>
    </div>
    <div class="comment-content">
      <p><%= @student.name %>ë‹˜ì€ ì´ë²ˆ ì§„ë‹¨ í‰ê°€ì—ì„œ ì²´ê³„ì ì¸ ì½ê¸° ëŠ¥ë ¥ì„ ë³´ì—¬ì£¼ì—ˆìŠµë‹ˆë‹¤.</p>
      <p><%= @comprehensive_analysis&.overall_summary || "ì¢…í•©ì ì¸ ë…í•´ ëŠ¥ë ¥ì˜ í–¥ìƒì„ ê¸°ëŒ€í•©ë‹ˆë‹¤." %></p>
      <p>ì§€ì†ì ì¸ ë…ì„œë¥¼ í†µí•´ ë”ìš± ë°œì „í•  ìˆ˜ ìˆì„ ê²ƒìœ¼ë¡œ ì˜ˆìƒë©ë‹ˆë‹¤. í•™ë¶€ëª¨ë‹˜ì˜ ê´€ì‹¬ê³¼ ê²©ë ¤ê°€ í° ë„ì›€ì´ ë  ê²ƒì…ë‹ˆë‹¤.</p>
    </div>
  </div>
</section>

<!-- ì•¡ì…˜ ë²„íŠ¼ -->
<div class="report-section">
  <div class="action-buttons">
    <button class="action-btn" onclick="downloadPDF()">
      ğŸ“¥ PDF ë‹¤ìš´ë¡œë“œ
    </button>
    <button class="action-btn" onclick="printReport()">
      ğŸ–¨ï¸ ì¸ì‡„í•˜ê¸°
    </button>
    <button class="action-btn" onclick="window.history.back()">
      â† ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°
    </button>
  </div>
</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
  function scrollToSection(e, sectionId) {
    e.preventDefault();
    const element = document.getElementById(sectionId);
    if (element) {
      element.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  }

  function downloadPDF() {
    const element = document.documentElement.cloneNode(true);

    // ë„¤ë¹„ê²Œì´ì…˜, ì•¡ì…˜ ë²„íŠ¼, ë’¤ë¡œê°€ê¸° ë§í¬ ì œê±°
    const elementsToRemove = element.querySelectorAll('.report-nav, .back-link, .action-buttons');
    elementsToRemove.forEach(el => el.remove());

    const opt = {
      margin: 10,
      filename: '<%= "#{@student.name}_ë¬¸í•´ë ¥ì§„ë‹¨ê²°ê³¼ë³´ê³ ì„œ_#{@attempt.started_at&.strftime('%Y%m%d')}" %>.pdf',
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2 },
      jsPDF: { orientation: 'portrait', unit: 'mm', format: 'a4' }
    };

    html2pdf().set(opt).from(element).save();
  }

  function printReport() {
    window.print();
  }

  // ìŠ¤í¬ë¡¤ ìœ„ì¹˜ì— ë”°ë¼ ë„¤ë¹„ê²Œì´ì…˜ í™œì„±í™”
  window.addEventListener('scroll', () => {
    const sections = document.querySelectorAll('.report-section[id]');
    const navLinks = document.querySelectorAll('.report-nav a');

    let current = '';
    sections.forEach(section => {
      const sectionTop = section.offsetTop;
      const sectionHeight = section.clientHeight;
      if (pageYOffset >= sectionTop - 100) {
        current = section.getAttribute('id');
      }
    });

    navLinks.forEach(link => {
      link.classList.remove('active');
      if (link.getAttribute('href').includes(current)) {
        link.classList.add('active');
      }
    });
  });
</script>

<% content_for :portal_actions do %>
  <a class="portal-button" href="<%= parent_reports_path(student_id: @student.id) %>">ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
<% end %>
