<!DOCTYPE html>
<html lang="ko">
<head>
  <title><%= content_for(:title) || "ReadingPRO" %></title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <link rel="icon" href="/icon.png" type="image/png">
  <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
  <%= stylesheet_link_tag "design_system", "data-turbo-track": "reload" %>

  <%= javascript_importmap_tags %>
  <%= yield :head %>
</head>
<body class="rp-body" data-controller="web-vitals" data-web-vitals-endpoint-value="/api/metrics/web_vitals">
  <!-- Skip to main content for accessibility -->
  <a href="#main-content" class="skip-to-main">본문으로 건너뛰기</a>

  <!-- Icon Sprite (include once, hidden from view) -->
  <%= render "shared/icon_sprite" %>

  <!-- Toast Notification Container -->
  <%= render "shared/toast_container" %>

  <div class="rp-layout rp-layout--with-header">
    <!-- Header -->
    <%= render "shared/unified_header",
        page_title: (content_for?(:page_title) ? yield(:page_title) : "대시보드"),
        current_role: local_assigns[:current_role] || @current_role %>

    <div class="rp-layout__body">
      <!-- Sidebar -->
      <%= render "shared/unified_sidebar",
          current_role: local_assigns[:current_role] || @current_role,
          current_page: local_assigns[:current_page] || @current_page %>

      <!-- Main Content -->
      <main class="rp-main" id="main-content">
        <div class="rp-main__container">
          <% if flash[:notice].present? %>
            <div class="rp-flash rp-flash--notice">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M12 16v-4M12 8h.01"></path>
              </svg>
              <%= flash[:notice] %>
            </div>
          <% end %>

          <% if flash[:alert].present? %>
            <div class="rp-flash rp-flash--alert">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M12 8v4M12 16h.01"></path>
              </svg>
              <%= flash[:alert] %>
            </div>
          <% end %>

          <%= yield %>
        </div>
      </main>
    </div>
  </div>

  <%= render "shared/dev_toolbar" %>
  <%= yield :scripts %>
</body>
</html>
