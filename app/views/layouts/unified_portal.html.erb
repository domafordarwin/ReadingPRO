<!DOCTYPE html>
<html lang="ko">
<head>
  <title><%= content_for(:title) || "Reading PRO" %></title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <link rel="icon" href="/icon.png" type="image/png">
  <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
  <%= stylesheet_link_tag "design_system", "data-turbo-track": "reload" %>
  <%= stylesheet_link_tag "questioning", "data-turbo-track": "reload" %>

  <%= javascript_importmap_tags %>
  <%= yield :head %>
</head>
<body class="rp-body" data-controller="web-vitals" data-web-vitals-endpoint-value="/api/metrics/web_vitals">
  <!-- Skip to main content for accessibility -->
  <a href="#main-content" class="skip-to-main">본문으로 건너뛰기</a>

  <!-- Icon Sprite (include once, hidden from view) -->
  <%= render "shared/icon_sprite" %>

  <!-- Toast Notification Container -->
  <%= render "shared/toast_container" %>

  <div class="rp-layout rp-layout--with-header">
    <!-- Header -->
    <%= render "shared/unified_header",
        page_title: (content_for?(:page_title) ? yield(:page_title) : "대시보드"),
        current_role: local_assigns[:current_role] || @current_role %>

    <div class="rp-layout__body">
      <!-- Sidebar -->
      <%= render "shared/unified_sidebar",
          current_role: local_assigns[:current_role] || @current_role,
          current_page: local_assigns[:current_page] || @current_page %>

      <!-- Main Content -->
      <main class="rp-main" id="main-content">
        <div class="rp-main__container">
          <% if flash[:notice].present? %>
            <div class="rp-toast rp-toast--success" id="flash-toast">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
              </svg>
              <span><%= flash[:notice] %></span>
              <button type="button" onclick="this.parentElement.remove()" style="background:none;border:none;color:inherit;cursor:pointer;padding:0;margin-left:auto;opacity:0.7;">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
              </button>
            </div>
            <script>setTimeout(function(){var t=document.getElementById('flash-toast');if(t){t.style.opacity='0';t.style.transform='translateY(-20px)';setTimeout(function(){t.remove()},400);}},4000);</script>
          <% end %>

          <% if flash[:alert].present? %>
            <div class="rp-toast rp-toast--alert" id="flash-toast-alert">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M12 8v4M12 16h.01"></path>
              </svg>
              <span><%= flash[:alert] %></span>
              <button type="button" onclick="this.parentElement.remove()" style="background:none;border:none;color:inherit;cursor:pointer;padding:0;margin-left:auto;opacity:0.7;">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
              </button>
            </div>
            <script>setTimeout(function(){var t=document.getElementById('flash-toast-alert');if(t){t.style.opacity='0';t.style.transform='translateY(-20px)';setTimeout(function(){t.remove()},400);}},6000);</script>
          <% end %>

          <%= yield %>
        </div>
      </main>
    </div>
  </div>

  <%= render "shared/dev_toolbar" %>
  <%= yield :scripts %>
</body>
</html>
