<header class="admin-header">
  <div>
    <h1 class="admin-title">문항은행</h1>
    <p class="admin-subtitle">문항을 등록하고 관리하세요</p>
  </div>
  <div class="admin-actions">
    <%= link_to "새 문항", new_admin_item_path, class: "admin-button primary" %>
  </div>
</header>

<section class="admin-card">
  <%= form_with url: admin_items_path, method: :get, local: true, class: "admin-form" do |form| %>
    <div>
      <%= form.label :q, "검색" %>
      <%= form.text_field :q, value: @query, class: "admin-input small", placeholder: "문항 코드 또는 내용" %>
    </div>
    <div>
      <%= form.label :item_type, "유형" %>
      <%= form.select :item_type, options_for_select([["전체", ""], ["객관식", "mcq"], ["서술형", "constructed"]], @item_type), {}, class: "admin-select small" %>
    </div>
    <div>
      <%= form.label :status, "상태" %>
      <%= form.select :status, options_for_select([["전체", ""], ["초안", "draft"], ["활성", "active"], ["폐기", "retired"]], @status), {}, class: "admin-select small" %>
    </div>
    <div>
      <%= form.label :difficulty, "난이도" %>
      <%= form.select :difficulty, options_for_select([["전체", ""], "상", "중", "하"], @difficulty), {}, class: "admin-select small" %>
    </div>
    <div>
      <%= form.label :stimulus_id, "지문" %>
      <%= form.select :stimulus_id, options_from_collection_for_select(@stimuli, :id, :code, @stimulus_id&.to_i), { include_blank: "전체" }, class: "admin-select small" %>
    </div>
    <div>
      <%= form.submit "필터 적용", class: "admin-button secondary" %>
      <%= link_to "초기화", admin_items_path, class: "admin-button" %>
    </div>
  <% end %>
</section>

<section class="admin-card">
  <div class="admin-muted">총 <strong><%= @items.count %></strong>개 문항</div>
  <table class="admin-table">
    <thead>
      <tr>
        <th>문항코드</th>
        <th>유형</th>
        <th>문항 내용</th>
        <th>지문</th>
        <th>난이도</th>
        <th>상태</th>
        <th>관리</th>
      </tr>
    </thead>
    <tbody>
      <% @items.each do |item| %>
        <tr>
          <td><strong><%= item.code %></strong></td>
          <td><span class="admin-badge"><%= item.item_type %></span></td>
          <td><%= truncate(item.prompt, length: 120) %></td>
          <td><%= item.stimulus&.code || "-" %></td>
          <td><%= item.difficulty.presence || "-" %></td>
          <td><%= item.status %></td>
          <td>
            <div class="admin-actions">
              <%= link_to "상세", admin_item_path(item), class: "admin-button" %>
              <%= link_to "수정", edit_admin_item_path(item), class: "admin-button" %>
              <%= link_to "보기", admin_item_item_choices_path(item), class: "admin-button secondary" %>
            </div>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</section>
