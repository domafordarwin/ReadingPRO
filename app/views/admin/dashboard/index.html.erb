<header class="admin-header">
  <div>
    <h1 class="admin-title">대시보드</h1>
    <p class="admin-subtitle">문항은행 현황을 한눈에 확인하세요</p>
  </div>
  <div class="admin-actions">
    <%= link_to "새 문항", new_admin_item_path, class: "admin-button primary" %>
  </div>
</header>

<section class="admin-grid">
  <div class="admin-stat">
    <div class="admin-stat-label">전체 문항</div>
    <div class="admin-stat-value"><%= @stats[:items_total] %></div>
  </div>
  <div class="admin-stat">
    <div class="admin-stat-label">객관식</div>
    <div class="admin-stat-value"><%= @stats[:items_mcq] %></div>
  </div>
  <div class="admin-stat">
    <div class="admin-stat-label">서술형</div>
    <div class="admin-stat-value"><%= @stats[:items_constructed] %></div>
  </div>
  <div class="admin-stat">
    <div class="admin-stat-label">시험지</div>
    <div class="admin-stat-value"><%= @stats[:forms_total] %></div>
  </div>
</section>

<div class="admin-divider"></div>

<div class="admin-grid">
  <section class="admin-card">
    <h2>최근 문항</h2>
    <% if @recent_items.any? %>
      <table class="admin-table">
        <thead>
          <tr>
            <th>문항코드</th>
            <th>유형</th>
            <th>문항</th>
            <th>상태</th>
          </tr>
        </thead>
        <tbody>
          <% @recent_items.each do |item| %>
            <tr>
              <td><%= item.code %></td>
              <td><%= item.item_type %></td>
              <td><%= truncate(item.prompt, length: 60) %></td>
              <td><%= item.status %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <p class="admin-muted">최근 문항이 없습니다.</p>
    <% end %>
  </section>

  <section class="admin-card">
    <h2>최근 응시</h2>
    <% if @recent_attempts.any? %>
      <table class="admin-table">
        <thead>
          <tr>
            <th>시험지</th>
            <th>응시 ID</th>
            <th>시작</th>
          </tr>
        </thead>
        <tbody>
          <% @recent_attempts.each do |attempt| %>
            <tr>
              <td><%= attempt.form&.title || "미지정" %></td>
              <td><%= attempt.id %></td>
              <td><%= attempt.started_at&.strftime("%Y-%m-%d") || "-" %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <p class="admin-muted">응시 기록이 없습니다.</p>
    <% end %>
  </section>

  <section class="admin-card">
    <h2>시스템 상태</h2>
    <div class="admin-actions">
      <span class="admin-badge <%= @db_ok ? "success" : "danger" %>">
        DB: <%= @db_ok ? "연결됨" : "오류" %>
      </span>
      <span class="admin-muted"><%= @db_message %></span>
    </div>
  </section>
</div>
