<header class="admin-header">
  <div>
    <h1 class="admin-title">채점 정의</h1>
    <p class="admin-subtitle">객관식 근접점수와 서술형 루브릭을 관리하세요</p>
  </div>
</header>

<section class="admin-card">
  <h2>객관식 채점</h2>
  <p class="admin-muted">보기별 점수(%) 및 정답 여부를 확인합니다.</p>
  <% if @mcq_items.any? %>
    <% @mcq_items.each do |item| %>
      <div class="admin-divider"></div>
      <h3><%= item.code %> · <%= truncate(item.prompt, length: 80) %></h3>
      <table class="admin-table">
        <thead>
          <tr>
            <th>번호</th>
            <th>내용</th>
            <th>점수(%)</th>
            <th>정답</th>
            <th>이유</th>
            <th>관리</th>
          </tr>
        </thead>
        <tbody>
          <% item.item_choices.order(:choice_no).each do |choice| %>
            <% score = choice.choice_score %>
            <tr>
              <td><%= choice.choice_no %></td>
              <td><%= choice.content %></td>
              <td><%= score&.score_percent || "-" %></td>
              <td><%= score&.is_key ? "예" : "아니오" %></td>
              <td><%= score&.rationale || "-" %></td>
              <td><%= link_to "편집", admin_item_item_choices_path(item), class: "admin-button" %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% end %>
  <% else %>
    <p class="admin-muted">등록된 객관식 문항이 없습니다.</p>
  <% end %>
</section>

<section class="admin-card">
  <h2>서술형 루브릭</h2>
  <p class="admin-muted">모범답안과 평가요소/수준을 확인합니다.</p>
  <% if @constructed_items.any? %>
    <% @constructed_items.each do |item| %>
      <div class="admin-divider"></div>
      <h3><%= item.code %> · <%= truncate(item.prompt, length: 80) %></h3>
      <div>
        <strong>모범답안</strong>
        <% if item.item_sample_answers.any? %>
          <ul>
            <% item.item_sample_answers.each do |answer| %>
              <li><%= answer.answer %></li>
            <% end %>
          </ul>
        <% else %>
          <p class="admin-muted">모범답안이 없습니다.</p>
        <% end %>
      </div>

      <% if item.rubric.present? %>
        <div class="admin-divider"></div>
        <strong>평가요소</strong>
        <table class="admin-table">
          <thead>
            <tr>
              <th>요소</th>
              <th>수준</th>
              <th>설명</th>
            </tr>
          </thead>
          <tbody>
            <% item.rubric.rubric_criteria.order(:position).each do |criterion| %>
              <% criterion.rubric_levels.order(level_score: :desc).each do |level| %>
                <tr>
                  <td><%= criterion.name %></td>
                  <td><%= level.level_score %></td>
                  <td><%= level.descriptor || "-" %></td>
                </tr>
              <% end %>
            <% end %>
          </tbody>
        </table>
      <% else %>
        <p class="admin-muted">루브릭이 없습니다.</p>
      <% end %>
    <% end %>
  <% else %>
    <p class="admin-muted">등록된 서술형 문항이 없습니다.</p>
  <% end %>
</section>
