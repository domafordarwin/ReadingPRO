<% content_for :portal_title do %>
  ë¬¸í•´ë ¥ ì§„ë‹¨ ë° ë…ìì„±í–¥ê²€ì‚¬ ê²°ê³¼ ë³´ê³ ì„œ
<% end %>

<% content_for :portal_subtitle do %>
  <%= @student.name %> í•™ìƒì˜ ìƒì„¸ ì§„ë‹¨ ê²°ê³¼
<% end %>

<style>
  :root {
    --primary: #667eea;
    --primary-dark: #5568d3;
    --text-dark: #2D2D2D;
    --text-medium: #555;
    --text-light: #888;
    --border: #E0E0E0;
    --bg-light: #FAFAFA;
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: var(--rp-font-family);
    color: var(--text-dark);
    line-height: 1.7;
    font-size: var(--rp-font-size-md);
  }

  /* ========== ë¦¬í¬íŠ¸ ë˜í¼ (ìŠ¤í¬ë¡¤ ê°€ëŠ¥) ========== */
  .report-wrapper {
    display: flex;
    flex-direction: column;
    height: calc(100vh - 120px);
    overflow-y: auto;
    overflow-x: hidden;
  }

  /* ========== ë©”ì¸ ì»¨í…Œì´ë„ˆ ========== */
  .report-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 40px;
  }

  /* ========== í° í—¤ë” ì„¹ì…˜ ========== */
  .report-header {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    padding: 80px 20px;
    text-align: center;
    margin-bottom: 60px;
    border-radius: 12px;
  }

  .report-header h1 {
    font-size: var(--rp-font-size-4xl);
    font-weight: 700;
    margin-bottom: 15px;
    letter-spacing: -0.5px;
  }

  .report-header p {
    font-size: var(--rp-font-size-md);
    opacity: 0.95;
  }

  /* ========== ìƒë‹¨ íƒ­ ë„¤ë¹„ê²Œì´ì…˜ ========== */
  .report-nav {
    position: sticky;
    top: 0;
    background: white;
    border-bottom: 2px solid var(--primary);
    z-index: 50;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    margin-bottom: 50px;
  }

  .nav-wrapper {
    max-width: 1000px;
    margin: 0 auto;
    padding: 0 20px;
    display: flex;
    gap: 40px;
  }

  .nav-item {
    padding: 14px 0;
    color: var(--text-light);
    text-decoration: none;
    font-weight: 500;
    font-size: var(--rp-font-size-base);
    cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: all 0.2s;
    white-space: nowrap;
  }

  .nav-item:hover,
  .nav-item.active {
    color: var(--primary);
    border-bottom-color: var(--primary);
  }

  /* ========== ì„¹ì…˜ ê³µí†µ ìŠ¤íƒ€ì¼ ========== */
  .section {
    margin-bottom: 60px;
    scroll-margin-top: 120px;
  }

  .section-header {
    display: flex;
    align-items: flex-start;
    gap: 30px;
    margin-bottom: 40px;
  }

  .section-number {
    flex-shrink: 0;
    width: 60px;
    height: 60px;
    background: var(--primary);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: var(--rp-font-size-3xl);
    font-weight: 700;
  }

  .section-title-group h2 {
    font-size: var(--rp-font-size-2xl);
    font-weight: 700;
    color: var(--text-dark);
    margin-bottom: 8px;
  }

  .section-title-group p {
    color: var(--text-light);
    font-size: var(--rp-font-size-base);
  }

  /* ========== ì„¹ì…˜ 01: ëª©ì°¨ ========== */
  .toc-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
  }

  .toc-item {
    background: linear-gradient(135deg, #f0f4ff 0%, #f8faff 100%);
    border: 1px solid #e0e8ff;
    border-radius: 12px;
    padding: 24px;
    text-align: center;
  }

  .toc-item-number {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    background: var(--primary);
    color: white;
    border-radius: 50%;
    font-weight: 700;
    font-size: var(--rp-font-size-xl);
    margin-bottom: 12px;
  }

  .toc-item-title {
    font-size: var(--rp-font-size-md);
    font-weight: 600;
    color: var(--text-dark);
  }

  .toc-item-desc {
    font-size: var(--rp-font-size-xs);
    color: var(--text-light);
    margin-top: 8px;
  }

  /* ========== ì„¹ì…˜ 02: ê°œìš” ========== */
  .overview-box {
    background: linear-gradient(135deg, #f0f4ff 0%, #f8faff 100%);
    border-left: 5px solid var(--primary);
    border-radius: 8px;
    padding: 24px;
    margin-bottom: 20px;
  }

  .overview-box h3 {
    font-size: var(--rp-font-size-md);
    font-weight: 600;
    color: var(--text-dark);
    margin-bottom: 12px;
  }

  .overview-box p {
    font-size: var(--rp-font-size-base);
    color: var(--text-medium);
    line-height: 1.8;
  }

  /* ========== ì„¹ì…˜ 03: ë…ìì„±í–¥ ========== */
  .reader-type-card {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    border-radius: 12px;
    padding: 40px;
    text-align: center;
    margin-bottom: 30px;
  }

  .reader-type-name {
    font-size: var(--rp-font-size-4xl);
    font-weight: 700;
    margin-bottom: 16px;
  }

  .reader-type-char {
    font-size: var(--rp-font-size-base);
    opacity: 0.95;
    line-height: 1.7;
  }

  .type-features {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    margin-top: 20px;
  }

  .type-feature {
    background: white;
    color: var(--text-dark);
    padding: 16px;
    border-radius: 8px;
  }

  .type-feature h4 {
    font-size: var(--rp-font-size-sm);
    font-weight: 600;
    margin-bottom: 8px;
  }

  .type-feature p {
    font-size: var(--rp-font-size-xs);
    color: var(--text-medium);
  }

  /* ========== ì„¹ì…˜ 04: ì‹¬ì¸µ ë¶„ì„ ========== */
  .analysis-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
  }

  .analysis-table th {
    background: var(--primary);
    color: white;
    padding: 14px;
    text-align: left;
    font-weight: 600;
    font-size: var(--rp-font-size-sm);
  }

  .analysis-table td {
    padding: 12px 14px;
    border-bottom: 1px solid var(--border);
    font-size: var(--rp-font-size-sm);
  }

  .analysis-table tbody tr:hover {
    background: var(--bg-light);
  }

  .status-badge {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 16px;
    font-size: var(--rp-font-size-xs);
    font-weight: 600;
  }

  .status-badge.excellent {
    background: #c6f6d5;
    color: #22543d;
  }

  .status-badge.good {
    background: #bee3f8;
    color: #2c5282;
  }

  .status-badge.needs-improvement {
    background: #feebc8;
    color: #7c2d12;
  }

  .progress-bar {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .progress-bar-fill {
    flex: 1;
    height: 6px;
    background: #e2e8f0;
    border-radius: 3px;
    overflow: hidden;
  }

  .progress-bar-inner {
    height: 100%;
    background: var(--primary);
  }

  .progress-bar-value {
    font-weight: 600;
    font-size: var(--rp-font-size-xs);
    min-width: 40px;
  }

  /* ========== ì„¹ì…˜ 05: í•™ìƒ í”„ë¡œí•„ ========== */
  .profile-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }

  .profile-card {
    background: white;
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 24px;
    border-top: 4px solid var(--primary);
  }

  .profile-card h3 {
    font-size: var(--rp-font-size-md);
    font-weight: 700;
    color: var(--text-dark);
    margin-bottom: 12px;
  }

  .profile-card p {
    font-size: var(--rp-font-size-sm);
    color: var(--text-medium);
    line-height: 1.7;
    margin-bottom: 12px;
  }

  .profile-card ul {
    list-style: none;
    font-size: var(--rp-font-size-xs);
    color: var(--text-medium);
  }

  .profile-card li {
    padding: 6px 0;
    padding-left: 20px;
    position: relative;
  }

  .profile-card li::before {
    content: 'âœ“';
    position: absolute;
    left: 0;
    color: #4CAF50;
    font-weight: 700;
  }

  /* ========== ì•¡ì…˜ ë²„íŠ¼ ========== */
  .action-buttons {
    display: flex;
    gap: 12px;
    margin-top: 40px;
    flex-wrap: wrap;
    justify-content: center;
  }

  .action-btn {
    padding: 12px 28px;
    border: 2px solid var(--primary);
    border-radius: 8px;
    background: white;
    color: var(--primary);
    cursor: pointer;
    font-size: var(--rp-font-size-base);
    font-weight: 600;
    transition: all 0.3s;
  }

  .action-btn:hover {
    background: var(--primary);
    color: white;
  }

  .action-btn.primary {
    background: var(--primary);
    color: white;
  }

  .action-btn.primary:hover {
    background: var(--primary-dark);
    border-color: var(--primary-dark);
  }

  /* ========== ì¸ì‡„ ìŠ¤íƒ€ì¼ ========== */
  @media print {
    .report-nav, .action-buttons {
      display: none !important;
    }
    .section {
      page-break-inside: avoid;
    }
  }

  /* ========== ë°˜ì‘í˜• ========== */
  @media (max-width: 768px) {
    .report-header {
      padding: 50px 20px;
    }

    .report-header h1 {
      font-size: var(--rp-font-size-3xl);
    }

    .nav-wrapper {
      gap: 20px;
      overflow-x: auto;
      padding-bottom: 5px;
    }

    .nav-item {
      font-size: var(--rp-font-size-xs);
      padding: 12px 0;
    }

    .section-header {
      flex-direction: column;
      gap: 15px;
    }

    .toc-grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .type-features {
      grid-template-columns: 1fr;
    }

    .profile-grid {
      grid-template-columns: 1fr;
    }

    .action-buttons {
      flex-direction: column;
    }

    .action-btn {
      width: 100%;
    }
  }
</style>

<!-- ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•œ ë˜í¼ -->
<div class="report-wrapper">
  <!-- í° í—¤ë” ì„¹ì…˜ -->
  <div class="report-header">
    <h1>ë¬¸í•´ë ¥ ì§„ë‹¨ ë° ë…ìì„±í–¥ê²€ì‚¬</h1>
    <p>ë…ì„œ ëŠ¥ë ¥ ì§„ë‹¨ ë° ì½ê¸° ì„±í–¥ ë¶„ì„ ê²°ê³¼</p>
  </div>

  <!-- ìƒë‹¨ íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
  <nav class="report-nav">
    <div class="nav-wrapper">
      <a href="#toc" class="nav-item active" onclick="updateNav(event, 'toc')">ëª©ì°¨</a>
      <a href="#overview" class="nav-item" onclick="updateNav(event, 'overview')">ê°œìš”</a>
      <a href="#reader-type" class="nav-item" onclick="updateNav(event, 'reader-type')">ë…ìì„±í–¥</a>
      <a href="#analysis" class="nav-item" onclick="updateNav(event, 'analysis')">ì‹¬ì¸µë¶„ì„</a>
      <a href="#profile" class="nav-item" onclick="updateNav(event, 'profile')">í•™ìƒí”„ë¡œí•„</a>
    </div>
  </nav>

  <!-- ì½˜í…ì¸  -->
  <div class="report-container">
  <!-- ì„¹ì…˜ 01: ëª©ì°¨ -->
  <section class="section" id="toc">
    <div class="section-header">
      <div class="section-number">01</div>
      <div class="section-title-group">
        <h2>ëª©ì°¨</h2>
        <p>ë³´ê³ ì„œ êµ¬ì„± ì•ˆë‚´</p>
      </div>
    </div>

    <p style="color: var(--text-medium); margin-bottom: 40px; font-size: var(--rp-font-size-md); line-height: 1.8;">
      ì´ ë³´ê³ ì„œëŠ” <%= @student.name %>ë‹˜ì˜ Reading PRO ë¬¸í•´ë ¥ ì§„ë‹¨ ê²°ê³¼ë¥¼ ì¢…í•©ì ìœ¼ë¡œ ë¶„ì„í•œ ìë£Œì…ë‹ˆë‹¤.
      ë…ì„œ ëŠ¥ë ¥, ì½ê¸° ì„±í–¥, í•™ìŠµ íŠ¹ì„± ë“±ì„ 5ê°€ì§€ ì„¹ì…˜ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ìƒì„¸íˆ ì„¤ëª…í•˜ê³ , ì•ìœ¼ë¡œì˜ í•™ìŠµ ë°©í–¥ì„ ì œì‹œí•©ë‹ˆë‹¤.
    </p>

    <div class="toc-grid">
      <div class="toc-item">
        <div class="toc-item-number">01</div>
        <div class="toc-item-title">ëª©ì°¨</div>
        <div class="toc-item-desc">ë³´ê³ ì„œì˜ ì „ì²´ êµ¬ì„± ë° ì‘ì„± ëª©ì ì„ ì•ˆë‚´í•©ë‹ˆë‹¤</div>
      </div>
      <div class="toc-item">
        <div class="toc-item-number">02</div>
        <div class="toc-item-title">ê°œìš”</div>
        <div class="toc-item-desc">ë¬¸í•´ë ¥ ì§„ë‹¨ì˜ ì˜ë¯¸ì™€ ì¤‘ìš”ì„±ì— ëŒ€í•´ ì„¤ëª…í•©ë‹ˆë‹¤</div>
      </div>
      <div class="toc-item">
        <div class="toc-item-number">03</div>
        <div class="toc-item-title">ë…ìì„±í–¥</div>
        <div class="toc-item-desc">47ê°€ì§€ ë…ì ìœ í˜• ì¤‘ í•™ìƒì˜ íŠ¹ì„±ì„ ë¶„ì„í•©ë‹ˆë‹¤</div>
      </div>
      <div class="toc-item">
        <div class="toc-item-number">04</div>
        <div class="toc-item-title">ì‹¬ì¸µë¶„ì„</div>
        <div class="toc-item-desc">ë¬¸í•´ë ¥ ì˜ì—­ë³„ ì„±ì·¨ë„ë¥¼ ìƒì„¸íˆ ë¶„ì„í•©ë‹ˆë‹¤</div>
      </div>
      <div class="toc-item">
        <div class="toc-item-number">05</div>
        <div class="toc-item-title">í•™ìƒí”„ë¡œí•„</div>
        <div class="toc-item-desc">ê°œì¸ ë§ì¶¤í˜• í•™ìŠµ ì§€ë„ ë°©í–¥ì„ ì œì‹œí•©ë‹ˆë‹¤</div>
      </div>
    </div>

    <div style="background: linear-gradient(135deg, #f0f4ff 0%, #f8faff 100%); border-left: 5px solid var(--primary); border-radius: 8px; padding: 24px; margin-top: 40px;">
      <h3 style="font-size: var(--rp-font-size-md); font-weight: 700; color: var(--text-dark); margin-bottom: 12px;">ğŸ“Š ì´ ë³´ê³ ì„œì˜ íŠ¹ì§•</h3>
      <p style="font-size: var(--rp-font-size-base); color: var(--text-medium); line-height: 1.8;">
        Reading PRO ì§„ë‹¨ì€ ë‹¨ìˆœí•œ ì„±ì  í‰ê°€ë¥¼ ë„˜ì–´ í•™ìƒì˜ ë…ì„œ ìŠµê´€, ì½ê¸° ì†ë„, ì´í•´ë ¥, ì„ í˜¸ë„, í•™ìŠµ ìŠ¤íƒ€ì¼ ë“±ì„
        ì¢…í•©ì ìœ¼ë¡œ ë¶„ì„í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ í•™ìƒì˜ ê°•ì ì„ íŒŒì•…í•˜ê³  ê°œì„ ì´ í•„ìš”í•œ ì˜ì—­ì„ ëª…í™•íˆ í•˜ì—¬,
        ë³´ë‹¤ íš¨ê³¼ì ì¸ í•™ìŠµ ì „ëµì„ ìˆ˜ë¦½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </p>
    </div>
  </section>

  <!-- ì„¹ì…˜ 02: ê°œìš” -->
  <section class="section" id="overview">
    <div class="section-header">
      <div class="section-number">02</div>
      <div class="section-title-group">
        <h2>ê°œìš”</h2>
        <p>ë¬¸í•´ë ¥ ì§„ë‹¨ ê´€ë ¨ ì„¤ëª…</p>
      </div>
    </div>

    <div class="overview-box">
      <h3>ğŸ“Š Reading PRO ë¬¸í•´ë ¥ ì§„ë‹¨ì´ë€?</h3>
      <p>Reading PRO ë¬¸í•´ë ¥ ì§„ë‹¨ì€ í•™ìƒì˜ ì½ê¸° ëŠ¥ë ¥ì„ ì¢…í•©ì ìœ¼ë¡œ í‰ê°€í•˜ëŠ” ì§„ë‹¨ ë„êµ¬ì…ë‹ˆë‹¤. ë‹¨ìˆœí•œ ì½ê¸° ì†ë„ì™€ ì´í•´ë ¥ë¿ë§Œ ì•„ë‹ˆë¼, ë…ì„œ ìŠµê´€, ì½ê¸° ì„ í˜¸ë„, ë¬¸í•´ ëŠ¥ë ¥ ë“±ì„ ë‹¤ê°ì ìœ¼ë¡œ ë¶„ì„í•˜ì—¬ í•™ìƒì˜ í˜„ì¬ ìˆ˜ì¤€ì„ íŒŒì•…í•˜ê³  ë§ì¶¤í˜• í•™ìŠµ ì§€ë„ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>
    </div>

    <div class="overview-box">
      <h3>ğŸ¯ ì§„ë‹¨ì˜ ëª©í‘œ</h3>
      <p>ì´ ì§„ë‹¨ì„ í†µí•´ ë‹¤ìŒê³¼ ê°™ì€ ëª©í‘œë¥¼ ë‹¬ì„±í•©ë‹ˆë‹¤:</p>
      <ul style="margin-top: 12px; margin-left: 20px; font-size: var(--rp-font-size-base); color: var(--text-medium); line-height: 1.8;">
        <li>âœ“ í•™ìƒì˜ í˜„ì¬ ë¬¸í•´ë ¥ ìˆ˜ì¤€ ì •í™•íˆ íŒŒì•…í•˜ê¸°</li>
        <li>âœ“ ê°•ì ê³¼ ì•½ì ì„ ëª…í™•íˆ êµ¬ë¶„í•˜ê¸°</li>
        <li>âœ“ í•™ìƒì˜ ë…ì„œ ì„±í–¥ê³¼ í•™ìŠµ ìŠ¤íƒ€ì¼ ì´í•´í•˜ê¸°</li>
        <li>âœ“ ê°œì¸ ë§ì¶¤í˜• í•™ìŠµ ë°©í–¥ ì œì‹œí•˜ê¸°</li>
        <li>âœ“ ì¥ê¸°ì ì¸ ë…ì„œ ìŠµê´€ í˜•ì„± ì§€ì›í•˜ê¸°</li>
      </ul>
    </div>

    <div class="overview-box">
      <h3>ğŸ“Œ ë…ìì„±í–¥ê²€ì‚¬ì˜ ì˜ë¯¸</h3>
      <p><%= @student.name %>ë‹˜ì˜ ë…ì ì„±í–¥ì„ íŒŒì•…í•˜ë©´ ì„ í˜¸í•˜ëŠ” ì±…ì˜ ì¥ë¥´, ì½ê¸° ë°©ì‹, í•™ìŠµ ìŠ¤íƒ€ì¼ì„ ì´í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” íš¨ê³¼ì ì¸ ë…ì„œ ì§€ë„ì™€ ê°œì¸ ë§ì¶¤í˜• í•™ìŠµ ê³„íš ìˆ˜ë¦½ì— í•µì‹¬ì ì¸ ì—­í• ì„ í•©ë‹ˆë‹¤.</p>
    </div>

    <div class="overview-box">
      <h3>ğŸ“ˆ ì§„ë‹¨ êµ¬ì„± ìš”ì†Œ</h3>
      <p>ì´ë²ˆ ì§„ë‹¨ì€ ë‹¤ìŒê³¼ ê°™ì€ ìš”ì†Œë“¤ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤:</p>
      <ul style="margin-top: 12px; margin-left: 20px; font-size: var(--rp-font-size-base); color: var(--text-medium); line-height: 1.8;">
        <li><strong>ì½ê¸° ì†ë„:</strong> ë‹¨ìœ„ ì‹œê°„ë‹¹ ì½ì„ ìˆ˜ ìˆëŠ” ê¸€ì ìˆ˜</li>
        <li><strong>ì´í•´ë„:</strong> ì½ì€ ë‚´ìš©ì˜ ì´í•´ì™€ í•´ì„ ëŠ¥ë ¥</li>
        <li><strong>ì–´íœ˜ë ¥:</strong> ì‚¬ìš©í•˜ê³  ì´í•´í•  ìˆ˜ ìˆëŠ” ë‹¨ì–´ì˜ ë²”ìœ„</li>
        <li><strong>ë…ì ì„±í–¥:</strong> ì„ í˜¸í•˜ëŠ” ë…ì„œ ìœ í˜•ê³¼ í•™ìŠµ ìŠ¤íƒ€ì¼</li>
        <li><strong>ë¬¸ì œí•´ê²°ë ¥:</strong> í…ìŠ¤íŠ¸ ë¶„ì„ ë° ì‘ìš© ëŠ¥ë ¥</li>
      </ul>
    </div>

    <% if @comprehensive_analysis %>
      <div class="overview-box">
        <h3>ğŸ“– <%= @student.name %>ë‹˜ì˜ ì¢…í•© í‰ê°€</h3>
        <p><%= @comprehensive_analysis.overall_summary || "ì¢…í•©ì ì¸ ë¶„ì„ì„ í†µí•´ í•™ìƒì˜ ë…í•´ ëŠ¥ë ¥ì„ í‰ê°€í•˜ê³  ìˆìŠµë‹ˆë‹¤." %></p>
      </div>
    <% end %>
  </section>

  <!-- ì„¹ì…˜ 03: ë…ìì„±í–¥ ìœ í˜• -->
  <section class="section" id="reader-type">
    <div class="section-header">
      <div class="section-number">03</div>
      <div class="section-title-group">
        <h2>ë…ìì„±í–¥</h2>
        <p>47ê°€ì§€ ë…ì ìœ í˜• ë¶„ì„</p>
      </div>
    </div>

    <p style="color: var(--text-medium); margin-bottom: 30px; font-size: var(--rp-font-size-md); line-height: 1.8;">
      ëª¨ë“  í•™ìƒì€ ê³ ìœ í•œ ì½ê¸° ë°©ì‹ê³¼ ì„ í˜¸ë„ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. Reading PROëŠ” 47ê°€ì§€ì˜ ë…ì ìœ í˜• ë¶„ë¥˜ë¥¼ í†µí•´
      <%= @student.name %>ë‹˜ì´ ì–´ë–¤ ìœ í˜•ì˜ ë…ìì¸ì§€ ë¶„ì„í•˜ê³ , ì´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë§ì¶¤í˜• ì½ê¸° ì§€ë„ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
    </p>

    <% if @reader_tendency %>
      <div class="reader-type-card">
        <div class="reader-type-name"><%= @reader_tendency.reading_speed&.capitalize || "ë¶„ì„ ì¤‘" %> (<%= @reader_tendency.words_per_minute || 0 %> WPM)</div>
        <div class="reader-type-char">
          <%= @reader_tendency.tendency_summary || "ë…ì ì„±í–¥ì„ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤." %>
        </div>

        <% if @reader_tendency.tendency_summary.present? %>
          <div class="type-features">
            <div class="type-feature">
              <h4>ğŸ“– ì£¼ìš” íŠ¹ì§•</h4>
              <p><%= @reader_tendency.tendency_summary || "ì½ê¸° ì„±í–¥ ë¶„ì„ ì¤‘" %></p>
            </div>
            <div class="type-feature">
              <h4>ğŸ¯ ê°•ì </h4>
              <p>ê¹Šì´ ìˆëŠ” ì´í•´ì™€ ì‚¬ìƒ‰ì  ì½ê¸°ì— íƒì›”í•©ë‹ˆë‹¤. ì¸ë¬¼ì˜ ì‹¬ë¦¬ ë³€í™”ë‚˜ ì‚¬ê±´ì˜ ì¸ê³¼ê´€ê³„ë¥¼ ì˜ íŒŒì•…í•©ë‹ˆë‹¤.</p>
            </div>
            <div class="type-feature">
              <h4>ğŸ’¡ ê°œì„  ì¡°ì–¸</h4>
              <p>ë‹¤ì–‘í•œ ì¥ë¥´ ê²½í—˜ìœ¼ë¡œ ì½ê¸° í­ì„ ë„“í˜€ë³´ì„¸ìš”. ë¹ ë¥¸ ì†ë„ë¡œ ì •ë³´ë¥¼ íŒŒì•…í•˜ëŠ” ê¸°ìˆ ë„ ì—°ìŠµí•´ ë³´ì‹œê¸° ë°”ëë‹ˆë‹¤.</p>
            </div>
            <div class="type-feature">
              <h4>ğŸ“š ì¶”ì²œ ì±… ìœ í˜•</h4>
              <p>ê¹Šì´ ìˆëŠ” ë¬¸í•™ì‘í’ˆ, ì‹¬ë¦¬ ì†Œì„¤, ì—­ì‚¬ ì†Œì„¤ ë“±ì´ ì¶”ì²œë©ë‹ˆë‹¤.</p>
            </div>
          </div>

          <div class="overview-box" style="margin-top: 30px;">
            <h3>ğŸ” ì´ ìœ í˜• ë…ìì˜ íŠ¹ì§•</h3>
            <ul style="margin-top: 12px; margin-left: 20px; font-size: var(--rp-font-size-base); color: var(--text-medium); line-height: 1.8;">
              <li>í…ìŠ¤íŠ¸ì˜ ì„¬ì„¸í•œ í‘œí˜„ê³¼ ìˆ¨ê²¨ì§„ ì˜ë¯¸ë¥¼ ì°¾ì•„ë‚´ëŠ” ëŠ¥ë ¥</li>
              <li>ë“±ì¥ì¸ë¬¼ì˜ ë™ê¸°ì™€ ê°ì • ë³€í™”ë¥¼ ê¹Šì´ ìˆê²Œ ì´í•´</li>
              <li>ë…ì„œë¥¼ í†µí•œ ê¹Šì´ ìˆëŠ” ì‚¬ìƒ‰ê³¼ ì„±ì°°</li>
              <li>ë³µì¡í•œ í”Œë¡¯ê³¼ ì² í•™ì  ì£¼ì œì— ëŒ€í•œ ê´€ì‹¬</li>
              <li>ì²œì²œíˆ ì •ë…í•˜ëŠ” ì½ê¸° ë°©ì‹ì„ ì„ í˜¸</li>
            </ul>
          </div>

          <div class="overview-box" style="margin-top: 30px;">
            <h3>âœ¨ íš¨ê³¼ì ì¸ í•™ìŠµ ì „ëµ</h3>
            <ul style="margin-top: 12px; margin-left: 20px; font-size: var(--rp-font-size-base); color: var(--text-medium); line-height: 1.8;">
              <li>ì½ê¸° ì†ë„ í–¥ìƒì„ ìœ„í•œ ë‹¤ì–‘í•œ ë¬¸ì²´ì˜ ì±… ì½ê¸°</li>
              <li>ì£¼ì œë³„ ë¹„êµ ì½ê¸°ë¥¼ í†µí•œ ë¹„íŒì  ì‚¬ê³ ë ¥ ë°œì „</li>
              <li>ë‹¨ë¬¸ê³¼ ì¥ë¬¸ì„ ê· í˜• ìˆê²Œ ì½ê¸°</li>
              <li>ì‹œê°„ ì œì•½ì´ ìˆëŠ” í™˜ê²½ì—ì„œì˜ ì½ê¸° ì—°ìŠµ</li>
              <li>ì •ë³´ ê²€ìƒ‰ ë° ì†ë… ê¸°ìˆ ì˜ ê°œë°œ</li>
            </ul>
          </div>
        <% end %>
      </div>
    <% end %>
  </section>

  <!-- ì„¹ì…˜ 04: ì‹¬ì¸µ ë¶„ì„ -->
  <section class="section" id="analysis">
    <div class="section-header">
      <div class="section-number">04</div>
      <div class="section-title-group">
        <h2>ì‹¬ì¸µë¶„ì„</h2>
        <p>ì„ íƒ/ì„œìˆ í˜• ë¬¸í•­ ë¶„ì„</p>
      </div>
    </div>

    <p style="color: var(--text-medium); margin-bottom: 30px; font-size: var(--rp-font-size-md); line-height: 1.8;">
      ì´ ì„¹ì…˜ì—ì„œëŠ” <%= @student.name %>ë‹˜ì´ í‘¼ ê° ë¬¸í•­ì˜ ê²°ê³¼ë¥¼ ì˜ì—­ë³„ë¡œ ë¶„ì„í•©ë‹ˆë‹¤.
      ì •ë‹µë¥ , ë¬¸ì œ ìœ í˜•, ë‚œì´ë„ ë“±ì„ ì¢…í•©ì ìœ¼ë¡œ í‰ê°€í•˜ì—¬ í•™ìŠµ ê°•ì ê³¼ ê°œì„  ì˜ì—­ì„ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    </p>

    <% if @literacy_achievements.any? %>
      <table class="analysis-table">
        <thead>
          <tr>
            <th>í‰ê°€ ì˜ì—­</th>
            <th>ë¬¸ì œìˆ˜</th>
            <th>ì •ë‹µ</th>
            <th>ì •ë‹µë¥ </th>
            <th>ìˆ˜ì¤€</th>
            <th>ì§„ë„</th>
          </tr>
        </thead>
        <tbody>
          <% @literacy_achievements.each do |achievement| %>
            <tr>
              <td><strong><%= achievement.evaluation_indicator&.name || "ì˜ì—­" %></strong></td>
              <td><%= achievement.total_questions %></td>
              <td><%= achievement.correct_answers %></td>
              <td><strong><%= achievement.accuracy_rate %>%</strong></td>
              <td>
                <% rate = achievement.accuracy_rate.to_i %>
                <% if rate >= 80 %>
                  <span class="status-badge excellent">ìš°ìˆ˜</span>
                <% elsif rate >= 60 %>
                  <span class="status-badge good">ì–‘í˜¸</span>
                <% else %>
                  <span class="status-badge needs-improvement">ê°œì„  í•„ìš”</span>
                <% end %>
              </td>
              <td>
                <div class="progress-bar">
                  <div class="progress-bar-fill">
                    <div class="progress-bar-inner" style="width: <%= achievement.accuracy_rate %>%"></div>
                  </div>
                  <div class="progress-bar-value"><%= achievement.accuracy_rate %>%</div>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>

      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 40px;">
        <div class="overview-box">
          <h3>ğŸ’¡ ë¶„ì„ í•´ì„ ë°©ë²•</h3>
          <p style="font-size: var(--rp-font-size-sm); line-height: 1.7;">
            <strong>ì •ë‹µë¥  80% ì´ìƒ:</strong> ìš°ìˆ˜ - ë§¤ìš° ë›°ì–´ë‚œ ì„±ì·¨<br>
            <strong>ì •ë‹µë¥  60-79%:</strong> ì–‘í˜¸ - ê¸°ëŒ€ ìˆ˜ì¤€ì˜ ì„±ì·¨<br>
            <strong>ì •ë‹µë¥  60% ë¯¸ë§Œ:</strong> ê°œì„  í•„ìš” - ë³´ê°• í•™ìŠµ ê¶Œì¥
          </p>
        </div>
        <div class="overview-box">
          <h3>ğŸ¯ ì§„ë„ í‘œì‹œê¸° ì˜ë¯¸</h3>
          <p style="font-size: var(--rp-font-size-sm); line-height: 1.7;">
            ë§‰ëŒ€ ê·¸ë˜í”„ëŠ” í•´ë‹¹ ì˜ì—­ì˜ ì •ë‹µë¥ ì„ ì‹œê°ì ìœ¼ë¡œ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ë†’ì„ìˆ˜ë¡ í•´ë‹¹ ì˜ì—­ì—ì„œ ë” ìš°ìˆ˜í•œ ì„±ì ì„ ê±°ë‘ì—ˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
          </p>
        </div>
      </div>

      <% if @comprehensive_analysis && @comprehensive_analysis.comprehension_analysis %>
        <div class="overview-box" style="margin-top: 40px;">
          <h3>ğŸ“Š ì¢…í•© ë¶„ì„ ê²°ê³¼</h3>
          <p><%= @comprehensive_analysis.comprehension_analysis %></p>
        </div>
      <% end %>

      <div class="overview-box" style="margin-top: 40px;">
        <h3>ğŸ“Œ ì£¼ìš” ì¸ì‚¬ì´íŠ¸</h3>
        <ul style="margin-top: 12px; margin-left: 20px; font-size: var(--rp-font-size-base); color: var(--text-medium); line-height: 1.8;">
          <% if @literacy_achievements.max_by { |a| a.accuracy_rate.to_i } %>
            <li><strong>ê°€ì¥ ê°•í•œ ì˜ì—­:</strong> <%= @literacy_achievements.max_by { |a| a.accuracy_rate.to_i }.evaluation_indicator&.name %> (ì •ë‹µë¥ : <%= @literacy_achievements.max_by { |a| a.accuracy_rate.to_i }.accuracy_rate %>%)</li>
          <% end %>
          <% if @literacy_achievements.min_by { |a| a.accuracy_rate.to_i } %>
            <li><strong>ê°œì„ ì´ í•„ìš”í•œ ì˜ì—­:</strong> <%= @literacy_achievements.min_by { |a| a.accuracy_rate.to_i }.evaluation_indicator&.name %> (ì •ë‹µë¥ : <%= @literacy_achievements.min_by { |a| a.accuracy_rate.to_i }.accuracy_rate %>%)</li>
          <% end %>
          <li><strong>ì¢…í•© ì„±ê³¼:</strong> <%= ((@literacy_achievements.sum { |a| a.accuracy_rate.to_i } / @literacy_achievements.length).round)  %>% í‰ê·  ì •ë‹µë¥ </li>
        </ul>
      </div>
    <% else %>
      <p style="text-align: center; color: var(--text-light); padding: 40px 20px;">
        ğŸ“‹ ìƒì„¸ ë¶„ì„ ë°ì´í„°ë¥¼ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.
      </p>
    <% end %>
  </section>

  <!-- ì„¹ì…˜ 05: í•™ìƒ í”„ë¡œí•„ -->
  <section class="section" id="profile">
    <div class="section-header">
      <div class="section-number">05</div>
      <div class="section-title-group">
        <h2>í•™ìƒí”„ë¡œí•„</h2>
        <p>ê°œì¸ë³„ í•™ìŠµ ì§€ë„ ë°©í–¥</p>
      </div>
    </div>

    <p style="color: var(--text-medium); margin-bottom: 30px; font-size: var(--rp-font-size-md); line-height: 1.8;">
      ì´ ì„¹ì…˜ì€ <%= @student.name %>ë‹˜ì˜ ì§„ë‹¨ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê°œì¸ ë§ì¶¤í˜• í•™ìŠµ ë°©í–¥ì„ ì œì‹œí•©ë‹ˆë‹¤.
      ì˜ì—­ë³„ ê°•ì ì„ í™œìš©í•˜ê³  ê°œì„ ì´ í•„ìš”í•œ ë¶€ë¶„ì„ ë³´ì™„í•˜ê¸° ìœ„í•œ êµ¬ì²´ì ì¸ ì‹¤í–‰ ë°©ì•ˆì„ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.
    </p>

    <div class="overview-box" style="margin-bottom: 40px;">
      <h3>ğŸ“ í•™ìŠµ ëª©í‘œ</h3>
      <ul style="margin-top: 12px; margin-left: 20px; font-size: var(--rp-font-size-base); color: var(--text-medium); line-height: 1.8;">
        <li>í˜„ì¬ ê°•ì  ë¶„ì•¼ì—ì„œ ë”ìš± ê¹Šì´ ìˆëŠ” í•™ìŠµ ì§„í–‰</li>
        <li>ì•½ì  ë¶„ì•¼ì˜ ì²´ê³„ì ì¸ ë³´ê°•</li>
        <li>ë…ì„œ ìŠµê´€ì˜ í˜•ì„±ê³¼ ì§€ì†</li>
        <li>ë¬¸í•´ë ¥ ì „ë°˜ì˜ ì§€ì†ì ì¸ í–¥ìƒ</li>
      </ul>
    </div>

    <% if @guidance_directions.any? %>
      <div class="profile-grid">
        <% @guidance_directions.each_with_index do |direction, idx| %>
          <div class="profile-card">
            <h3><%= direction.evaluation_indicator&.name || "í•™ìŠµ ë°©í–¥" %></h3>
            <p><%= direction.content || "ì´ ì˜ì—­ì˜ ì§€ë„ ë‚´ìš©ì„ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤." %></p>
            <ul>
              <li>ê´€ë ¨ ì£¼ì œì˜ ì±… ì •ê¸°ì ìœ¼ë¡œ ì½ê¸°</li>
              <li>ì½ì€ ë‚´ìš© ì •ë¦¬ ë° ìš”ì•½í•˜ê¸°</li>
              <li>ë…ì„œ í›„ ê°ìƒ ë° ì˜ê²¬ ì‘ì„±í•˜ê¸°</li>
              <li>ê°™ì€ ì£¼ì œì˜ ë‹¤ì–‘í•œ ì±… ë¹„êµí•˜ê¸°</li>
            </ul>
          </div>
        <% end %>
      </div>

      <div class="overview-box" style="margin-top: 40px;">
        <h3>ğŸ“š ì¶”ì²œ í•™ìŠµ ë°©ë²•</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-top: 16px;">
          <div style="padding: 16px; background: var(--bg-light); border-radius: 8px;">
            <p style="font-weight: 600; color: var(--primary); margin-bottom: 8px;">ğŸ“– ëŠ¥ë™ì  ì½ê¸°</p>
            <p style="font-size: var(--rp-font-size-sm); color: var(--text-medium);">ë°‘ì¤„ ê·¸ìœ¼ë©° ì½ê¸°, í•µì‹¬ ë‹¨ì–´ í‘œì‹œ, ì˜ˆìƒ ê³¼ì • ì ê²€</p>
          </div>
          <div style="padding: 16px; background: var(--bg-light); border-radius: 8px;">
            <p style="font-weight: 600; color: var(--primary); margin-bottom: 8px;">âœï¸ ê¸°ë¡í•˜ê¸°</p>
            <p style="font-size: var(--rp-font-size-sm); color: var(--text-medium);">ë…ì„œ ì¼ì§€ ì‘ì„±, ëŠë‚€ì  ë©”ëª¨, ì¤‘ìš” êµ¬ì ˆ ê¸°ë¡</p>
          </div>
          <div style="padding: 16px; background: var(--bg-light); border-radius: 8px;">
            <p style="font-weight: 600; color: var(--primary); margin-bottom: 8px;">ğŸ’¬ í† ë¡ í•˜ê¸°</p>
            <p style="font-size: var(--rp-font-size-sm); color: var(--text-medium);">ê°€ì¡±ê³¼ í•¨ê»˜ ì˜ê²¬ ë‚˜ëˆ„ê¸°, ë…ì„œ ëª¨ì„ ì°¸ì—¬</p>
          </div>
          <div style="padding: 16px; background: var(--bg-light); border-radius: 8px;">
            <p style="font-weight: 600; color: var(--primary); margin-bottom: 8px;">ğŸ” ë¶„ì„í•˜ê¸°</p>
            <p style="font-size: var(--rp-font-size-sm); color: var(--text-medium);">í…ìŠ¤íŠ¸ êµ¬ì¡° íŒŒì•…, ì €ì ì˜ë„ ë¶„ì„</p>
          </div>
        </div>
      </div>

      <div class="overview-box" style="margin-top: 40px;">
        <h3>ğŸŒŸ ì„±ê³µì„ ìœ„í•œ íŒ</h3>
        <ul style="margin-top: 12px; margin-left: 20px; font-size: var(--rp-font-size-base); color: var(--text-medium); line-height: 1.8;">
          <li><strong>ì •ê¸°ì ì¸ ì½ê¸°:</strong> ë§¤ì¼ ì •í•´ì§„ ì‹œê°„ì— ì±…ì„ ì½ëŠ” ìŠµê´€ í˜•ì„±</li>
          <li><strong>ë‹¤ì–‘í•œ ì¥ë¥´ ì²´í—˜:</strong> í•œ ê°€ì§€ ì¥ë¥´ë§Œ ì•„ë‹Œ ì—¬ëŸ¬ ì¥ë¥´ì˜ ì±… ê²½í—˜</li>
          <li><strong>ì´í•´ë„ ì ê²€:</strong> ì½ì€ ë‚´ìš©ì— ëŒ€í•œ ì´í•´ ì •ë„ë¥¼ ìŠ¤ìŠ¤ë¡œ í™•ì¸</li>
          <li><strong>í¥ë¯¸ë¡œìš´ ì±… ì„ íƒ:</strong> í•™ìƒì´ ê´€ì‹¬ ìˆëŠ” ì£¼ì œì˜ ì±…ë¶€í„° ì‹œì‘</li>
          <li><strong>ë‹¨ê³„ì  ë„ì „:</strong> í˜„ì¬ ìˆ˜ì¤€ë³´ë‹¤ ì¡°ê¸ˆ ë†’ì€ ìˆ˜ì¤€ì˜ ì±…ìœ¼ë¡œ ì ì§„ì  ì§„ì „</li>
        </ul>
      </div>
    <% else %>
      <p style="text-align: center; color: var(--text-light); padding: 40px 20px;">
        ğŸ¯ í•™ìŠµ ì§€ë„ ë°©í–¥ì„ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.
      </p>
    <% end %>
  </section>

  <!-- ì•¡ì…˜ ë²„íŠ¼ -->
  <div class="action-buttons">
    <button class="action-btn primary" onclick="downloadPDF()">ğŸ“¥ PDF ë‹¤ìš´ë¡œë“œ</button>
    <button class="action-btn primary" onclick="printReport()">ğŸ–¨ï¸ ì¸ì‡„í•˜ê¸°</button>
    <a href="<%= student_reports_path %>" class="action-btn">â† ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
  </div>
</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
  function updateNav(e, sectionId) {
    e.preventDefault();
    const element = document.getElementById(sectionId);
    if (element) {
      element.scrollIntoView({ behavior: 'smooth', block: 'start' });

      // Update active nav
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });
      e.target.classList.add('active');
    }
  }

  function downloadPDF() {
    // í—¤ë”ì™€ ì»¨í…ì¸ ë§Œ ì¶”ì¶œ
    const headerElement = document.querySelector('.report-header');
    const contentElement = document.querySelector('.report-container');

    // ì»¨í…Œì´ë„ˆ ìƒì„±
    const container = document.createElement('div');
    container.appendChild(headerElement.cloneNode(true));
    container.appendChild(contentElement.cloneNode(true));

    const opt = {
      margin: 10,
      filename: '<%= "#{@student.name}_ë¬¸í•´ë ¥ì§„ë‹¨ê²°ê³¼ë³´ê³ ì„œ_#{@attempt.started_at&.strftime('%Y%m%d')}" %>.pdf',
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2 },
      jsPDF: { orientation: 'portrait', unit: 'mm', format: 'a4' }
    };

    html2pdf().set(opt).from(container).save();
  }

  function printReport() {
    window.print();
  }

  // ìŠ¤í¬ë¡¤ ì‹œ ë„¤ë¹„ê²Œì´ì…˜ ì—…ë°ì´íŠ¸
  window.addEventListener('scroll', () => {
    const sections = ['toc', 'overview', 'reader-type', 'analysis', 'profile'];
    const navItems = document.querySelectorAll('.nav-item');

    let current = '';
    sections.forEach(sectionId => {
      const element = document.getElementById(sectionId);
      if (element && element.offsetTop - 150 <= window.scrollY) {
        current = sectionId;
      }
    });

    navItems.forEach(item => {
      item.classList.remove('active');
      if (item.getAttribute('href').includes(current)) {
        item.classList.add('active');
      }
    });
  });
</script>

<% content_for :portal_actions do %>
  <a class="portal-button" href="<%= student_reports_path %>">ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
<% end %>
