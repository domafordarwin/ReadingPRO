<% content_for :page_title do %>진단 현황<% end %>
<% content_for :portal_nav do %>
  <%= render "student/shared/nav", current: :diagnostics %>
<% end %>

<div style="padding: 20px;">
  <h2>진단 현황</h2>

  <h3>이용 가능한 진단 (<%= @available_forms.count %>개)</h3>
  <% if @available_forms.any? %>
    <% @available_forms.each do |form| %>
      <div style="border: 1px solid #ccc; padding: 15px; margin: 10px 0;">
        <h4><%= form.title %></h4>
        <p>문항 수: <%= form.items.count %>개</p>
        <%= button_to "시작하기", student_assessments_path(form_id: form.id), method: :post, class: "rp-btn rp-btn--primary" %>
      </div>
    <% end %>
  <% else %>
    <p>이용 가능한 진단이 없습니다.</p>
  <% end %>

  <h3>진행 중인 진단 (<%= @in_progress_attempts.count %>개)</h3>
  <% if @in_progress_attempts.any? %>
    <% @in_progress_attempts.each do |attempt| %>
      <div style="border: 1px solid #ccc; padding: 15px; margin: 10px 0;">
        <h4><%= attempt.form&.title || "제목 없음" %></h4>
        <p>시작: <%= attempt.started_at&.strftime("%m월 %d일") %></p>
      </div>
    <% end %>
  <% else %>
    <p>진행 중인 진단이 없습니다.</p>
  <% end %>

  <h3>완료된 진단 (<%= @completed_attempts.count %>개)</h3>
  <% if @completed_attempts.any? %>
    <% @completed_attempts.each do |attempt| %>
      <div style="border: 1px solid #ccc; padding: 15px; margin: 10px 0;">
        <h4><%= attempt.form&.title || "제목 없음" %></h4>
        <p>완료: <%= attempt.submitted_at&.strftime("%m월 %d일") %></p>
        <%= link_to "결과보기", student_show_attempt_path(attempt.id), class: "rp-btn rp-btn--secondary" %>
      </div>
    <% end %>
  <% else %>
    <p>완료된 진단이 없습니다.</p>
  <% end %>
</div>
