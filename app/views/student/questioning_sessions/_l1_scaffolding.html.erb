<%#
  L1 초저(초1-2) 수준 스캐폴딩 UI - V2 전면 개선
  큰 글자, 큰 버튼, 밝은 파스텔, 단계별 순차 표시

  Local variables:
    - current_stage (Integer, 1-3)
    - module_obj (QuestioningModule)
    - stimulus (ReadingStimulus)
%>

<%
  scaffolding_level = 3
  if defined?(@student) && @student.present? && module_obj.present?
    progress = @student.questioning_progresses.find_by(
      evaluation_indicator: module_obj.questioning_templates.first&.evaluation_indicator
    )
    scaffolding_level = progress&.current_scaffolding || 3
  end

  stage_emojis = { 1 => "&#128218;", 2 => "&#128483;", 3 => "&#127793;" }
  stage_names = { 1 => "책문열기", 2 => "이야기나누기", 3 => "삶적용" }
%>

<style>
  /* ============================================
     L1 Kid-Friendly UI - Bright & Big
     ============================================ */

  .l1-kid {
    font-size: 18px;
    line-height: 1.7;
  }

  /* --- Header Banner --- */
  .l1-kid__banner {
    text-align: center;
    padding: 24px 20px 20px;
    background: linear-gradient(135deg, #fef3c7, #fbcfe8, #ddd6fe);
    border-radius: 20px;
    margin-bottom: 20px;
    border: 2px solid #fde68a;
  }

  .l1-kid__banner-mascot {
    font-size: 48px;
    line-height: 1;
    margin-bottom: 8px;
  }

  .l1-kid__banner-title {
    font-size: 24px;
    font-weight: 800;
    color: #7c3aed;
    margin: 0;
  }

  .l1-kid__banner-sub {
    font-size: 16px;
    color: #6b21a8;
    margin-top: 4px;
  }

  /* --- Step Tabs --- */
  .l1-kid__tabs {
    display: flex;
    gap: 8px;
    margin-bottom: 20px;
    padding: 0 4px;
  }

  .l1-kid__tab {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    padding: 14px 8px;
    background: white;
    border: 3px solid #e5e7eb;
    border-radius: 16px;
    cursor: pointer;
    font-family: inherit;
    transition: all 0.2s;
    font-size: 15px;
    font-weight: 700;
    color: #6b7280;
  }

  .l1-kid__tab--active {
    border-color: #8b5cf6;
    background: #f5f3ff;
    color: #7c3aed;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.15);
  }

  .l1-kid__tab-emoji {
    font-size: 28px;
    line-height: 1;
  }

  .l1-kid__tab-label {
    font-size: 13px;
  }

  /* --- Step Panels --- */
  .l1-kid__panel {
    display: none;
  }

  .l1-kid__panel--active {
    display: block;
  }

  /* --- Character Guide (speech bubble) --- */
  .l1-kid__guide {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    margin-bottom: 20px;
    padding: 16px 20px;
    background: #fef9c3;
    border: 2px solid #fde68a;
    border-radius: 20px;
    position: relative;
  }

  .l1-kid__guide-mascot {
    font-size: 40px;
    flex-shrink: 0;
    line-height: 1;
  }

  .l1-kid__guide-text {
    font-size: 18px;
    color: #92400e;
    line-height: 1.7;
    font-weight: 600;
  }

  /* --- Big Emoji Selector --- */
  .l1-kid__emoji-grid {
    display: flex;
    justify-content: center;
    gap: 12px;
    flex-wrap: wrap;
    padding: 8px 0;
  }

  .l1-kid__emoji-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    padding: 16px;
    background: white;
    border: 3px solid #e5e7eb;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.2s;
    font-family: inherit;
    min-width: 88px;
  }

  .l1-kid__emoji-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 16px rgba(0,0,0,0.1);
  }

  .l1-kid__emoji-btn--selected {
    border-color: #8b5cf6;
    background: #f5f3ff;
    transform: scale(1.12);
    box-shadow: 0 4px 16px rgba(139, 92, 246, 0.2);
  }

  .l1-kid__emoji-face {
    font-size: 48px;
    line-height: 1;
  }

  .l1-kid__emoji-label {
    font-size: 16px;
    font-weight: 700;
    color: #374151;
  }

  /* --- O/X Statement Box --- */
  .l1-kid__ox-statement {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 18px 22px;
    margin-bottom: 16px;
    background: #fff7ed;
    border: 3px solid #fdba74;
    border-radius: 16px;
  }

  .l1-kid__ox-statement-icon {
    font-size: 36px;
    flex-shrink: 0;
    line-height: 1;
  }

  .l1-kid__ox-statement-text {
    font-size: 20px;
    font-weight: 700;
    color: #9a3412;
    line-height: 1.5;
  }

  /* --- Big O/X Buttons --- */
  .l1-kid__ox-row {
    display: flex;
    justify-content: center;
    gap: 32px;
    padding: 12px 0;
  }

  .l1-kid__ox-btn {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 4px;
    cursor: pointer;
    font-family: inherit;
    transition: all 0.2s;
    border: 4px solid;
  }

  .l1-kid__ox-btn:hover {
    transform: scale(1.08);
  }

  .l1-kid__ox-btn--o {
    background: #f0fdf4;
    border-color: #86efac;
  }

  .l1-kid__ox-btn--o:hover {
    background: #dcfce7;
    border-color: #22c55e;
  }

  .l1-kid__ox-btn--x {
    background: #fef2f2;
    border-color: #fca5a5;
  }

  .l1-kid__ox-btn--x:hover {
    background: #fee2e2;
    border-color: #ef4444;
  }

  .l1-kid__ox-symbol {
    font-size: 40px;
    font-weight: 900;
    line-height: 1;
  }

  .l1-kid__ox-btn--o .l1-kid__ox-symbol { color: #16a34a; }
  .l1-kid__ox-btn--x .l1-kid__ox-symbol { color: #dc2626; }

  .l1-kid__ox-text {
    font-size: 14px;
    font-weight: 700;
    color: #374151;
  }

  .l1-kid__ox-btn--selected {
    transform: scale(1.15);
    box-shadow: 0 6px 20px rgba(0,0,0,0.15);
  }

  .l1-kid__ox-btn--o.l1-kid__ox-btn--selected {
    background: #dcfce7;
    border-color: #16a34a;
  }

  .l1-kid__ox-btn--x.l1-kid__ox-btn--selected {
    background: #fee2e2;
    border-color: #dc2626;
  }

  /* --- Template Cards (1-column, big) --- */
  .l1-kid__template-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .l1-kid__template-card {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 18px 20px;
    background: white;
    border: 3px solid #e5e7eb;
    border-radius: 16px;
    cursor: pointer;
    text-align: left;
    font-family: inherit;
    transition: all 0.2s;
    width: 100%;
  }

  .l1-kid__template-card:hover {
    border-color: #8b5cf6;
    background: #faf5ff;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.1);
  }

  .l1-kid__template-card--selected {
    border-color: #8b5cf6;
    background: #f5f3ff;
    box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.15);
  }

  .l1-kid__template-icon {
    font-size: 36px;
    flex-shrink: 0;
    line-height: 1;
  }

  .l1-kid__template-text {
    font-size: 18px;
    font-weight: 600;
    color: #374151;
    line-height: 1.5;
  }

  .l1-kid__template-text strong {
    color: #7c3aed;
  }

  /* --- Section Divider --- */
  .l1-kid__divider {
    display: flex;
    align-items: center;
    gap: 12px;
    margin: 20px 0;
    color: #9ca3af;
    font-size: 15px;
    font-weight: 600;
  }

  .l1-kid__divider::before,
  .l1-kid__divider::after {
    content: "";
    flex: 1;
    height: 2px;
    background: #e5e7eb;
    border-radius: 1px;
  }

  /* --- Scaffolding Badge --- */
  .l1-kid__level-badge {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px 16px;
    background: #eff6ff;
    border: 2px solid #bfdbfe;
    border-radius: 14px;
    margin-bottom: 16px;
  }

  .l1-kid__level-badge-icon {
    font-size: 28px;
    flex-shrink: 0;
  }

  .l1-kid__level-badge-text {
    font-size: 16px;
    color: #1e40af;
    font-weight: 600;
    line-height: 1.4;
  }

  /* --- Scroll Hint Banner --- */
  .l1-kid__scroll-hint {
    display: none;
    align-items: center;
    justify-content: center;
    gap: 12px;
    padding: 16px 20px;
    margin-top: 16px;
    background: linear-gradient(135deg, #ede9fe, #ddd6fe);
    border: 2px solid #a78bfa;
    border-radius: 16px;
    animation: l1-bounce 0.6s ease;
  }

  .l1-kid__scroll-hint--visible {
    display: flex;
  }

  .l1-kid__scroll-hint-icon {
    font-size: 32px;
    line-height: 1;
    animation: l1-point 1s ease infinite;
  }

  .l1-kid__scroll-hint-text {
    font-size: 18px;
    font-weight: 700;
    color: #5b21b6;
  }

  @keyframes l1-bounce {
    0% { transform: scale(0.9); opacity: 0; }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); opacity: 1; }
  }

  @keyframes l1-point {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(6px); }
  }

  /* --- Responsive --- */
  @media (max-width: 768px) {
    .l1-kid { font-size: 16px; }
    .l1-kid__banner-title { font-size: 20px; }
    .l1-kid__banner-mascot { font-size: 40px; }
    .l1-kid__emoji-face { font-size: 40px; }
    .l1-kid__emoji-btn { min-width: 72px; padding: 12px; }
    .l1-kid__ox-btn { width: 100px; height: 100px; }
    .l1-kid__ox-symbol { font-size: 32px; }
    .l1-kid__template-icon { font-size: 28px; }
    .l1-kid__template-text { font-size: 16px; }
    .l1-kid__tab { padding: 10px 6px; }
    .l1-kid__tab-emoji { font-size: 22px; }
    .l1-kid__tab-label { font-size: 11px; }
    .l1-kid__guide-text { font-size: 16px; }
    .l1-kid__guide-mascot { font-size: 32px; }
  }
</style>

<div class="l1-kid" id="l1-scaffolding-panel">

  <!-- Banner -->
  <div class="l1-kid__banner">
    <div class="l1-kid__banner-mascot">&#127775;</div>
    <h2 class="l1-kid__banner-title">오늘의 질문을 만들어요!</h2>
    <div class="l1-kid__banner-sub"><%= stage_names[current_stage] %> 단계</div>
  </div>

  <!-- Step Tabs -->
  <div class="l1-kid__tabs" role="tablist" aria-label="도움 단계 선택">
    <button type="button" class="l1-kid__tab l1-kid__tab--active" role="tab"
            aria-selected="true" onclick="l1SwitchTab(this, 'l1-panel-feel')" id="l1-tab-feel">
      <span class="l1-kid__tab-emoji">&#128522;</span>
      <span class="l1-kid__tab-label">감정 고르기</span>
    </button>
    <% if scaffolding_level >= 2 %>
      <button type="button" class="l1-kid__tab" role="tab"
              aria-selected="false" onclick="l1SwitchTab(this, 'l1-panel-template')" id="l1-tab-template">
        <span class="l1-kid__tab-emoji">&#128172;</span>
        <span class="l1-kid__tab-label">따라 쓰기</span>
      </button>
    <% end %>
    <button type="button" class="l1-kid__tab" role="tab"
            aria-selected="false" onclick="l1SwitchTab(this, 'l1-panel-free')" id="l1-tab-free">
      <span class="l1-kid__tab-emoji">&#9997;</span>
      <span class="l1-kid__tab-label">직접 쓰기</span>
    </button>
  </div>

  <!-- Scaffolding Level Badge -->
  <div class="l1-kid__level-badge" aria-label="스캐폴딩 안내">
    <% if scaffolding_level == 3 %>
      <span class="l1-kid__level-badge-icon">&#127919;</span>
      <span class="l1-kid__level-badge-text">도움 많이 받기 - 감정 고르기, O/X, 따라 쓰기를 사용해요!</span>
    <% elsif scaffolding_level == 2 %>
      <span class="l1-kid__level-badge-icon">&#128170;</span>
      <span class="l1-kid__level-badge-text">조금만 도움받기 - 감정 고르기와 따라 쓰기를 참고해요!</span>
    <% elsif scaffolding_level == 1 %>
      <span class="l1-kid__level-badge-icon">&#11088;</span>
      <span class="l1-kid__level-badge-text">힌트만 보기 - 팁을 참고해서 발문을 만들어요!</span>
    <% elsif scaffolding_level == 0 %>
      <span class="l1-kid__level-badge-icon">&#127941;</span>
      <span class="l1-kid__level-badge-text">혼자서 해보기 - 멋진 발문을 자유롭게 만들어 봐!</span>
    <% end %>
  </div>

  <!-- ============================================
       Panel 1: 감정 고르기 (Feel)
       ============================================ -->
  <div class="l1-kid__panel l1-kid__panel--active" id="l1-panel-feel" role="tabpanel">

    <!-- Character Guide -->
    <div class="l1-kid__guide">
      <span class="l1-kid__guide-mascot">&#129412;</span>
      <span class="l1-kid__guide-text">
        <% if current_stage == 1 %>
          책 속 친구는 어떤 기분일까? 감정을 하나 골라 봐!
        <% elsif current_stage == 2 %>
          이 장면에서 인물은 어떤 마음일까? 골라 봐!
        <% else %>
          나라면 어떤 기분이 들었을까? 골라 봐!
        <% end %>
      </span>
    </div>

    <!-- Emoji Selector -->
    <div class="l1-kid__emoji-grid" role="group" aria-label="감정 선택">
      <button type="button" class="l1-kid__emoji-btn" aria-label="기쁨"
              onclick="l1SelectEmotion(this, '기쁨')">
        <span class="l1-kid__emoji-face">&#128522;</span>
        <span class="l1-kid__emoji-label">기쁨</span>
      </button>
      <button type="button" class="l1-kid__emoji-btn" aria-label="슬픔"
              onclick="l1SelectEmotion(this, '슬픔')">
        <span class="l1-kid__emoji-face">&#128546;</span>
        <span class="l1-kid__emoji-label">슬픔</span>
      </button>
      <button type="button" class="l1-kid__emoji-btn" aria-label="놀람"
              onclick="l1SelectEmotion(this, '놀람')">
        <span class="l1-kid__emoji-face">&#128558;</span>
        <span class="l1-kid__emoji-label">놀람</span>
      </button>
      <button type="button" class="l1-kid__emoji-btn" aria-label="화남"
              onclick="l1SelectEmotion(this, '화남')">
        <span class="l1-kid__emoji-face">&#128544;</span>
        <span class="l1-kid__emoji-label">화남</span>
      </button>
      <button type="button" class="l1-kid__emoji-btn" aria-label="무서움"
              onclick="l1SelectEmotion(this, '무서움')">
        <span class="l1-kid__emoji-face">&#128552;</span>
        <span class="l1-kid__emoji-label">무서움</span>
      </button>
    </div>

    <% if scaffolding_level >= 3 %>
      <div class="l1-kid__divider">또는</div>

      <!-- O/X Selector -->
      <div class="l1-kid__guide">
        <span class="l1-kid__guide-mascot">&#129302;</span>
        <span class="l1-kid__guide-text">
          아래 문장을 읽고, 맞으면 O, 아니면 X를 눌러!
        </span>
      </div>

      <!-- 판단 대상 문장 -->
      <div class="l1-kid__ox-statement" id="l1-ox-statement">
        <span class="l1-kid__ox-statement-icon">&#128172;</span>
        <span class="l1-kid__ox-statement-text">
          <% if current_stage == 1 %>
            "이 이야기의 주인공은 행복했을 거야."
          <% elsif current_stage == 2 %>
            "주인공이 한 행동은 옳았어."
          <% else %>
            "나도 주인공처럼 했을 거야."
          <% end %>
        </span>
      </div>

      <div class="l1-kid__ox-row" role="group" aria-label="O/X 선택">
        <button type="button" class="l1-kid__ox-btn l1-kid__ox-btn--o" aria-label="맞아요 (O)"
                onclick="l1SelectOX(this, true)">
          <span class="l1-kid__ox-symbol">O</span>
          <span class="l1-kid__ox-text">맞아요</span>
        </button>
        <button type="button" class="l1-kid__ox-btn l1-kid__ox-btn--x" aria-label="아니에요 (X)"
                onclick="l1SelectOX(this, false)">
          <span class="l1-kid__ox-symbol">X</span>
          <span class="l1-kid__ox-text">아니에요</span>
        </button>
      </div>
    <% end %>
  </div>

  <!-- ============================================
       Panel 2: 따라 쓰기 (Template)
       ============================================ -->
  <% if scaffolding_level >= 2 %>
    <div class="l1-kid__panel" id="l1-panel-template" role="tabpanel">

      <div class="l1-kid__guide">
        <span class="l1-kid__guide-mascot">&#128038;</span>
        <span class="l1-kid__guide-text">
          마음에 드는 질문을 골라 봐! 자동으로 적혀요!
        </span>
      </div>

      <div class="l1-kid__template-list">
        <% if current_stage == 1 %>
          <button type="button" class="l1-kid__template-card"
                  onclick="l1UseTemplate(this, '이 이야기를 읽으면 어떤 마음이 들까?')">
            <span class="l1-kid__template-icon">&#128151;</span>
            <span class="l1-kid__template-text">이 이야기를 읽으면 <strong>어떤 마음</strong>이 들까?</span>
          </button>
          <button type="button" class="l1-kid__template-card"
                  onclick="l1UseTemplate(this, '제목을 보니까 어떤 이야기일 것 같아?')">
            <span class="l1-kid__template-icon">&#128270;</span>
            <span class="l1-kid__template-text">제목을 보니까 <strong>어떤 이야기</strong>일 것 같아?</span>
          </button>
          <button type="button" class="l1-kid__template-card"
                  onclick="l1UseTemplate(this, '나는 이런 경험을 한 적이 있어!')">
            <span class="l1-kid__template-icon">&#128588;</span>
            <span class="l1-kid__template-text">나는 <strong>이런 경험</strong>을 한 적이 있어!</span>
          </button>
        <% elsif current_stage == 2 %>
          <button type="button" class="l1-kid__template-card"
                  onclick="l1UseTemplate(this, '(인물)은(는) 어떤 마음이었을까?')">
            <span class="l1-kid__template-icon">&#128151;</span>
            <span class="l1-kid__template-text">(인물)은(는) <strong>어떤 마음</strong>이었을까?</span>
          </button>
          <button type="button" class="l1-kid__template-card"
                  onclick="l1UseTemplate(this, '(인물)이 그렇게 한 이유는 뭐라고 생각해?')">
            <span class="l1-kid__template-icon">&#129488;</span>
            <span class="l1-kid__template-text">(인물)이 그렇게 한 <strong>이유</strong>는 뭐라고 생각해?</span>
          </button>
          <button type="button" class="l1-kid__template-card"
                  onclick="l1UseTemplate(this, '이 장면에서 무슨 일이 일어났어?')">
            <span class="l1-kid__template-icon">&#127912;</span>
            <span class="l1-kid__template-text">이 장면에서 <strong>무슨 일</strong>이 일어났어?</span>
          </button>
        <% else %>
          <button type="button" class="l1-kid__template-card"
                  onclick="l1UseTemplate(this, '나라면 어떻게 했을까?')">
            <span class="l1-kid__template-icon">&#128588;</span>
            <span class="l1-kid__template-text"><strong>나라면</strong> 어떻게 했을까?</span>
          </button>
          <button type="button" class="l1-kid__template-card"
                  onclick="l1UseTemplate(this, '가장 좋았던 장면은 어디야? 왜 좋았어?')">
            <span class="l1-kid__template-icon">&#127775;</span>
            <span class="l1-kid__template-text"><strong>가장 좋았던 장면</strong>은 어디야? 왜 좋았어?</span>
          </button>
          <button type="button" class="l1-kid__template-card"
                  onclick="l1UseTemplate(this, '우리 반에서 지금 할 수 있는 작은 실천은 뭐가 있을까?')">
            <span class="l1-kid__template-icon">&#127793;</span>
            <span class="l1-kid__template-text">우리 반에서 할 수 있는 <strong>작은 실천</strong>은 뭐가 있을까?</span>
          </button>
        <% end %>
      </div>
    </div>
  <% end %>

  <!-- ============================================
       Panel 3: 직접 쓰기 (Free)
       ============================================ -->
  <div class="l1-kid__panel" id="l1-panel-free" role="tabpanel">

    <div class="l1-kid__guide">
      <span class="l1-kid__guide-mascot">&#128640;</span>
      <span class="l1-kid__guide-text">
        내가 궁금한 것을 자유롭게 써 봐! 아무 질문이나 좋아!
      </span>
    </div>

    <!-- Tips (smaller, for reference) -->
    <div style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 16px;">
      <div style="display: flex; align-items: center; gap: 10px; padding: 10px 14px; background: #fffbeb; border-radius: 12px; border: 1px solid #fde68a;">
        <span style="font-size: 24px;">&#128161;</span>
        <span style="font-size: 16px; color: #92400e; font-weight: 600;">
          한 번에 한 가지만 물어보면 돼!
        </span>
      </div>
      <div style="display: flex; align-items: center; gap: 10px; padding: 10px 14px; background: #fdf2f8; border-radius: 12px; border: 1px solid #fbcfe8;">
        <span style="font-size: 24px;">&#128151;</span>
        <span style="font-size: 16px; color: #9d174d; font-weight: 600;">
          "어떤 마음이 들었니?" 같은 느낌을 물어보면 좋아!
        </span>
      </div>
    </div>

    <p style="text-align: center; color: #6b7280; font-size: 15px;">
      아래 입력칸에 나만의 질문을 적어 봐!
    </p>
  </div>

  <!-- Scroll Hint (shown after selection) -->
  <div class="l1-kid__scroll-hint" id="l1-scroll-hint">
    <span class="l1-kid__scroll-hint-icon">&#128071;</span>
    <span class="l1-kid__scroll-hint-text">아래에서 제출하기를 눌러요!</span>
  </div>

</div><!-- /.l1-kid -->

<!-- ============================== -->
<!-- L1 JavaScript                  -->
<!-- ============================== -->
<script>
  // Tab switching
  function l1SwitchTab(btn, panelId) {
    // Deactivate all tabs
    var tabs = document.querySelectorAll('.l1-kid__tab');
    tabs.forEach(function(t) {
      t.classList.remove('l1-kid__tab--active');
      t.setAttribute('aria-selected', 'false');
    });

    // Hide all panels
    var panels = document.querySelectorAll('.l1-kid__panel');
    panels.forEach(function(p) {
      p.classList.remove('l1-kid__panel--active');
    });

    // Activate selected
    btn.classList.add('l1-kid__tab--active');
    btn.setAttribute('aria-selected', 'true');
    var panel = document.getElementById(panelId);
    if (panel) panel.classList.add('l1-kid__panel--active');
  }

  // Emoji emotion selector
  function l1SelectEmotion(btn, emotionName) {
    var allBtns = document.querySelectorAll('.l1-kid__emoji-btn');
    allBtns.forEach(function(b) { b.classList.remove('l1-kid__emoji-btn--selected'); });
    btn.classList.add('l1-kid__emoji-btn--selected');

    var textarea = document.getElementById('question-text-input');
    if (textarea) {
      textarea.value = '(인물)은(는) ' + emotionName + ' 기분일 것 같아요. 왜냐하면...';
      textarea.focus();
      textarea.setSelectionRange(textarea.value.length, textarea.value.length);
      var counter = document.getElementById('char-count');
      if (counter) counter.textContent = textarea.value.length;
    }
    l1MarkAsGuided();
  }

  // O/X selector
  function l1SelectOX(btn, isO) {
    var allBtns = document.querySelectorAll('.l1-kid__ox-btn');
    allBtns.forEach(function(b) { b.classList.remove('l1-kid__ox-btn--selected'); });
    btn.classList.add('l1-kid__ox-btn--selected');

    // 판단 문장 가져오기
    var statementEl = document.getElementById('l1-ox-statement');
    var statement = '';
    if (statementEl) {
      var textEl = statementEl.querySelector('.l1-kid__ox-statement-text');
      if (textEl) statement = textEl.textContent.trim().replace(/^"|"$/g, '');
    }

    var textarea = document.getElementById('question-text-input');
    if (textarea) {
      textarea.value = isO
        ? statement + ' → 맞아요! 왜냐하면...'
        : statement + ' → 아니에요! 왜냐하면...';
      textarea.focus();
      textarea.setSelectionRange(textarea.value.length, textarea.value.length);
      var counter = document.getElementById('char-count');
      if (counter) counter.textContent = textarea.value.length;
    }
    l1MarkAsGuided();
  }

  // Template card selector
  function l1UseTemplate(btn, templateText) {
    var allCards = document.querySelectorAll('.l1-kid__template-card');
    allCards.forEach(function(c) { c.classList.remove('l1-kid__template-card--selected'); });
    btn.classList.add('l1-kid__template-card--selected');

    var textarea = document.getElementById('question-text-input');
    if (textarea) {
      textarea.value = templateText;
      textarea.focus();
      textarea.setSelectionRange(textarea.value.length, textarea.value.length);
      var counter = document.getElementById('char-count');
      if (counter) counter.textContent = textarea.value.length;
    }
    l1MarkAsGuided();
  }

  // Mark as guided question type + auto-scroll to form
  function l1MarkAsGuided() {
    var typeField = document.getElementById('question-type-field');
    var scaffField = document.getElementById('scaffolding-used-field');
    if (typeField) typeField.value = 'guided';
    if (scaffField) scaffField.value = 'true';
    if (typeof updateTypeButtons === 'function') {
      updateTypeButtons('guided');
    }
    // Show scroll hint and auto-scroll to form
    l1ShowScrollHint();
  }

  // Show a visual hint and scroll to the form
  function l1ShowScrollHint() {
    // Show the scroll hint banner
    var hint = document.getElementById('l1-scroll-hint');
    if (hint) {
      hint.style.display = 'flex';
      hint.classList.add('l1-kid__scroll-hint--visible');
    }
    // Highlight the textarea
    var textarea = document.getElementById('question-text-input');
    if (textarea) {
      textarea.style.borderColor = '#8b5cf6';
      textarea.style.boxShadow = '0 0 0 4px rgba(139, 92, 246, 0.2)';
    }
    // Smooth scroll to the form after a short delay
    setTimeout(function() {
      var formArea = document.getElementById('questioning-form-area');
      if (formArea) {
        formArea.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    }, 400);
  }
</script>
