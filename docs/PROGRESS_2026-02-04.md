# λ¬Έν•­ μ€ν–‰ μ¬μ„¤κ³„ μ‘μ—… μ§„ν–‰ μƒν™©

## π“… λ‚ μ§: 2026-02-04
## β° μ‹μ‘ μ‹κ°„: μ¤ν›„ 4:30

---

## β… μ™„λ£λ μ‘μ—…

### 1. ν„ν™© λ¶„μ„ λ° μ„¤κ³„ (4:30 - 4:35)
- β… ν„μ¬ DB μ¤ν‚¤λ§ λ¶„μ„ μ™„λ£
- β… λ¬Έμ μ  νμ•…:
  - ReadingStimulusμ— λ¬Έν•­ μ½”λ“ λ°°μ—΄ μ—†μ
  - Itemμ— stimulus_code μ°Έμ΅° μ—†μ
  - μ§„λ‹¨μ§€ μ„ΈνΈ κ°λ… μ—†μ
- β… μƒλ΅μ΄ μ„¤κ³„ λ¬Έμ„ μ‘μ„±: `docs/ITEM_BANK_REDESIGN.md`

### 2. λ°μ΄ν„°λ² μ΄μ¤ λ§μ΄κ·Έλ μ΄μ… (4:35 - 4:42)
- β… λ§μ΄κ·Έλ μ΄μ… νμΌ μƒμ„±: `20260204111303_add_bundle_fields_to_reading_stimuli_and_items.rb`
- β… ReadingStimulus ν…μ΄λΈ” μ¶”κ°€ ν•„λ“:
  - `code` (string, NOT NULL, unique) - μ§€λ¬Έ κ³ μ  μ½”λ“
  - `item_codes` (text array) - μ—°κ²°λ λ¬Έν•­ μ½”λ“ λ°°μ—΄
  - `bundle_metadata` (jsonb) - μ„ΈνΈ λ©”νƒ€λ°μ΄ν„°
  - `bundle_status` (string) - draft/active/archived
- β… Item ν…μ΄λΈ” μ¶”κ°€ ν•„λ“:
  - `stimulus_code` (string) - μ§€λ¬Έ μ½”λ“ μ°Έμ΅°
- β… κΈ°μ΅΄ λ°μ΄ν„° λ§μ΄κ·Έλ μ΄μ… μ™„λ£ (λ¨λ“  κΈ°μ΅΄ stimulusμ— μ½”λ“ μƒμ„±)
- β… λ§μ΄κ·Έλ μ΄μ… μ‹¤ν–‰ μ„±κ³µ

### 3. λ¨λΈ μ—…λ°μ΄νΈ (4:42 - 4:45)
- β… `ReadingStimulus` λ¨λΈ μ—…λ°μ΄νΈ:
  - validations μ¶”κ°€ (code, bundle_status)
  - scopes μ¶”κ°€ (draft, active, archived)
  - `recalculate_bundle_metadata!` λ©”μ„λ“ μ¶”κ°€
  - Helper λ©”μ„λ“λ“¤ μ¶”κ°€ (mcq_count, constructed_count, etc.)
  - μλ™ μ½”λ“ μƒμ„± (`generate_code` before_validation)
  - ν•µμ‹¬ μ”μ† μ¶”μ¶ λ΅μ§ (`extract_key_concepts`)
  - μμƒ μ‹κ°„ κ³„μ‚° λ΅μ§ (`calculate_estimated_time`)
- β… `Item` λ¨λΈ μ—…λ°μ΄νΈ:
  - `update_stimulus_metadata` μ½λ°± μ¶”κ°€ (item λ³€κ²½ μ‹ stimulus λ©”νƒ€λ°μ΄ν„° μλ™ μ—…λ°μ΄νΈ)
  - `set_stimulus_code` μ½λ°± μ¶”κ°€ (item μƒμ„± μ‹ stimulus_code μλ™ μ„¤μ •)

### 4. λ¬Έμ„ν™” (4:30 - ν„μ¬)
- β… μ„¤κ³„ λ¬Έμ„: `docs/ITEM_BANK_REDESIGN.md`
- β… μ§„ν–‰ μƒν™© λ¬Έμ„: `docs/PROGRESS_2026-02-04.md` (ν„μ¬ νμΌ)

### 5. PdfItemParserService λ¦¬ν©ν† λ§ (μ™„λ£)
- β… `bundle_status: 'draft'` μ¶”κ°€
- β… Stimulus μ½”λ“ μλ™ μƒμ„± ν™•μΈ (λ¨λΈμ before_validation μ½λ°±)
- β… Bundle metadata μλ™ κ³„μ‚° ν™•μΈ (Itemμ after_commit μ½λ°±)

### 6. item_bank Controller & View μ¬μ„¤κ³„ (μ™„λ£)
- β… DashboardController#item_bank μμ •
  - @items β†’ @assessment_bundlesλ΅ λ³€κ²½
  - load_items_with_filters β†’ load_assessment_bundlesλ΅ λ³€κ²½
  - ReadingStimulus κΈ°λ° κ²€μƒ‰/ν•„ν„°λ§
  - Keyset νμ΄μ§€λ„¤μ΄μ… μ μ§€
- β… item_bank.html.erb μ™„μ „ μ¬μ‘μ„±
  - κ°λ³„ λ¬Έν•­ μΉ΄λ“ β†’ μ§„λ‹¨μ§€ μ„ΈνΈ μΉ΄λ“λ΅ λ³€κ²½
  - μ§€λ¬Έ μ λ©, μ”μ•½, ν†µκ³„ ν‘μ‹
  - ν•µμ‹¬ μ”μ†, λ‚μ΄λ„ λ¶„ν¬, μμƒ μ‹κ°„ ν‘μ‹
  - μƒνƒ λ°°μ§€ (draft/active/archived)
- β… κΈ°μ΅΄ νμΌ λ°±μ—…: item_bank_OLD_BACKUP.html.erb

### 7. CLAUDE.md λ¬Έμ„ν™” (μ™„λ£)
- β… μƒλ΅μ΄ μ„Ήμ… μ¶”κ°€: "π“¦ λ¬Έν•­ μ€ν–‰ μ•„ν‚¤ν…μ² (2026-02-04 μ¬μ„¤κ³„)"
- β… μ§„λ‹¨μ§€ μ„ΈνΈ κ°λ… λ…ν™•ν™”
- β… λ°μ΄ν„° λ¨λΈ κ΄€κ³„ λ¬Έμ„ν™”
- β… PDF μ—…λ΅λ“ μ›ν¬ν”λ΅μ° μ„¤λ…
- β… κ²€μ¦ λ° λ¬΄κ²°μ„± κ΄€λ¦¬ μ„¤λ…

---

## π”„ μ™„λ£λ μ¶”κ°€ μ‘μ—…

### 8. κ²€μ¦ λ΅μ§ μ¶”κ°€ β…
- β… BundleIntegrityValidator μ„λΉ„μ¤ μƒμ„± μ™„λ£
  - νμΌ: `app/services/bundle_integrity_validator.rb`
- β… κ²€μ¦ λ©”μ„λ“:
  - `validate!` - λ¬΄κ²°μ„± κ²€μ¦λ§ μν–‰
  - `validate_and_fix!` - κ²€μ¦ ν›„ μλ™ μμ • μ‹λ„
- β… κ²€μ¦ ν•­λ©:
  - μ§€λ¬Έ μ½”λ“ μ΅΄μ¬ λ° ν•μ‹ ν™•μΈ (λ§μ΄κ·Έλ μ΄μ…/λ¨λΈ μ–‘μ½ ν•μ‹ μ§€μ›)
  - μ—°κ²°λ λ¬Έν•­ μ΅΄μ¬ ν™•μΈ
  - item_codes λ°°μ—΄κ³Ό μ‹¤μ  λ¬Έν•­ μ½”λ“ μΌμΉ ν™•μΈ
  - bundle_metadata μ •ν™•μ„± ν™•μΈ (counts, difficulty_distribution, estimated_time)
  - stimulus_code μ°Έμ΅° ν™•μΈ
- β… Rake νƒμ¤ν¬ μƒμ„±:
  - νμΌ: `lib/tasks/bundle_integrity.rake`
  - `rails bundle:validate` - λ¨λ“  μ„ΈνΈ κ²€μ¦
  - `rails bundle:fix` - κ²€μ¦ λ° μλ™ μμ •
  - `rails bundle:recalculate_metadata` - λ©”νƒ€λ°μ΄ν„° μ¬κ³„μ‚°
  - `rails bundle:stats` - ν†µκ³„ ν™•μΈ

### 9. μ „μ²΄ ν…μ¤νΈ β…
- β… κΈ°μ΅΄ λ°μ΄ν„° κ²€μ¦ (bundle:validate)
  - κ²°κ³Ό: 10κ° μ„ΈνΈ μ¤‘ 4κ° μ •μƒ, 6κ°λ” λ¬Έν•­ μ—†μ (μμƒλ κ²°κ³Ό)
- β… ν†µκ³„ ν™•μΈ (bundle:stats)
  - μ „μ²΄ 10κ° μ„ΈνΈ, λ¨λ‘ draft μƒνƒ
  - ν‰κ· : MCQ 0.4κ°, μ„μ ν• 0.2κ°, μ†μ”μ‹κ°„ 1.8λ¶„
- β… μ§„λ‹¨μ§€ μ„ΈνΈ λ©”νƒ€λ°μ΄ν„° ν™•μΈ
  - Code μλ™ μƒμ„± ν™•μΈ
  - bundle_metadata μλ™ κ³„μ‚° ν™•μΈ
  - key_concepts μ¶”μ¶ ν™•μΈ
- β… λ¬Έν•­ μ€ν–‰ λ°μ΄ν„° κµ¬μ΅° κ²€μ¦
  - ReadingStimulusλ¥Ό μ§„λ‹¨μ§€ μ„ΈνΈλ΅ μ‚¬μ©
  - Item μƒμ„±/μ‚­μ  μ‹ μλ™ λ©”νƒ€λ°μ΄ν„° μ—…λ°μ΄νΈ ν™•μΈ

---

## π“ μ§„ν–‰λ¥ 

```
μ „μ²΄ μ‘μ—…: 10κ°
μ™„λ£: 10κ° (100%) β…
μ§„ν–‰μ¤‘: 0κ°
μμ •: 0κ°
```

---

## π”‘ μ£Όμ” λ³€κ²½μ‚¬ν•­ μ”μ•½

### λ°μ΄ν„°λ² μ΄μ¤
```sql
-- reading_stimuli ν…μ΄λΈ”
ALTER TABLE reading_stimuli ADD COLUMN code VARCHAR NOT NULL UNIQUE;
ALTER TABLE reading_stimuli ADD COLUMN item_codes TEXT[] DEFAULT '{}';
ALTER TABLE reading_stimuli ADD COLUMN bundle_metadata JSONB DEFAULT '{}';
ALTER TABLE reading_stimuli ADD COLUMN bundle_status VARCHAR DEFAULT 'draft';

-- items ν…μ΄λΈ”
ALTER TABLE items ADD COLUMN stimulus_code VARCHAR;
```

### λ¨λΈ κ΄€κ³„
```
ReadingStimulus (μ§„λ‹¨μ§€ μ„ΈνΈ)
β”β”€β”€ code: "STIM_1738662243_A3F2B1C4"
β”β”€β”€ item_codes: ["ITEM_001", "ITEM_002", "ITEM_S001"]
β”β”€β”€ bundle_metadata: {
β”‚     mcq_count: 2,
β”‚     constructed_count: 1,
β”‚     total_count: 3,
β”‚     key_concepts: ["μ μ •κΈ°μ ", "λ¬Ό μ •ν™”"],
β”‚     estimated_time_minutes: 9
β”‚   }
β””β”€β”€ has_many :items

Item (κ°λ³„ λ¬Έν•­)
β”β”€β”€ code: "ITEM_001"
β”β”€β”€ stimulus_code: "STIM_1738662243_A3F2B1C4"
β””β”€β”€ belongs_to :stimulus
```

---

## β οΈ μ£Όμμ‚¬ν•­

1. **κΈ°μ΅΄ λ°μ΄ν„°**: λ§μ΄κ·Έλ μ΄μ…μΌλ΅ λ¨λ“  κΈ°μ΅΄ stimulusμ— μλ™μΌλ΅ μ½”λ“ μƒμ„±λ¨
2. **μλ™ μ—…λ°μ΄νΈ**: Itemμ΄ μƒμ„±/μμ •/μ‚­μ λλ©΄ stimulusμ bundle_metadataκ°€ μλ™μΌλ΅ μ¬κ³„μ‚°λ¨
3. **μ½”λ“ μƒμ„± κ·μΉ™**: `STIM_{timestamp}_{random_hex}`
4. **κ²€μ¦**: BundleIntegrityValidatorλ΅ λ°μ΄ν„° λ¬΄κ²°μ„± ν™•μΈ ν•„μ”

---

## π“ λ‹¤μ μ„Έμ… μ‹μ‘ μ‹ ν™•μΈμ‚¬ν•­

1. λ§μ΄κ·Έλ μ΄μ… κ²°κ³Ό ν™•μΈ (Rails consoleμ—μ„ ReadingStimulus.first μ΅°ν)
2. PdfItemParserService λ¦¬ν©ν† λ§ μ™„λ£ ν™•μΈ
3. item_bank λ·° λ³€κ²½μ‚¬ν•­ λ°μ ν™•μΈ
4. μ‹¤μ  PDF μ—…λ΅λ“ ν…μ¤νΈ

---

## π› μ΄μ λ° ν•΄κ²°

### μ΄μ 1: λ§μ΄κ·Έλ μ΄μ… NOT NULL μ μ•½ μ¤λ¥
**λ¬Έμ **: κΈ°μ΅΄ λ°μ΄ν„°κ°€ μλ” μƒνƒμ—μ„ NOT NULL μ»¬λΌ μ¶”κ°€ μ‹ μ¤λ¥
**ν•΄κ²°**:
1. λ¨Όμ € NULL ν—μ©μΌλ΅ μ»¬λΌ μ¶”κ°€
2. λ°μ΄ν„° μ±„μ°κΈ°
3. NOT NULL μ μ•½ μ¶”κ°€
**μƒνƒ**: β… ν•΄κ²°λ¨

---

## π’΅ κ°μ„  μ•„μ΄λ””μ–΄ (μ¶”ν›„)

1. AI κΈ°λ° ν•µμ‹¬ μ”μ† μ¶”μ¶ (GPT-4 ν™μ©)
2. μ§€λ¬Έ λ‚μ΄λ„ μλ™ λ¶„μ„
3. λ¬Έν•­ μ€ν–‰ κ²€μƒ‰ ν•„ν„° κ°•ν™”
4. μ§„λ‹¨μ§€ μ„ΈνΈ λ―Έλ¦¬λ³΄κΈ° κΈ°λ¥
5. μ„ΈνΈ λ³µμ  κΈ°λ¥
6. λ²„μ „ κ΄€λ¦¬ (μ„ΈνΈ μμ • μ΄λ ¥)

---

**λ§μ§€λ§‰ μ—…λ°μ΄νΈ**: 2026-02-04 (λ¨λ“  μ‘μ—… μ™„λ£)
**μƒνƒ**: β… λ¬Έν•­ μ€ν–‰ μ¬μ„¤κ³„ μ™„λ£ (100%)
