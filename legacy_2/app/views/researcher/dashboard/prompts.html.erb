<% content_for :portal_title do %>
  í”„ë¡¬í”„íŠ¸ ê´€ë¦¬
<% end %>
<% content_for :portal_subtitle do %>
  ë¬¸í•­ ìƒì„±ìš© í”„ë¡¬í”„íŠ¸ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.
<% end %>
<% content_for :portal_nav do %>
  <%= render "researcher/shared/nav", current: :prompts %>
<% end %>

<style>
  .prompts-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
    margin-bottom: 32px;
  }

  .prompt-card {
    background: white;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 24px;
    transition: all 0.3s ease;
  }

  .prompt-card:hover {
    border-color: #667eea;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
    transform: translateY(-2px);
  }

  .prompt-card__icon {
    width: 48px;
    height: 48px;
    background: #f0f0f0;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 16px;
    font-size: 24px;
  }

  .prompt-card__title {
    font-size: 16px;
    font-weight: 600;
    color: #333;
    margin-bottom: 12px;
  }

  .prompt-card__description {
    font-size: 13px;
    color: #666;
    line-height: 1.6;
    margin-bottom: 16px;
  }

  .prompt-card__meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 16px;
    border-top: 1px solid #f0f0f0;
  }

  .prompt-card__status {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
  }

  .prompt-card__status--active {
    background: #d4edda;
    color: #155724;
  }

  .prompt-card__status--review {
    background: #fff3cd;
    color: #856404;
  }

  .prompt-card__action {
    color: #667eea;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    text-decoration: none;
    transition: color 0.3s ease;
  }

  .prompt-card__action:hover {
    color: #764ba2;
  }

  .prompt-summary {
    background: white;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 24px;
    margin-bottom: 32px;
  }

  .prompt-summary__header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
    padding-bottom: 16px;
    border-bottom: 2px solid #f0f0f0;
  }

  .prompt-summary__title {
    font-size: 16px;
    font-weight: 600;
    color: #333;
  }

  .prompt-summary__total {
    font-size: 24px;
    font-weight: 700;
    color: #667eea;
  }

  .prompt-stats {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
  }

  .prompt-stat {
    text-align: center;
    padding: 16px;
    background: #f8f9fa;
    border-radius: 8px;
  }

  .prompt-stat__label {
    font-size: 12px;
    color: #666;
    margin-bottom: 8px;
    font-weight: 600;
  }

  .prompt-stat__value {
    font-size: 28px;
    font-weight: 700;
    color: #333;
  }

  @media (max-width: 1024px) {
    .prompts-grid {
      grid-template-columns: 1fr;
    }

    .prompt-stats {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 768px) {
    .prompts-grid {
      grid-template-columns: 1fr;
    }

    .prompt-stats {
      grid-template-columns: 1fr;
    }

    .prompt-card__meta {
      flex-direction: column;
      align-items: flex-start;
      gap: 12px;
    }
  }
</style>

<!-- í”„ë¡¬í”„íŠ¸ ê²€ìƒ‰ ë° í•„í„° -->
<style>
  .prompts-filter {
    display: flex;
    gap: 12px;
    margin-bottom: 24px;
    flex-wrap: wrap;
    align-items: flex-end;
  }

  .prompts-filter__item {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .prompts-filter__item label {
    font-size: 12px;
    font-weight: 600;
    color: #333;
  }

  .prompts-filter__item input,
  .prompts-filter__item select {
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 13px;
    min-width: 150px;
  }
</style>

<%= form_with url: researcher_prompts_path, method: :get, local: true, class: "prompts-filter" do |f| %>
  <div class="prompts-filter__item">
    <%= f.text_field :search, placeholder: "í”„ë¡¬í”„íŠ¸ ê²€ìƒ‰", value: @search_query, style: "min-width: 200px;" %>
  </div>
  <div class="prompts-filter__item">
    <%= f.select :status, options_for_select(Prompt::STATUSES.map { |s| [Prompt::STATUS_LABELS[s], s] }, @status_filter), { include_blank: "ìƒíƒœ ì„ íƒ" } %>
  </div>
  <div class="prompts-filter__item">
    <%= f.select :category, options_for_select(Prompt::CATEGORIES.map { |c| [Prompt::CATEGORY_LABELS[c], c] }, @category_filter), { include_blank: "ì¹´í…Œê³ ë¦¬ ì„ íƒ" } %>
  </div>
  <div class="prompts-filter__item">
    <%= f.submit "ê²€ìƒ‰", class: "btn-primary" %>
  </div>
<% end %>

<!-- í”„ë¡¬í”„íŠ¸ í†µê³„ -->
<div class="prompt-summary">
  <div class="prompt-summary__header">
    <h2 class="prompt-summary__title">í”„ë¡¬í”„íŠ¸ í˜„í™©</h2>
    <div class="prompt-summary__total">
      <%= @total_count %><span style="font-size: 14px; color: #666; margin-left: 4px;">ê°œ</span>
    </div>
  </div>

  <div class="prompt-stats">
    <div class="prompt-stat">
      <div class="prompt-stat__label">ì‚¬ìš©ì¤‘ì¸ í”„ë¡¬í”„íŠ¸</div>
      <div class="prompt-stat__value"><%= @active_count %></div>
    </div>
    <div class="prompt-stat">
      <div class="prompt-stat__label">í˜„ì¬ í˜ì´ì§€</div>
      <div class="prompt-stat__value"><%= @page %> / <%= @total_pages %></div>
    </div>
    <div class="prompt-stat">
      <div class="prompt-stat__label">í˜ì´ì§€ë‹¹ í•­ëª©</div>
      <div class="prompt-stat__value"><%= @per_page %></div>
    </div>
  </div>
</div>

<!-- í”„ë¡¬í”„íŠ¸ ëª©ë¡ -->
<% if @prompts.any? %>
  <div class="prompts-grid">
    <% @prompts.each do |prompt| %>
      <div class="prompt-card">
        <div class="prompt-card__icon">ğŸ“</div>
        <h3 class="prompt-card__title"><%= prompt.title %></h3>
        <p class="prompt-card__description">
          <%= truncate(prompt.description.presence || prompt.content, length: 150, omission: "...") %>
        </p>
        <div class="prompt-card__meta">
          <% if prompt.status == 'active' %>
            <span class="prompt-card__status prompt-card__status--active"><%= prompt.status_label %></span>
          <% elsif prompt.status == 'draft' %>
            <span class="prompt-card__status prompt-card__status--review"><%= prompt.status_label %></span>
          <% else %>
            <span class="prompt-card__status"><%= prompt.status_label %></span>
          <% end %>
          <a href="#" class="prompt-card__action">ìƒì„¸ë³´ê¸° â†’</a>
        </div>
      </div>
    <% end %>
  </div>

  <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
  <div class="passages-pagination">
    <% if @page > 1 %>
      <%= link_to "â† ì´ì „", researcher_prompts_path(page: @page - 1, search: @search_query, status: @status_filter, category: @category_filter) %>
    <% else %>
      <span class="disabled">â† ì´ì „</span>
    <% end %>

    <% (1..@total_pages).each do |page_num| %>
      <% if page_num == @page %>
        <span class="active"><%= page_num %></span>
      <% else %>
        <%= link_to page_num, researcher_prompts_path(page: page_num, search: @search_query, status: @status_filter, category: @category_filter) %>
      <% end %>
    <% end %>

    <% if @page < @total_pages %>
      <%= link_to "ë‹¤ìŒ â†’", researcher_prompts_path(page: @page + 1, search: @search_query, status: @status_filter, category: @category_filter) %>
    <% else %>
      <span class="disabled">ë‹¤ìŒ â†’</span>
    <% end %>
  </div>
<% else %>
  <div class="passages-empty">
    <div class="passages-empty__icon">ğŸ“</div>
    <div class="passages-empty__message">í”„ë¡¬í”„íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤</div>
    <div class="passages-empty__submessage">
      <% if @search_query.present? || @status_filter.present? || @category_filter.present? %>
        ê²€ìƒ‰ ì¡°ê±´ì— ë§ëŠ” í”„ë¡¬í”„íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.
      <% else %>
        ìƒˆë¡œìš´ í”„ë¡¬í”„íŠ¸ë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”.
      <% end %>
    </div>
  </div>
<% end %>

<!-- ì¶”ê°€ ì§€ì› ë¬¸í•­ -->
<section class="portal-card">
  <div class="portal-card__header">
    <h3 class="portal-card__title">í™œìš© ê°€ëŠ¥í•œ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿</h3>
  </div>
  <div class="portal-card__body">
    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px;">
      <div>
        <h4 style="font-size: 14px; font-weight: 600; color: #333; margin-bottom: 12px;">ğŸ“š ì´í•´ë ¥ ì˜ì—­</h4>
        <ul style="list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 8px;">
          <li style="font-size: 13px; color: #666; padding: 8px 12px; background: #f8f9fa; border-radius: 4px;">
            âœ“ ë¬¸ìì  ì´í•´ ì§ˆë¬¸ ìƒì„±
          </li>
          <li style="font-size: 13px; color: #666; padding: 8px 12px; background: #f8f9fa; border-radius: 4px;">
            âœ“ ì¶”ë¡ ì  ì´í•´ ì§ˆë¬¸ ìƒì„±
          </li>
          <li style="font-size: 13px; color: #666; padding: 8px 12px; background: #f8f9fa; border-radius: 4px;">
            âœ“ ë¹„íŒì  ì´í•´ ì§ˆë¬¸ ìƒì„±
          </li>
        </ul>
      </div>

      <div>
        <h4 style="font-size: 14px; font-weight: 600; color: #333; margin-bottom: 12px;">ğŸ’¬ ì˜ì‚¬ì†Œí†µ ëŠ¥ë ¥</h4>
        <ul style="list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 8px;">
          <li style="font-size: 13px; color: #666; padding: 8px 12px; background: #f8f9fa; border-radius: 4px;">
            âœ“ ì •ë³´ ì „ë‹¬ í‰ê°€ ê¸°ì¤€
          </li>
          <li style="font-size: 13px; color: #666; padding: 8px 12px; background: #f8f9fa; border-radius: 4px;">
            âœ“ ê°ì • í‘œí˜„ í”¼ë“œë°±
          </li>
          <li style="font-size: 13px; color: #666; padding: 8px 12px; background: #f8f9fa; border-radius: 4px;">
            âœ“ ì„¤ë“ ë° ì£¼ì¥ ë¶„ì„
          </li>
        </ul>
      </div>
    </div>
  </div>
</section>
