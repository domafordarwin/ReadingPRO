<div class="rp-dashboard-container">
  <div class="rp-dashboard-header">
    <h1>ìƒë‹´ í†µê³„ ëŒ€ì‹œë³´ë“œ</h1>
    <p class="rp-subtitle">ìƒë‹´ ì‹ ì²­ í˜„í™© ë° í†µê³„</p>
  </div>

  <!-- ì£¼ìš” í†µê³„ ì¹´ë“œ -->
  <div class="rp-stats-grid">
    <div class="rp-stat-card">
      <div class="rp-stat-icon">ğŸ“‹</div>
      <div class="rp-stat-value"><%= @total_requests %></div>
      <div class="rp-stat-label">ì „ì²´ ì‹ ì²­</div>
    </div>
    <div class="rp-stat-card">
      <div class="rp-stat-icon">â³</div>
      <div class="rp-stat-value"><%= @pending_count %></div>
      <div class="rp-stat-label">ëŒ€ê¸° ì¤‘</div>
    </div>
    <div class="rp-stat-card">
      <div class="rp-stat-icon">âœ…</div>
      <div class="rp-stat-value"><%= @approved_count %></div>
      <div class="rp-stat-label">ìŠ¹ì¸ë¨</div>
    </div>
    <div class="rp-stat-card">
      <div class="rp-stat-icon">âŒ</div>
      <div class="rp-stat-value"><%= @rejected_count %></div>
      <div class="rp-stat-label">ê±°ì ˆë¨</div>
    </div>
    <div class="rp-stat-card">
      <div class="rp-stat-icon">ğŸ</div>
      <div class="rp-stat-value"><%= @completed_count %></div>
      <div class="rp-stat-label">ì™„ë£Œë¨</div>
    </div>
    <div class="rp-stat-card">
      <div class="rp-stat-icon">â±ï¸</div>
      <div class="rp-stat-value"><%= @avg_response_time %><span class="rp-stat-unit">ì‹œê°„</span></div>
      <div class="rp-stat-label">í‰ê·  ì‘ë‹µ ì‹œê°„</div>
    </div>
  </div>

  <!-- ìƒíƒœë³„ ë¶„í¬ ì°¨íŠ¸ -->
  <div class="rp-section">
    <h2>ìƒë‹´ ì‹ ì²­ ìƒíƒœë³„ ë¶„í¬</h2>
    <div class="rp-chart-grid">
      <% @by_status.each do |status| %>
        <div class="rp-chart-item">
          <div class="rp-chart-bar">
            <div class="rp-chart-bar-fill rp-chart-bar--<%= status[:color] %>"
                 style="width: <%= @total_requests > 0 ? (status[:count].to_f / @total_requests * 100).round(1) : 0 %>%">
            </div>
          </div>
          <div class="rp-chart-label">
            <span class="rp-label"><%= status[:label] %></span>
            <span class="rp-value"><%= status[:count] %> (<%= @total_requests > 0 ? (status[:count].to_f / @total_requests * 100).round(1) : 0 %>%)</span>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <!-- ìƒë‹´ ìœ í˜•ë³„ ë¶„ë¥˜ -->
  <div class="rp-section">
    <h2>ìƒë‹´ ìœ í˜•ë³„ ë¶„ë¥˜</h2>
    <% if @by_category.any? %>
      <table class="rp-table">
        <thead>
          <tr>
            <th>ìƒë‹´ ìœ í˜•</th>
            <th>ì‹ ì²­ ê±´ìˆ˜</th>
            <th>ë¹„ìœ¨</th>
          </tr>
        </thead>
        <tbody>
          <% @by_category.each do |category| %>
            <tr>
              <td><strong><%= category[:label] %></strong></td>
              <td><%= category[:count] %></td>
              <td>
                <div class="rp-progress-bar">
                  <div class="rp-progress-fill" style="width: <%= @total_requests > 0 ? (category[:count].to_f / @total_requests * 100).round(1) : 0 %>%"></div>
                </div>
                <span class="rp-percentage"><%= @total_requests > 0 ? (category[:count].to_f / @total_requests * 100).round(1) : 0 %>%</span>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <p class="rp-empty-state">ìƒë‹´ ì‹ ì²­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    <% end %>
  </div>

  <!-- ìµœê·¼ ìƒë‹´ ì‹ ì²­ -->
  <div class="rp-section">
    <h2>ìµœê·¼ ìƒë‹´ ì‹ ì²­</h2>
    <% if @recent_requests.any? %>
      <table class="rp-table">
        <thead>
          <tr>
            <th>í•™ìƒëª…</th>
            <th>í•™ë¶€ëª¨</th>
            <th>ìƒë‹´ ìœ í˜•</th>
            <th>í¬ë§ ì¼ì •</th>
            <th>ìƒíƒœ</th>
            <th>ì‹ ì²­ì¼</th>
          </tr>
        </thead>
        <tbody>
          <% @recent_requests.each do |req| %>
            <tr onclick="window.location='<%= diagnostic_teacher_consultation_request_path(req) %>' ">
              <td><strong><%= req.student.name %></strong></td>
              <td><%= req.user.email %></td>
              <td>
                <span class="rp-badge rp-badge-info">
                  <%= req.category_label %>
                </span>
              </td>
              <td><%= req.scheduled_at.strftime("%Y-%m-%d %H:%M") %></td>
              <td>
                <% case req.status %>
                  <% when 'pending' %>
                    <span class="rp-badge rp-badge-warning">ëŒ€ê¸° ì¤‘</span>
                  <% when 'approved' %>
                    <span class="rp-badge rp-badge-success">ìŠ¹ì¸ë¨</span>
                  <% when 'rejected' %>
                    <span class="rp-badge rp-badge-danger">ê±°ì ˆë¨</span>
                  <% when 'completed' %>
                    <span class="rp-badge rp-badge-secondary">ì™„ë£Œë¨</span>
                <% end %>
              </td>
              <td><%= req.created_at.strftime("%Y-%m-%d") %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <p class="rp-empty-state">ìµœê·¼ ìƒë‹´ ì‹ ì²­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    <% end %>
  </div>
</div>

<style>
  .rp-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 16px;
    margin-bottom: 32px;
  }

  .rp-stat-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: transform 0.2s, box-shadow 0.2s;
  }

  .rp-stat-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 12px rgba(0, 0, 0, 0.15);
  }

  .rp-stat-icon {
    font-size: 32px;
    margin-bottom: 8px;
  }

  .rp-stat-value {
    font-size: 28px;
    font-weight: bold;
    margin-bottom: 4px;
  }

  .rp-stat-unit {
    font-size: 14px;
    margin-left: 4px;
    font-weight: normal;
  }

  .rp-stat-label {
    font-size: 12px;
    opacity: 0.9;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .rp-chart-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 24px;
    margin-top: 16px;
  }

  .rp-chart-item {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .rp-chart-bar {
    height: 24px;
    background: #f0f0f0;
    border-radius: 4px;
    overflow: hidden;
  }

  .rp-chart-bar-fill {
    height: 100%;
    border-radius: 4px;
    transition: width 0.3s;
  }

  .rp-chart-bar--warning {
    background: #ff9800;
  }

  .rp-chart-bar--success {
    background: #4caf50;
  }

  .rp-chart-bar--danger {
    background: #f44336;
  }

  .rp-chart-bar--secondary {
    background: #9e9e9e;
  }

  .rp-chart-label {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 13px;
  }

  .rp-label {
    font-weight: 600;
    color: #333;
  }

  .rp-value {
    color: #666;
  }

  .rp-progress-bar {
    height: 8px;
    background: #e0e0e0;
    border-radius: 4px;
    overflow: hidden;
    flex: 1;
    margin-right: 12px;
  }

  .rp-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #667eea, #764ba2);
    border-radius: 4px;
  }

  .rp-percentage {
    font-size: 12px;
    color: #666;
    min-width: 40px;
    text-align: right;
  }

  .rp-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 16px;
  }

  .rp-table thead tr {
    background: #f5f5f5;
    border-bottom: 2px solid #ddd;
  }

  .rp-table th {
    padding: 12px;
    text-align: left;
    font-weight: 600;
    font-size: 13px;
    color: #333;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .rp-table td {
    padding: 12px;
    border-bottom: 1px solid #eee;
  }

  .rp-table tbody tr {
    cursor: pointer;
    transition: background-color 0.2s;
  }

  .rp-table tbody tr:hover {
    background-color: #f9f9f9;
  }

  .rp-empty-state {
    text-align: center;
    padding: 32px;
    color: #999;
    font-size: 15px;
  }
</style>
