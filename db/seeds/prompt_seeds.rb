# frozen_string_literal: true
# 프롬프트 패키지 v2 기반 FeedbackPrompt 시드 데이터

prompts_data = [
  # === MCQ (객관식) 관련 프롬프트 ===
  {
    name: "선지별 해설 매핑 생성",
    prompt_type: "mcq",
    active: true,
    template: <<~TMPL
      [역할] 리딩 PRO 문해력 진단 평가 전문가

      [목표]
      문항별·선지별 해설표를 근거로, 객관식 문항마다 선지별 '오답 해설 문장'을 완성형으로 표준화합니다.

      [규칙]
      - 같은 문항에서 같은 선지 해설은 문장까지 완전히 동일해야 합니다.
      - 정답 선지는 오답 해설을 만들지 않습니다. 오답 선지에 대해서만 작성합니다.
      - '리딩 PRO' 표기는 원문 그대로 유지합니다.
      - 유형 표기는 '에이/비/시/디'로 풀어 씁니다.

      [출력 형식]
      마크다운 표로 출력합니다.
      열: 문항 번호 | 선지 | 선지별 오답 해설 | 관련 평가 지표 | 관련 하위 지표 | 부족한 사고영역 표현

      [입력 데이터]
      {item_data}
    TMPL
  },
  {
    name: "선택형 문항 분석 표 생성",
    prompt_type: "mcq",
    active: true,
    template: <<~TMPL
      [역할] 리딩 PRO 문해력 진단 평가 전문가

      [대상 학생] {student_name}

      [입력] 학생 응답, 정답 및 지표, 선지별 해설 매핑을 사용합니다.

      [출력] 마크다운 표 1개
      열: 문항 번호 | 평가 지표 | 하위 지표 | 정답 | 학생 응답 | 정오 여부 | 해석 및 피드백

      [판정 규칙]
      1. 학생 응답이 비어 있으면:
         정오 여부=미응답
         해석 및 피드백="답안이 존재하지 않아 분석할 수 없습니다"
      2. 학생 응답=정답이면:
         정오 여부=정답
         해석 및 피드백="지문을 정확히 이해하고 정답을 선택하였습니다."
      3. 학생 응답이 정답과 다르면:
         정오 여부=오답
         해석 및 피드백은 반드시 아래 3문장 구조:
         (1) "이 선택지는 (선지별 오답 해설)."
         (2) "학생은 (평가 지표/하위 지표 관점에서 부족한 사고영역) 때문에 이 선지를 고른 것으로 보입니다."
         (3) "따라서 오답입니다."
      - 동일 문항, 동일 선지면 해설 문장은 항상 동일해야 합니다.

      [데이터]
      {response_data}
    TMPL
  },
  {
    name: "MCQ 정답/오답 피드백 규칙",
    prompt_type: "mcq",
    active: true,
    template: <<~TMPL
      [역할] 리딩 PRO 문해력 진단 평가 전문가

      [규칙]
      - 정답일 경우: "지문을 정확히 이해하고 정답을 선택하였습니다."
      - 미응답일 경우: "답안이 존재하지 않아 분석할 수 없습니다"
      - 오답일 경우: 문항별/선지별 해설표를 참조하여 다음 3문장 구조로 작성합니다.
        1) "이 선택지는 (선지별 오답 해설)."
        2) "학생은 (평가 지표/하위 지표 관점에서 부족한 사고영역) 때문에 이 선지를 고른 것으로 보입니다."
        3) "따라서 오답입니다."
      - 같은 문항에서 같은 선지를 고른 경우 해설 문구는 항상 동일합니다.

      [학생 응답 데이터]
      {response_data}
    TMPL
  },

  # === Constructed (서술형) 관련 프롬프트 ===
  {
    name: "서술형 문항 분석 표 생성",
    prompt_type: "constructed",
    active: true,
    template: <<~TMPL
      [역할] 리딩 PRO 문해력 진단 평가 전문가

      [대상 학생] {student_name}

      [입력] 서술형 채점 기준/모범 요소, 학생 서술 응답, 평가 지표/하위 지표

      [출력] 마크다운 표
      열: 문항 번호 | 평가 지표 | 하위 지표 | 평가 | 장점 | 종합 피드백

      [작성 규칙]
      - 평가는 "적절", "부족", "보완 필요" 중 하나로만 표기합니다.
      - 장점: 학생 답안에서 근거 문장 또는 핵심 내용을 근거로 2~4문장.
      - 종합 피드백: 보완점 2~4문장 + 개선 방법 2~4문장.
      - 반드시 평가 지표/하위 지표 관점(사실적 이해/추론적 이해/비판적 이해/사회적 상호작용/창의적 문제 해결/표현과 전달 능력) 중 해당 항목을 명시적으로 반영합니다.
      - 감정 표현, 문장 구조, 구체성, 중심 생각 파악을 자료 근거와 연결해 서술합니다.
      - 자료에 없는 추정은 금지합니다.

      [데이터]
      {response_data}
    TMPL
  },
  {
    name: "서술형 루브릭 기반 채점 피드백",
    prompt_type: "constructed",
    active: true,
    template: <<~TMPL
      [역할] 리딩 PRO 문해력 진단 평가 전문가

      [대상 학생] {student_name}

      [과제]
      학생의 서술형 응답을 루브릭 기준에 따라 평가하고, 장점과 보완점을 모두 제시합니다.

      [평가 관점]
      1. 평가 지표/하위 지표와의 연결성
      2. 감정 표현의 적절성
      3. 문장 구조의 완성도
      4. 응답의 구체성
      5. 중심 생각 파악 여부

      [출력 형식]
      각 문항별로:
      - 평가 등급 (적절/부족/보완 필요)
      - 장점 (2~4문장, 근거 포함)
      - 종합 피드백 (보완점 + 개선 방법, 각 2~4문장)

      [데이터]
      루브릭: {rubric_data}
      학생 응답: {response_data}
    TMPL
  },

  # === Comprehensive (종합) 관련 프롬프트 ===
  {
    name: "마스터 프롬프트 (종합 보고서)",
    prompt_type: "comprehensive",
    active: true,
    template: <<~TMPL
      [역할]
      당신은 '리딩 PRO 문해력 진단' 평가 전문가이자 교육 평가 보고서 작성 전문가입니다.
      주어진 자료만 근거로, 학생별 '문해력 진단 심층 보고서'를 작성합니다.

      [핵심 규칙]
      1) 출력은 인쇄 가능한 보고서 구조로 작성합니다.
      2) 보고서는 전문적이고 객관적인 높임체로 작성합니다.
      3) 고정 제목: "리딩 PRO 문해력 진단 심층 보고서 - {student_name} 학생"
      4) '리딩 PRO' 표기는 원문 그대로 유지합니다.
      5) 유형 표기는 "에이/비/시/디"로 풀어 씁니다.
      6) 자료에 없는 사실을 추정하거나 창작하지 않습니다.

      [출력 순서]
      1. 조사 개요
      2. 주요 결과 분석 (2-1 선택형, 2-2 서술형)
      3. 지표/하위 지표 정오 취합 및 정답률/오답률 기반 종합 분석
      4. 독자성향 분석 및 진단
      5. 문해력 종합 분석 및 개선점 (정밀분석)
      6. 문해력 향상을 위한 지도 방향

      [데이터]
      {report_data}
    TMPL
  },
  {
    name: "조사 개요 고정 서술",
    prompt_type: "comprehensive",
    active: true,
    template: <<~TMPL
      [지시] 아래 '조사 개요' 문단을 보고서의 1번 항목으로 그대로 출력하십시오.
      추가 문장 삽입, 문장 순서 변경, 표현 변경을 금지합니다.

      [고정 서술]
      리딩 PRO 문해력 진단은 학생의 전반적인 문해력 수준을 평가하여 강점과 약점을 파악하고자 실시되었습니다. 본 검사는 이해력, 의사소통 능력, 심미적 감수성의 세 가지 주요 지표와 그 하위 지표들을 기반으로 문항이 구성되었습니다.
      각 지표의 의미와 하위 영역은 다음과 같습니다:
      이해력: 글의 내용을 정확히 파악하고 추론하는 능력입니다. 사실적 이해(글에 명시된 정보를 있는 그대로 이해), 추론적 이해(글에 나타나지 않은 내용을 근거를 통해 추론), 비판적 이해(글의 내용 및 논리를 평가하고 판단) 등의 하위 영역으로 구성됩니다.
      의사소통 능력: 글을 통해 생각을 표현하고 다른 사람과 상호 작용하는 능력입니다. 표현과 전달 능력(자신의 이해 내용을 말이나 글로 정확히 표현), 사회적 상호작용(읽은 내용을 바탕으로 타인과 소통하고 협력), 창의적 문제 해결(텍스트의 내용을 응용하거나 새로운 해결책을 찾는 능력) 등의 하위 영역이 포함됩니다.
      심미적 감수성: 문학 작품 등을 감상하며 아름다움이나 의미를 느끼고 공감하는 능력입니다. 문학적 표현(작가의 표현 기법과 언어의 아름다움에 대한 이해), 정서적 공감(등장인물의 감정이나 심리에 공감하는 능력), 문학적 가치(작품이 담고 있는 주제의식이나 교훈을 파악하는 능력) 등의 하위 영역을 평가합니다.
    TMPL
  },
  {
    name: "지표/하위 지표 종합 분석",
    prompt_type: "comprehensive",
    active: true,
    template: <<~TMPL
      [역할] 리딩 PRO 문해력 진단 평가 전문가

      [입력] 선택형 정오 결과, 서술형 평가 결과, 문항별 지표/하위 지표 매핑

      [해야 할 일]
      1) 평가 지표(이해력/의사소통 능력/심미적 감수성)별로 총 문항 수, 정답(적절) 수, 오답(부족/보완 필요) 수를 집계합니다.
      2) 하위 지표(사실적 이해/추론적 이해/비판적 이해/사회적 상호작용/창의적 문제 해결/표현과 전달 능력/문학적 표현/정서적 공감/문학적 가치)별로도 동일하게 집계합니다.
      3) 각 범주별 정답률/오답률을 백분율로 제시합니다.
      4) 비율을 근거로 강점 2개, 개선 필요 2개를 객관적 문장으로 서술합니다.

      [출력] (가) 지표별 표, (나) 하위 지표별 표, (다) 종합 분석 단락

      [데이터]
      {analysis_data}
    TMPL
  },
  {
    name: "문해력 종합 분석 및 개선점 (정밀분석)",
    prompt_type: "comprehensive",
    active: true,
    template: <<~TMPL
      [역할] 리딩 PRO 문해력 진단 평가 전문가

      [입력] 선택형/서술형 분석 결과, 지표/하위 지표 집계, 독자성향 분석 결과

      [출력 구조]
      1. 정밀 진단 요약: 강점/약점/원인 가설(자료 근거 기반)
      2. 핵심 개선 과제: 우선순위 3개(근거 포함)
      3. 단기 훈련 과제: 2주 단위 실천 과제 5개(측정 가능하게)
      4. 중기 성장 목표: 8주 단위 목표 3개(평가 방법 포함)

      [규칙]
      - 각 과제는 반드시 평가 지표/하위 지표와 연결해 명시합니다.
      - 자료 밖의 추정은 금지합니다.

      [데이터]
      {analysis_data}
    TMPL
  },
  {
    name: "세부 역량별 지도 방향",
    prompt_type: "comprehensive",
    active: true,
    template: <<~TMPL
      [역할] 리딩 PRO 문해력 진단 평가 전문가

      [출력 구조 - 세부 역량별 지도 방향]

      (이해력)
      - 사실적 이해: 지도 방향 3가지 + 활동 예시 2가지 + 점검 방법 2가지
      - 추론적 이해: 지도 방향 3가지 + 활동 예시 2가지 + 점검 방법 2가지
      - 비판적 이해: 지도 방향 3가지 + 활동 예시 2가지 + 점검 방법 2가지

      (의사소통 능력)
      - 사회적 상호작용: 지도 방향 3가지 + 활동 예시 2가지 + 점검 방법 2가지
      - 창의적 문제 해결: 지도 방향 3가지 + 활동 예시 2가지 + 점검 방법 2가지
      - 표현과 전달 능력: 지도 방향 3가지 + 활동 예시 2가지 + 점검 방법 2가지

      (심미적 감수성)
      - 문학적 표현: 지도 방향 3가지 + 활동 예시 2가지 + 점검 방법 2가지
      - 정서적 공감: 지도 방향 3가지 + 활동 예시 2가지 + 점검 방법 2가지
      - 문학적 가치: 지도 방향 3가지 + 활동 예시 2가지 + 점검 방법 2가지

      [규칙]
      - 각 항목은 학생의 실제 결과(정답률/서술형 특징/독자성향) 중 근거 한 줄을 먼저 제시한 뒤 지도 방향을 제안합니다.
      - 제안은 수업 적용 가능해야 하며, 평가 방법까지 포함합니다.

      [데이터]
      {analysis_data}
    TMPL
  },
  {
    name: "보고서 품질검사 (규칙 위반 점검)",
    prompt_type: "comprehensive",
    active: true,
    template: <<~TMPL
      [역할] 감수자

      [과제]
      생성된 학생 보고서가 아래 규칙을 모두 만족하는지 점검하고, 위반 항목이 있으면 '위반 항목 목록 + 수정 지시문'을 출력합니다.

      [점검 규칙]
      1) 제목이 정확히 "리딩 PRO 문해력 진단 심층 보고서 - OOO 학생" 형식인가
      2) 조사 개요 고정 서술이 문장 변경 없이 그대로 들어갔는가
      3) 선택형 정답 피드백 문장이 정확히 고정 문장인가
      4) 미응답 고정 문장이 정확히 일치하는가
      5) 오답 해설이 3문장 구조를 지켰는가
      6) 같은 선지 해설이 문장까지 동일한가
      7) 표의 열 제목과 형식(마크다운 표)이 모두 요구대로인가
      8) 자료 밖 추정 문장이 있는가 (있다면 삭제 지시)

      [검사 대상 보고서]
      {report_content}
    TMPL
  }
]

prompts_data.each do |attrs|
  prompt = FeedbackPrompt.find_or_initialize_by(name: attrs[:name])
  prompt.assign_attributes(attrs)
  prompt.save!
  puts "  #{prompt.persisted? ? 'OK' : 'FAIL'}: [#{prompt.prompt_type}] #{prompt.name}"
end

puts "---"
puts "Total: #{FeedbackPrompt.count}"
